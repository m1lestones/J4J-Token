(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,228337,(e,t,r)=>{(function(){var n,s="Expected a function",i="__lodash_hash_undefined__",o="__lodash_placeholder__",a=1/0,c=0/0,u=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],h="[object Arguments]",l="[object Array]",f="[object Boolean]",d="[object Date]",p="[object Error]",g="[object Function]",m="[object GeneratorFunction]",_="[object Map]",b="[object Number]",y="[object Object]",v="[object Promise]",w="[object RegExp]",x="[object Set]",S="[object String]",E="[object Symbol]",A="[object WeakMap]",O="[object ArrayBuffer]",P="[object DataView]",k="[object Float32Array]",j="[object Float64Array]",C="[object Int8Array]",I="[object Int16Array]",N="[object Int32Array]",R="[object Uint8Array]",M="[object Uint8ClampedArray]",T="[object Uint16Array]",$="[object Uint32Array]",U=/\b__p \+= '';/g,q=/\b(__p \+=) '' \+/g,L=/(__e\(.*?\)|\b__t\)) \+\n'';/g,F=/&(?:amp|lt|gt|quot|#39);/g,B=/[&<>"']/g,D=RegExp(F.source),z=RegExp(B.source),H=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,G=/<%=([\s\S]+?)%>/g,K=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,W=/^\w*$/,V=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Y=/[\\^$.*+?()[\]{}|]/g,Z=RegExp(Y.source),X=/^\s+/,Q=/\s/,ee=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,et=/\{\n\/\* \[wrapped with (.+)\] \*/,er=/,? & /,en=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,es=/[()=,{}\[\]\/\s]/,ei=/\\(\\)?/g,eo=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ea=/\w*$/,ec=/^[-+]0x[0-9a-f]+$/i,eu=/^0b[01]+$/i,eh=/^\[object .+?Constructor\]$/,el=/^0o[0-7]+$/i,ef=/^(?:0|[1-9]\d*)$/,ed=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ep=/($^)/,eg=/['\n\r\u2028\u2029\\]/g,em="\\ud800-\\udfff",e_="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",eb="\\u2700-\\u27bf",ey="a-z\\xdf-\\xf6\\xf8-\\xff",ev="A-Z\\xc0-\\xd6\\xd8-\\xde",ew="\\ufe0e\\ufe0f",ex="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",eS="['’]",eE="["+ex+"]",eA="["+e_+"]",eO="["+ey+"]",eP="[^"+em+ex+"\\d+"+eb+ey+ev+"]",ek="\\ud83c[\\udffb-\\udfff]",ej="[^"+em+"]",eC="(?:\\ud83c[\\udde6-\\uddff]){2}",eI="[\\ud800-\\udbff][\\udc00-\\udfff]",eN="["+ev+"]",eR="\\u200d",eM="(?:"+eO+"|"+eP+")",eT="(?:"+eN+"|"+eP+")",e$="(?:"+eS+"(?:d|ll|m|re|s|t|ve))?",eU="(?:"+eS+"(?:D|LL|M|RE|S|T|VE))?",eq="(?:"+eA+"|"+ek+")?",eL="["+ew+"]?",eF="(?:"+eR+"(?:"+[ej,eC,eI].join("|")+")"+eL+eq+")*",eB=eL+eq+eF,eD="(?:"+["["+eb+"]",eC,eI].join("|")+")"+eB,ez="(?:"+[ej+eA+"?",eA,eC,eI,"["+em+"]"].join("|")+")",eH=RegExp(eS,"g"),eJ=RegExp(eA,"g"),eG=RegExp(ek+"(?="+ek+")|"+ez+eB,"g"),eK=RegExp([eN+"?"+eO+"+"+e$+"(?="+[eE,eN,"$"].join("|")+")",eT+"+"+eU+"(?="+[eE,eN+eM,"$"].join("|")+")",eN+"?"+eM+"+"+e$,eN+"+"+eU,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])|\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])|\\d+",eD].join("|"),"g"),eW=RegExp("["+eR+em+e_+ew+"]"),eV=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,eY=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],eZ=-1,eX={};eX[k]=eX[j]=eX[C]=eX[I]=eX[N]=eX[R]=eX[M]=eX[T]=eX[$]=!0,eX[h]=eX[l]=eX[O]=eX[f]=eX[P]=eX[d]=eX[p]=eX[g]=eX[_]=eX[b]=eX[y]=eX[w]=eX[x]=eX[S]=eX[A]=!1;var eQ={};eQ[h]=eQ[l]=eQ[O]=eQ[P]=eQ[f]=eQ[d]=eQ[k]=eQ[j]=eQ[C]=eQ[I]=eQ[N]=eQ[_]=eQ[b]=eQ[y]=eQ[w]=eQ[x]=eQ[S]=eQ[E]=eQ[R]=eQ[M]=eQ[T]=eQ[$]=!0,eQ[p]=eQ[g]=eQ[A]=!1;var e0={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},e1=parseFloat,e2=parseInt,e3=e.g&&e.g.Object===Object&&e.g,e5="object"==typeof self&&self&&self.Object===Object&&self,e4=e3||e5||Function("return this")(),e6=r&&!r.nodeType&&r,e8=e6&&t&&!t.nodeType&&t,e7=e8&&e8.exports===e6,e9=e7&&e3.process,te=function(){try{var e=e8&&e8.require&&e8.require("util").types;if(e)return e;return e9&&e9.binding&&e9.binding("util")}catch(e){}}(),tt=te&&te.isArrayBuffer,tr=te&&te.isDate,tn=te&&te.isMap,ts=te&&te.isRegExp,ti=te&&te.isSet,to=te&&te.isTypedArray;function ta(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function tc(e,t,r,n){for(var s=-1,i=null==e?0:e.length;++s<i;){var o=e[s];t(n,o,r(o),e)}return n}function tu(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function th(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function tl(e,t){for(var r=-1,n=null==e?0:e.length,s=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[s++]=o)}return i}function tf(e,t){return!!(null==e?0:e.length)&&tx(e,t,0)>-1}function td(e,t,r){for(var n=-1,s=null==e?0:e.length;++n<s;)if(r(t,e[n]))return!0;return!1}function tp(e,t){for(var r=-1,n=null==e?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}function tg(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}function tm(e,t,r,n){var s=-1,i=null==e?0:e.length;for(n&&i&&(r=e[++s]);++s<i;)r=t(r,e[s],s,e);return r}function t_(e,t,r,n){var s=null==e?0:e.length;for(n&&s&&(r=e[--s]);s--;)r=t(r,e[s],s,e);return r}function tb(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var ty=tO("length");function tv(e,t,r){var n;return r(e,function(e,r,s){if(t(e,r,s))return n=r,!1}),n}function tw(e,t,r,n){for(var s=e.length,i=r+(n?1:-1);n?i--:++i<s;)if(t(e[i],i,e))return i;return -1}function tx(e,t,r){return t==t?function(e,t,r){for(var n=r-1,s=e.length;++n<s;)if(e[n]===t)return n;return -1}(e,t,r):tw(e,tE,r)}function tS(e,t,r,n){for(var s=r-1,i=e.length;++s<i;)if(n(e[s],t))return s;return -1}function tE(e){return e!=e}function tA(e,t){var r=null==e?0:e.length;return r?tj(e,t)/r:c}function tO(e){return function(t){return null==t?n:t[e]}}function tP(e){return function(t){return null==e?n:e[t]}}function tk(e,t,r,n,s){return s(e,function(e,s,i){r=n?(n=!1,e):t(r,e,s,i)}),r}function tj(e,t){for(var r,s=-1,i=e.length;++s<i;){var o=t(e[s]);n!==o&&(r=n===r?o:r+o)}return r}function tC(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function tI(e){return e?e.slice(0,tK(e)+1).replace(X,""):e}function tN(e){return function(t){return e(t)}}function tR(e,t){return tp(t,function(t){return e[t]})}function tM(e,t){return e.has(t)}function tT(e,t){for(var r=-1,n=e.length;++r<n&&tx(t,e[r],0)>-1;);return r}function t$(e,t){for(var r=e.length;r--&&tx(t,e[r],0)>-1;);return r}var tU=tP({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),tq=tP({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function tL(e){return"\\"+e0[e]}function tF(e){return eW.test(e)}function tB(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}function tD(e,t){return function(r){return e(t(r))}}function tz(e,t){for(var r=-1,n=e.length,s=0,i=[];++r<n;){var a=e[r];(a===t||a===o)&&(e[r]=o,i[s++]=r)}return i}function tH(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}function tJ(e){return tF(e)?function(e){for(var t=eG.lastIndex=0;eG.test(e);)++t;return t}(e):ty(e)}function tG(e){return tF(e)?e.match(eG)||[]:e.split("")}function tK(e){for(var t=e.length;t--&&Q.test(e.charAt(t)););return t}var tW=tP({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),tV=function e(t){var r,Q,em,e_,eb=(t=null==t?e4:tV.defaults(e4.Object(),t,tV.pick(e4,eY))).Array,ey=t.Date,ev=t.Error,ew=t.Function,ex=t.Math,eS=t.Object,eE=t.RegExp,eA=t.String,eO=t.TypeError,eP=eb.prototype,ek=ew.prototype,ej=eS.prototype,eC=t["__core-js_shared__"],eI=ek.toString,eN=ej.hasOwnProperty,eR=0,eM=(r=/[^.]+$/.exec(eC&&eC.keys&&eC.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",eT=ej.toString,e$=eI.call(eS),eU=e4._,eq=eE("^"+eI.call(eN).replace(Y,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),eL=e7?t.Buffer:n,eF=t.Symbol,eB=t.Uint8Array,eD=eL?eL.allocUnsafe:n,ez=tD(eS.getPrototypeOf,eS),eG=eS.create,eW=ej.propertyIsEnumerable,e0=eP.splice,e3=eF?eF.isConcatSpreadable:n,e5=eF?eF.iterator:n,e6=eF?eF.toStringTag:n,e8=function(){try{var e=sf(eS,"defineProperty");return e({},"",{}),e}catch(e){}}(),e9=t.clearTimeout!==e4.clearTimeout&&t.clearTimeout,te=ey&&ey.now!==e4.Date.now&&ey.now,ty=t.setTimeout!==e4.setTimeout&&t.setTimeout,tP=ex.ceil,tY=ex.floor,tZ=eS.getOwnPropertySymbols,tX=eL?eL.isBuffer:n,tQ=t.isFinite,t0=eP.join,t1=tD(eS.keys,eS),t2=ex.max,t3=ex.min,t5=ey.now,t4=t.parseInt,t6=ex.random,t8=eP.reverse,t7=sf(t,"DataView"),t9=sf(t,"Map"),re=sf(t,"Promise"),rt=sf(t,"Set"),rr=sf(t,"WeakMap"),rn=sf(eS,"create"),rs=rr&&new rr,ri={},ro=sU(t7),ra=sU(t9),rc=sU(re),ru=sU(rt),rh=sU(rr),rl=eF?eF.prototype:n,rf=rl?rl.valueOf:n,rd=rl?rl.toString:n;function rp(e){if(iW(e)&&!iU(e)&&!(e instanceof rb)){if(e instanceof r_)return e;if(eN.call(e,"__wrapped__"))return sq(e)}return new r_(e)}var rg=function(){function e(){}return function(t){if(!iK(t))return{};if(eG)return eG(t);e.prototype=t;var r=new e;return e.prototype=n,r}}();function rm(){}function r_(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=n}function rb(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=0xffffffff,this.__views__=[]}function ry(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function rv(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function rw(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function rx(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new rw;++t<r;)this.add(e[t])}function rS(e){var t=this.__data__=new rv(e);this.size=t.size}function rE(e,t){var r=iU(e),n=!r&&i$(e),s=!r&&!n&&iB(e),i=!r&&!n&&!s&&i2(e),o=r||n||s||i,a=o?tC(e.length,eA):[],c=a.length;for(var u in e)(t||eN.call(e,u))&&!(o&&("length"==u||s&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||sy(u,c)))&&a.push(u);return a}function rA(e){var t=e.length;return t?e[nu(0,t-1)]:n}rp.templateSettings={escape:H,evaluate:J,interpolate:G,variable:"",imports:{_:rp}},rp.prototype=rm.prototype,rp.prototype.constructor=rp,r_.prototype=rg(rm.prototype),r_.prototype.constructor=r_,rb.prototype=rg(rm.prototype),rb.prototype.constructor=rb,ry.prototype.clear=function(){this.__data__=rn?rn(null):{},this.size=0},ry.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=!!t,t},ry.prototype.get=function(e){var t=this.__data__;if(rn){var r=t[e];return r===i?n:r}return eN.call(t,e)?t[e]:n},ry.prototype.has=function(e){var t=this.__data__;return rn?t[e]!==n:eN.call(t,e)},ry.prototype.set=function(e,t){var r=this.__data__;return this.size+=+!this.has(e),r[e]=rn&&n===t?i:t,this},rv.prototype.clear=function(){this.__data__=[],this.size=0},rv.prototype.delete=function(e){var t=this.__data__,r=rk(t,e);return!(r<0)&&(r==t.length-1?t.pop():e0.call(t,r,1),--this.size,!0)},rv.prototype.get=function(e){var t=this.__data__,r=rk(t,e);return r<0?n:t[r][1]},rv.prototype.has=function(e){return rk(this.__data__,e)>-1},rv.prototype.set=function(e,t){var r=this.__data__,n=rk(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},rw.prototype.clear=function(){this.size=0,this.__data__={hash:new ry,map:new(t9||rv),string:new ry}},rw.prototype.delete=function(e){var t=sh(this,e).delete(e);return this.size-=!!t,t},rw.prototype.get=function(e){return sh(this,e).get(e)},rw.prototype.has=function(e){return sh(this,e).has(e)},rw.prototype.set=function(e,t){var r=sh(this,e),n=r.size;return r.set(e,t),this.size+=+(r.size!=n),this},rx.prototype.add=rx.prototype.push=function(e){return this.__data__.set(e,i),this},rx.prototype.has=function(e){return this.__data__.has(e)};function rO(e,t,r){(n===r||iR(e[t],r))&&(n!==r||t in e)||rI(e,t,r)}function rP(e,t,r){var s=e[t];eN.call(e,t)&&iR(s,r)&&(n!==r||t in e)||rI(e,t,r)}function rk(e,t){for(var r=e.length;r--;)if(iR(e[r][0],t))return r;return -1}function rj(e,t,r,n){return rq(e,function(e,s,i){t(n,e,r(e),i)}),n}function rC(e,t){return e&&nB(t,op(t),e)}function rI(e,t,r){"__proto__"==t&&e8?e8(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function rN(e,t){for(var r=-1,s=t.length,i=eb(s),o=null==e;++r<s;)i[r]=o?n:ou(e,t[r]);return i}function rR(e,t,r){return e==e&&(n!==r&&(e=e<=r?e:r),n!==t&&(e=e>=t?e:t)),e}function rM(e,t,r,s,i,o){var a,c=1&t,u=2&t,l=4&t;if(r&&(a=i?r(e,s,i,o):r(e)),n!==a)return a;if(!iK(e))return e;var p=iU(e);if(p){if(A=(v=e).length,U=new v.constructor(A),A&&"string"==typeof v[0]&&eN.call(v,"index")&&(U.index=v.index,U.input=v.input),a=U,!c)return nF(e,a)}else{var v,A,U,q,L,F,B,D,z=sg(e),H=z==g||z==m;if(iB(e))return nM(e,c);if(z==y||z==h||H&&!i){if(a=u||H?{}:s_(e),!c){return u?(q=e,L=(D=a)&&nB(e,og(e),D),nB(q,sp(q),L)):(F=e,B=rC(a,e),nB(F,sd(F),B))}}else{if(!eQ[z])return i?e:{};a=function(e,t,r){var n,s,i=e.constructor;switch(t){case O:return nT(e);case f:case d:return new i(+e);case P:return n=r?nT(e.buffer):e.buffer,new e.constructor(n,e.byteOffset,e.byteLength);case k:case j:case C:case I:case N:case R:case M:case T:case $:return n$(e,r);case _:return new i;case b:case S:return new i(e);case w:return(s=new e.constructor(e.source,ea.exec(e))).lastIndex=e.lastIndex,s;case x:return new i;case E:return rf?eS(rf.call(e)):{}}}(e,z,c)}}o||(o=new rS);var J=o.get(e);if(J)return J;o.set(e,a),iQ(e)?e.forEach(function(n){a.add(rM(n,t,r,n,e,o))}):iV(e)&&e.forEach(function(n,s){a.set(s,rM(n,t,r,s,e,o))});var G=l?u?si:ss:u?og:op,K=p?n:G(e);return tu(K||e,function(n,s){K&&(n=e[s=n]),rP(a,s,rM(n,t,r,s,e,o))}),a}function rT(e,t,r){var s=r.length;if(null==e)return!s;for(e=eS(e);s--;){var i=r[s],o=t[i],a=e[i];if(n===a&&!(i in e)||!o(a))return!1}return!0}function r$(e,t,r){if("function"!=typeof e)throw new eO(s);return sC(function(){e.apply(n,r)},t)}function rU(e,t,r,n){var s=-1,i=tf,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;r&&(t=tp(t,tN(r))),n?(i=td,o=!1):t.length>=200&&(i=tM,o=!1,t=new rx(t));e:for(;++s<a;){var h=e[s],l=null==r?h:r(h);if(h=n||0!==h?h:0,o&&l==l){for(var f=u;f--;)if(t[f]===l)continue e;c.push(h)}else i(t,l,n)||c.push(h)}return c}rS.prototype.clear=function(){this.__data__=new rv,this.size=0},rS.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},rS.prototype.get=function(e){return this.__data__.get(e)},rS.prototype.has=function(e){return this.__data__.has(e)},rS.prototype.set=function(e,t){var r=this.__data__;if(r instanceof rv){var n=r.__data__;if(!t9||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new rw(n)}return r.set(e,t),this.size=r.size,this};var rq=nH(rG),rL=nH(rK,!0);function rF(e,t){var r=!0;return rq(e,function(e,n,s){return r=!!t(e,n,s)}),r}function rB(e,t,r){for(var s=-1,i=e.length;++s<i;){var o=e[s],a=t(o);if(null!=a&&(n===c?a==a&&!i1(a):r(a,c)))var c=a,u=o}return u}function rD(e,t){var r=[];return rq(e,function(e,n,s){t(e,n,s)&&r.push(e)}),r}function rz(e,t,r,n,s){var i=-1,o=e.length;for(r||(r=sb),s||(s=[]);++i<o;){var a=e[i];t>0&&r(a)?t>1?rz(a,t-1,r,n,s):tg(s,a):n||(s[s.length]=a)}return s}var rH=nJ(),rJ=nJ(!0);function rG(e,t){return e&&rH(e,t,op)}function rK(e,t){return e&&rJ(e,t,op)}function rW(e,t){return tl(t,function(t){return iH(e[t])})}function rV(e,t){t=nI(t,e);for(var r=0,s=t.length;null!=e&&r<s;)e=e[s$(t[r++])];return r&&r==s?e:n}function rY(e,t,r){var n=t(e);return iU(e)?n:tg(n,r(e))}function rZ(e){var t;return null==e?n===e?"[object Undefined]":"[object Null]":e6&&e6 in eS(e)?function(e){var t=eN.call(e,e6),r=e[e6];try{e[e6]=n;var s=!0}catch(e){}var i=eT.call(e);return s&&(t?e[e6]=r:delete e[e6]),i}(e):(t=e,eT.call(t))}function rX(e,t){return e>t}function rQ(e,t){return null!=e&&eN.call(e,t)}function r0(e,t){return null!=e&&t in eS(e)}function r1(e,t,r){for(var s=r?td:tf,i=e[0].length,o=e.length,a=o,c=eb(o),u=1/0,h=[];a--;){var l=e[a];a&&t&&(l=tp(l,tN(t))),u=t3(l.length,u),c[a]=!r&&(t||i>=120&&l.length>=120)?new rx(a&&l):n}l=e[0];var f=-1,d=c[0];e:for(;++f<i&&h.length<u;){var p=l[f],g=t?t(p):p;if(p=r||0!==p?p:0,!(d?tM(d,g):s(h,g,r))){for(a=o;--a;){var m=c[a];if(!(m?tM(m,g):s(e[a],g,r)))continue e}d&&d.push(g),h.push(p)}}return h}function r2(e,t,r){t=nI(t,e);var s=null==(e=sP(e,t))?e:e[s$(sV(t))];return null==s?n:ta(s,e,r)}function r3(e){return iW(e)&&rZ(e)==h}function r5(e,t,r,s,i){return e===t||(null!=e&&null!=t&&(iW(e)||iW(t))?function(e,t,r,s,i,o){var a=iU(e),c=iU(t),u=a?l:sg(e),g=c?l:sg(t);u=u==h?y:u,g=g==h?y:g;var m=u==y,v=g==y,A=u==g;if(A&&iB(e)){if(!iB(t))return!1;a=!0,m=!1}if(A&&!m)return o||(o=new rS),a||i2(e)?sr(e,t,r,s,i,o):function(e,t,r,n,s,i,o){switch(r){case P:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case O:if(e.byteLength!=t.byteLength||!i(new eB(e),new eB(t)))break;return!0;case f:case d:case b:return iR(+e,+t);case p:return e.name==t.name&&e.message==t.message;case w:case S:return e==t+"";case _:var a=tB;case x:var c=1&n;if(a||(a=tH),e.size!=t.size&&!c)break;var u=o.get(e);if(u)return u==t;n|=2,o.set(e,t);var h=sr(a(e),a(t),n,s,i,o);return o.delete(e),h;case E:if(rf)return rf.call(e)==rf.call(t)}return!1}(e,t,u,r,s,i,o);if(!(1&r)){var k=m&&eN.call(e,"__wrapped__"),j=v&&eN.call(t,"__wrapped__");if(k||j){var C=k?e.value():e,I=j?t.value():t;return o||(o=new rS),i(C,I,r,s,o)}}return!!A&&(o||(o=new rS),function(e,t,r,s,i,o){var a=1&r,c=ss(e),u=c.length;if(u!=ss(t).length&&!a)return!1;for(var h=u;h--;){var l=c[h];if(!(a?l in t:eN.call(t,l)))return!1}var f=o.get(e),d=o.get(t);if(f&&d)return f==t&&d==e;var p=!0;o.set(e,t),o.set(t,e);for(var g=a;++h<u;){var m=e[l=c[h]],_=t[l];if(s)var b=a?s(_,m,l,t,e,o):s(m,_,l,e,t,o);if(!(n===b?m===_||i(m,_,r,s,o):b)){p=!1;break}g||(g="constructor"==l)}if(p&&!g){var y=e.constructor,v=t.constructor;y!=v&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,r,s,i,o))}(e,t,r,s,r5,i):e!=e&&t!=t)}function r4(e,t,r,s){var i=r.length,o=i,a=!s;if(null==e)return!o;for(e=eS(e);i--;){var c=r[i];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++i<o;){var u=(c=r[i])[0],h=e[u],l=c[1];if(a&&c[2]){if(n===h&&!(u in e))return!1}else{var f=new rS;if(s)var d=s(h,l,u,e,t,f);if(!(n===d?r5(l,h,3,s,f):d))return!1}}return!0}function r6(e){var t;return!(!iK(e)||(t=e,eM&&eM in t))&&(iH(e)?eq:eh).test(sU(e))}function r8(e){return"function"==typeof e?e:null==e?oF:"object"==typeof e?iU(e)?nr(e[0],e[1]):nt(e):oV(e)}function r7(e){if(!sE(e))return t1(e);var t=[];for(var r in eS(e))eN.call(e,r)&&"constructor"!=r&&t.push(r);return t}function r9(e,t){return e<t}function ne(e,t){var r=-1,n=iL(e)?eb(e.length):[];return rq(e,function(e,s,i){n[++r]=t(e,s,i)}),n}function nt(e){var t=sl(e);return 1==t.length&&t[0][2]?sA(t[0][0],t[0][1]):function(r){return r===e||r4(r,e,t)}}function nr(e,t){var r;return sw(e)&&(r=t)==r&&!iK(r)?sA(s$(e),t):function(r){var s=ou(r,e);return n===s&&s===t?oh(r,e):r5(t,s,3)}}function nn(e,t,r,s,i){e!==t&&rH(t,function(o,a){if(i||(i=new rS),iK(o))!function(e,t,r,s,i,o,a){var c=sk(e,r),u=sk(t,r),h=a.get(u);if(h)return rO(e,r,h);var l=o?o(c,u,r+"",e,t,a):n,f=n===l;if(f){var d=iU(u),p=!d&&iB(u),g=!d&&!p&&i2(u);l=u,d||p||g?iU(c)?l=c:iF(c)?l=nF(c):p?(f=!1,l=nM(u,!0)):g?(f=!1,l=n$(u,!0)):l=[]:iZ(u)||i$(u)?(l=c,i$(c)?l=oe(c):(!iK(c)||iH(c))&&(l=s_(u))):f=!1}f&&(a.set(u,l),i(l,u,s,o,a),a.delete(u)),rO(e,r,l)}(e,t,a,r,nn,s,i);else{var c=s?s(sk(e,a),o,a+"",e,t,i):n;n===c&&(c=o),rO(e,a,c)}},og)}function ns(e,t){var r=e.length;if(r)return sy(t+=t<0?r:0,r)?e[t]:n}function ni(e,t,r){t=t.length?tp(t,function(e){return iU(e)?function(t){return rV(t,1===e.length?e[0]:e)}:e}):[oF];var n=-1;t=tp(t,tN(su()));var s=ne(e,function(e,r,s){return{criteria:tp(t,function(t){return t(e)}),index:++n,value:e}}),i=s.length;for(s.sort(function(e,t){return function(e,t,r){for(var n=-1,s=e.criteria,i=t.criteria,o=s.length,a=r.length;++n<o;){var c=nU(s[n],i[n]);if(c){if(n>=a)return c;return c*("desc"==r[n]?-1:1)}}return e.index-t.index}(e,t,r)});i--;)s[i]=s[i].value;return s}function no(e,t,r){for(var n=-1,s=t.length,i={};++n<s;){var o=t[n],a=rV(e,o);r(a,o)&&nf(i,nI(o,e),a)}return i}function na(e,t,r,n){var s=n?tS:tx,i=-1,o=t.length,a=e;for(e===t&&(t=nF(t)),r&&(a=tp(e,tN(r)));++i<o;)for(var c=0,u=t[i],h=r?r(u):u;(c=s(a,h,c,n))>-1;)a!==e&&e0.call(a,c,1),e0.call(e,c,1);return e}function nc(e,t){for(var r=e?t.length:0,n=r-1;r--;){var s=t[r];if(r==n||s!==i){var i=s;sy(s)?e0.call(e,s,1):nS(e,s)}}return e}function nu(e,t){return e+tY(t6()*(t-e+1))}function nh(e,t){var r="";if(!e||t<1||t>0x1fffffffffffff)return r;do t%2&&(r+=e),(t=tY(t/2))&&(e+=e);while(t)return r}function nl(e,t){return sI(sO(e,t,oF),e+"")}function nf(e,t,r,s){if(!iK(e))return e;t=nI(t,e);for(var i=-1,o=t.length,a=o-1,c=e;null!=c&&++i<o;){var u=s$(t[i]),h=r;if("__proto__"===u||"constructor"===u||"prototype"===u)break;if(i!=a){var l=c[u];h=s?s(l,u,c):n,n===h&&(h=iK(l)?l:sy(t[i+1])?[]:{})}rP(c,u,h),c=c[u]}return e}var nd=rs?function(e,t){return rs.set(e,t),e}:oF,np=e8?function(e,t){return e8(e,"toString",{configurable:!0,enumerable:!1,value:oU(t),writable:!0})}:oF;function ng(e,t,r){var n=-1,s=e.length;t<0&&(t=-t>s?0:s+t),(r=r>s?s:r)<0&&(r+=s),s=t>r?0:r-t>>>0,t>>>=0;for(var i=eb(s);++n<s;)i[n]=e[n+t];return i}function nm(e,t){var r;return rq(e,function(e,n,s){return!(r=t(e,n,s))}),!!r}function n_(e,t,r){var n=0,s=null==e?n:e.length;if("number"==typeof t&&t==t&&s<=0x7fffffff){for(;n<s;){var i=n+s>>>1,o=e[i];null!==o&&!i1(o)&&(r?o<=t:o<t)?n=i+1:s=i}return s}return nb(e,t,oF,r)}function nb(e,t,r,s){var i=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=r(t))!=t,c=null===t,u=i1(t),h=n===t;i<o;){var l=tY((i+o)/2),f=r(e[l]),d=n!==f,p=null===f,g=f==f,m=i1(f);if(a)var _=s||g;else _=h?g&&(s||d):c?g&&d&&(s||!p):u?g&&d&&!p&&(s||!m):!p&&!m&&(s?f<=t:f<t);_?i=l+1:o=l}return t3(o,0xfffffffe)}function ny(e,t){for(var r=-1,n=e.length,s=0,i=[];++r<n;){var o=e[r],a=t?t(o):o;if(!r||!iR(a,c)){var c=a;i[s++]=0===o?0:o}}return i}function nv(e){return"number"==typeof e?e:i1(e)?c:+e}function nw(e){if("string"==typeof e)return e;if(iU(e))return tp(e,nw)+"";if(i1(e))return rd?rd.call(e):"";var t=e+"";return"0"==t&&1/e==-a?"-0":t}function nx(e,t,r){var n=-1,s=tf,i=e.length,o=!0,a=[],c=a;if(r)o=!1,s=td;else if(i>=200){var u=t?null:n6(e);if(u)return tH(u);o=!1,s=tM,c=new rx}else c=t?[]:a;e:for(;++n<i;){var h=e[n],l=t?t(h):h;if(h=r||0!==h?h:0,o&&l==l){for(var f=c.length;f--;)if(c[f]===l)continue e;t&&c.push(l),a.push(h)}else s(c,l,r)||(c!==a&&c.push(l),a.push(h))}return a}function nS(e,t){return t=nI(t,e),null==(e=sP(e,t))||delete e[s$(sV(t))]}function nE(e,t,r,n){return nf(e,t,r(rV(e,t)),n)}function nA(e,t,r,n){for(var s=e.length,i=n?s:-1;(n?i--:++i<s)&&t(e[i],i,e););return r?ng(e,n?0:i,n?i+1:s):ng(e,n?i+1:0,n?s:i)}function nO(e,t){var r=e;return r instanceof rb&&(r=r.value()),tm(t,function(e,t){return t.func.apply(t.thisArg,tg([e],t.args))},r)}function nP(e,t,r){var n=e.length;if(n<2)return n?nx(e[0]):[];for(var s=-1,i=eb(n);++s<n;)for(var o=e[s],a=-1;++a<n;)a!=s&&(i[s]=rU(i[s]||o,e[a],t,r));return nx(rz(i,1),t,r)}function nk(e,t,r){for(var s=-1,i=e.length,o=t.length,a={};++s<i;){var c=s<o?t[s]:n;r(a,e[s],c)}return a}function nj(e){return iF(e)?e:[]}function nC(e){return"function"==typeof e?e:oF}function nI(e,t){return iU(e)?e:sw(e,t)?[e]:sT(ot(e))}function nN(e,t,r){var s=e.length;return r=n===r?s:r,!t&&r>=s?e:ng(e,t,r)}var nR=e9||function(e){return e4.clearTimeout(e)};function nM(e,t){if(t)return e.slice();var r=e.length,n=eD?eD(r):new e.constructor(r);return e.copy(n),n}function nT(e){var t=new e.constructor(e.byteLength);return new eB(t).set(new eB(e)),t}function n$(e,t){var r=t?nT(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function nU(e,t){if(e!==t){var r=n!==e,s=null===e,i=e==e,o=i1(e),a=n!==t,c=null===t,u=t==t,h=i1(t);if(!c&&!h&&!o&&e>t||o&&a&&u&&!c&&!h||s&&a&&u||!r&&u||!i)return 1;if(!s&&!o&&!h&&e<t||h&&r&&i&&!s&&!o||c&&r&&i||!a&&i||!u)return -1}return 0}function nq(e,t,r,n){for(var s=-1,i=e.length,o=r.length,a=-1,c=t.length,u=t2(i-o,0),h=eb(c+u),l=!n;++a<c;)h[a]=t[a];for(;++s<o;)(l||s<i)&&(h[r[s]]=e[s]);for(;u--;)h[a++]=e[s++];return h}function nL(e,t,r,n){for(var s=-1,i=e.length,o=-1,a=r.length,c=-1,u=t.length,h=t2(i-a,0),l=eb(h+u),f=!n;++s<h;)l[s]=e[s];for(var d=s;++c<u;)l[d+c]=t[c];for(;++o<a;)(f||s<i)&&(l[d+r[o]]=e[s++]);return l}function nF(e,t){var r=-1,n=e.length;for(t||(t=eb(n));++r<n;)t[r]=e[r];return t}function nB(e,t,r,s){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var c=t[o],u=s?s(r[c],e[c],c,r,e):n;n===u&&(u=e[c]),i?rI(r,c,u):rP(r,c,u)}return r}function nD(e,t){return function(r,n){var s=iU(r)?tc:rj,i=t?t():{};return s(r,e,su(n,2),i)}}function nz(e){return nl(function(t,r){var s=-1,i=r.length,o=i>1?r[i-1]:n,a=i>2?r[2]:n;for(o=e.length>3&&"function"==typeof o?(i--,o):n,a&&sv(r[0],r[1],a)&&(o=i<3?n:o,i=1),t=eS(t);++s<i;){var c=r[s];c&&e(t,c,s,o)}return t})}function nH(e,t){return function(r,n){if(null==r)return r;if(!iL(r))return e(r,n);for(var s=r.length,i=t?s:-1,o=eS(r);(t?i--:++i<s)&&!1!==n(o[i],i,o););return r}}function nJ(e){return function(t,r,n){for(var s=-1,i=eS(t),o=n(t),a=o.length;a--;){var c=o[e?a:++s];if(!1===r(i[c],c,i))break}return t}}function nG(e){return function(t){var r=tF(t=ot(t))?tG(t):n,s=r?r[0]:t.charAt(0),i=r?nN(r,1).join(""):t.slice(1);return s[e]()+i}}function nK(e){return function(t){return tm(oM(oO(t).replace(eH,"")),e,"")}}function nW(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=rg(e.prototype),n=e.apply(r,t);return iK(n)?n:r}}function nV(e){return function(t,r,s){var i=eS(t);if(!iL(t)){var o=su(r,3);t=op(t),r=function(e){return o(i[e],e,i)}}var a=e(t,r,s);return a>-1?i[o?t[a]:a]:n}}function nY(e){return sn(function(t){var r=t.length,i=r,o=r_.prototype.thru;for(e&&t.reverse();i--;){var a=t[i];if("function"!=typeof a)throw new eO(s);if(o&&!c&&"wrapper"==sa(a))var c=new r_([],!0)}for(i=c?i:r;++i<r;){var u=sa(a=t[i]),h="wrapper"==u?so(a):n;c=h&&sx(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?c[sa(h[0])].apply(c,h[3]):1==a.length&&sx(a)?c[u]():c.thru(a)}return function(){var e=arguments,n=e[0];if(c&&1==e.length&&iU(n))return c.plant(n).value();for(var s=0,i=r?t[s].apply(this,e):n;++s<r;)i=t[s].call(this,i);return i}})}function nZ(e,t,r,s,i,o,a,c,u,h){var l=128&t,f=1&t,d=2&t,p=24&t,g=512&t,m=d?n:nW(e);function _(){for(var b=arguments.length,y=eb(b),v=b;v--;)y[v]=arguments[v];if(p)var w=sc(_),x=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(y,w);if(s&&(y=nq(y,s,i,p)),o&&(y=nL(y,o,a,p)),b-=x,p&&b<h){var S=tz(y,w);return n5(e,t,nZ,_.placeholder,r,y,S,c,u,h-b)}var E=f?r:this,A=d?E[e]:e;return b=y.length,c?y=function(e,t){for(var r=e.length,s=t3(t.length,r),i=nF(e);s--;){var o=t[s];e[s]=sy(o,r)?i[o]:n}return e}(y,c):g&&b>1&&y.reverse(),l&&u<b&&(y.length=u),this&&this!==e4&&this instanceof _&&(A=m||nW(A)),A.apply(E,y)}return _}function nX(e,t){return function(r,n){var s,i;return s=t(n),i={},rG(r,function(t,r,n){e(i,s(t),r,n)}),i}}function nQ(e,t){return function(r,s){var i;if(n===r&&n===s)return t;if(n!==r&&(i=r),n!==s){if(n===i)return s;"string"==typeof r||"string"==typeof s?(r=nw(r),s=nw(s)):(r=nv(r),s=nv(s)),i=e(r,s)}return i}}function n0(e){return sn(function(t){return t=tp(t,tN(su())),nl(function(r){var n=this;return e(t,function(e){return ta(e,n,r)})})})}function n1(e,t){var r=(t=n===t?" ":nw(t)).length;if(r<2)return r?nh(t,e):t;var s=nh(t,tP(e/tJ(t)));return tF(t)?nN(tG(s),0,e).join(""):s.slice(0,e)}function n2(e){return function(t,r,s){s&&"number"!=typeof s&&sv(t,r,s)&&(r=s=n),t=i6(t),n===r?(r=t,t=0):r=i6(r),s=n===s?t<r?1:-1:i6(s);for(var i=t,o=r,a=s,c=-1,u=t2(tP((o-i)/(a||1)),0),h=eb(u);u--;)h[e?u:++c]=i,i+=a;return h}}function n3(e){return function(t,r){return("string"!=typeof t||"string"!=typeof r)&&(t=i9(t),r=i9(r)),e(t,r)}}function n5(e,t,r,s,i,o,a,c,u,h){var l=8&t,f=l?a:n,d=l?n:a,p=l?o:n,g=l?n:o;t|=l?32:64,4&(t&=~(l?64:32))||(t&=-4);var m=[e,t,i,p,f,g,d,c,u,h],_=r.apply(n,m);return sx(e)&&sj(_,m),_.placeholder=s,sN(_,e,t)}function n4(e){var t=ex[e];return function(e,r){if(e=i9(e),(r=null==r?0:t3(i8(r),292))&&tQ(e)){var n=(ot(e)+"e").split("e");return+((n=(ot(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(n[1]-r))}return t(e)}}var n6=rt&&1/tH(new rt([,-0]))[1]==a?function(e){return new rt(e)}:oJ;function n8(e){return function(t){var r,n,s=sg(t);return s==_?tB(t):s==x?(r=-1,n=Array(t.size),t.forEach(function(e){n[++r]=[e,e]}),n):tp(e(t),function(e){return[e,t[e]]})}}function n7(e,t,r,i,a,c,u,h){var l=2&t;if(!l&&"function"!=typeof e)throw new eO(s);var f=i?i.length:0;if(f||(t&=-97,i=a=n),u=n===u?u:t2(i8(u),0),h=n===h?h:i8(h),f-=a?a.length:0,64&t){var d=i,p=a;i=a=n}var g=l?n:so(e),m=[e,t,r,i,a,d,p,c,u,h];if(g&&function(e,t){var r=e[1],n=t[1],s=r|n,i=s<131,a=128==n&&8==r||128==n&&256==r&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==r;if(i||a){1&n&&(e[2]=t[2],s|=1&r?0:4);var c=t[3];if(c){var u=e[3];e[3]=u?nq(u,c,t[4]):c,e[4]=u?tz(e[3],o):t[4]}(c=t[5])&&(u=e[5],e[5]=u?nL(u,c,t[6]):c,e[6]=u?tz(e[5],o):t[6]),(c=t[7])&&(e[7]=c),128&n&&(e[8]=null==e[8]?t[8]:t3(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=s}}(m,g),e=m[0],t=m[1],r=m[2],i=m[3],a=m[4],(h=m[9]=m[9]===n?l?0:e.length:t2(m[9]-f,0))||!(24&t)||(t&=-25),t&&1!=t)8==t||16==t?k=function(e,t,r){var s=nW(e);function i(){for(var o=arguments.length,a=eb(o),c=o,u=sc(i);c--;)a[c]=arguments[c];var h=o<3&&a[0]!==u&&a[o-1]!==u?[]:tz(a,u);return(o-=h.length)<r?n5(e,t,nZ,i.placeholder,n,a,h,n,n,r-o):ta(this&&this!==e4&&this instanceof i?s:e,this,a)}return i}(e,t,h):32!=t&&33!=t||a.length?k=nZ.apply(n,m):(_=e,b=t,y=r,v=i,w=1&b,x=nW(_),k=function e(){for(var t=-1,r=arguments.length,n=-1,s=v.length,i=eb(s+r),o=this&&this!==e4&&this instanceof e?x:_;++n<s;)i[n]=v[n];for(;r--;)i[n++]=arguments[++t];return ta(o,w?y:this,i)});else var _,b,y,v,w,x,S,E,A,O,P,k=(S=e,E=t,A=r,O=1&E,P=nW(S),function e(){return(this&&this!==e4&&this instanceof e?P:S).apply(O?A:this,arguments)});return sN((g?nd:sj)(k,m),e,t)}function n9(e,t,r,s){return n===e||iR(e,ej[r])&&!eN.call(s,r)?t:e}function se(e,t,r,s,i,o){return iK(e)&&iK(t)&&(o.set(t,e),nn(e,t,n,se,o),o.delete(t)),e}function st(e){return iZ(e)?n:e}function sr(e,t,r,s,i,o){var a=1&r,c=e.length,u=t.length;if(c!=u&&!(a&&u>c))return!1;var h=o.get(e),l=o.get(t);if(h&&l)return h==t&&l==e;var f=-1,d=!0,p=2&r?new rx:n;for(o.set(e,t),o.set(t,e);++f<c;){var g=e[f],m=t[f];if(s)var _=a?s(m,g,f,t,e,o):s(g,m,f,e,t,o);if(n!==_){if(_)continue;d=!1;break}if(p){if(!tb(t,function(e,t){if(!tM(p,t)&&(g===e||i(g,e,r,s,o)))return p.push(t)})){d=!1;break}}else if(!(g===m||i(g,m,r,s,o))){d=!1;break}}return o.delete(e),o.delete(t),d}function sn(e){return sI(sO(e,n,sH),e+"")}function ss(e){return rY(e,op,sd)}function si(e){return rY(e,og,sp)}var so=rs?function(e){return rs.get(e)}:oJ;function sa(e){for(var t=e.name+"",r=ri[t],n=eN.call(ri,t)?r.length:0;n--;){var s=r[n],i=s.func;if(null==i||i==e)return s.name}return t}function sc(e){return(eN.call(rp,"placeholder")?rp:e).placeholder}function su(){var e=rp.iteratee||oB;return e=e===oB?r8:e,arguments.length?e(arguments[0],arguments[1]):e}function sh(e,t){var r,n,s=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?s["string"==typeof t?"string":"hash"]:s.map}function sl(e){for(var t=op(e),r=t.length;r--;){var n,s=t[r],i=e[s];t[r]=[s,i,(n=i)==n&&!iK(n)]}return t}function sf(e,t){var r=null==e?n:e[t];return r6(r)?r:n}var sd=tZ?function(e){return null==e?[]:tl(tZ(e=eS(e)),function(t){return eW.call(e,t)})}:oX,sp=tZ?function(e){for(var t=[];e;)tg(t,sd(e)),e=ez(e);return t}:oX,sg=rZ;function sm(e,t,r){t=nI(t,e);for(var n=-1,s=t.length,i=!1;++n<s;){var o=s$(t[n]);if(!(i=null!=e&&r(e,o)))break;e=e[o]}return i||++n!=s?i:!!(s=null==e?0:e.length)&&iG(s)&&sy(o,s)&&(iU(e)||i$(e))}function s_(e){return"function"!=typeof e.constructor||sE(e)?{}:rg(ez(e))}function sb(e){return iU(e)||i$(e)||!!(e3&&e&&e[e3])}function sy(e,t){var r=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==r||"symbol"!=r&&ef.test(e))&&e>-1&&e%1==0&&e<t}function sv(e,t,r){if(!iK(r))return!1;var n=typeof t;return("number"==n?!!(iL(r)&&sy(t,r.length)):"string"==n&&t in r)&&iR(r[t],e)}function sw(e,t){if(iU(e))return!1;var r=typeof e;return!!("number"==r||"symbol"==r||"boolean"==r||null==e||i1(e))||W.test(e)||!K.test(e)||null!=t&&e in eS(t)}function sx(e){var t=sa(e),r=rp[t];if("function"!=typeof r||!(t in rb.prototype))return!1;if(e===r)return!0;var n=so(r);return!!n&&e===n[0]}(t7&&sg(new t7(new ArrayBuffer(1)))!=P||t9&&sg(new t9)!=_||re&&sg(re.resolve())!=v||rt&&sg(new rt)!=x||rr&&sg(new rr)!=A)&&(sg=function(e){var t=rZ(e),r=t==y?e.constructor:n,s=r?sU(r):"";if(s)switch(s){case ro:return P;case ra:return _;case rc:return v;case ru:return x;case rh:return A}return t});var sS=eC?iH:oQ;function sE(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ej)}function sA(e,t){return function(r){return null!=r&&r[e]===t&&(n!==t||e in eS(r))}}function sO(e,t,r){return t=t2(n===t?e.length-1:t,0),function(){for(var n=arguments,s=-1,i=t2(n.length-t,0),o=eb(i);++s<i;)o[s]=n[t+s];s=-1;for(var a=eb(t+1);++s<t;)a[s]=n[s];return a[t]=r(o),ta(e,this,a)}}function sP(e,t){return t.length<2?e:rV(e,ng(t,0,-1))}function sk(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var sj=sR(nd),sC=ty||function(e,t){return e4.setTimeout(e,t)},sI=sR(np);function sN(e,t,r){var n,s,i,o=t+"";return sI(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(ee,"{\n/* [wrapped with "+t+"] */\n")}(o,(n=(i=o.match(et))?i[1].split(er):[],s=r,tu(u,function(e){var t="_."+e[0];s&e[1]&&!tf(n,t)&&n.push(t)}),n.sort())))}function sR(e){var t=0,r=0;return function(){var s=t5(),i=16-(s-r);if(r=s,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(n,arguments)}}function sM(e,t){var r=-1,s=e.length,i=s-1;for(t=n===t?s:t;++r<t;){var o=nu(r,i),a=e[o];e[o]=e[r],e[r]=a}return e.length=t,e}var sT=(em=(Q=iP(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(V,function(e,r,n,s){t.push(n?s.replace(ei,"$1"):r||e)}),t},function(e){return 500===em.size&&em.clear(),e})).cache,Q);function s$(e){if("string"==typeof e||i1(e))return e;var t=e+"";return"0"==t&&1/e==-a?"-0":t}function sU(e){if(null!=e){try{return eI.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function sq(e){if(e instanceof rb)return e.clone();var t=new r_(e.__wrapped__,e.__chain__);return t.__actions__=nF(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var sL=nl(function(e,t){return iF(e)?rU(e,rz(t,1,iF,!0)):[]}),sF=nl(function(e,t){var r=sV(t);return iF(r)&&(r=n),iF(e)?rU(e,rz(t,1,iF,!0),su(r,2)):[]}),sB=nl(function(e,t){var r=sV(t);return iF(r)&&(r=n),iF(e)?rU(e,rz(t,1,iF,!0),n,r):[]});function sD(e,t,r){var n=null==e?0:e.length;if(!n)return -1;var s=null==r?0:i8(r);return s<0&&(s=t2(n+s,0)),tw(e,su(t,3),s)}function sz(e,t,r){var s=null==e?0:e.length;if(!s)return -1;var i=s-1;return n!==r&&(i=i8(r),i=r<0?t2(s+i,0):t3(i,s-1)),tw(e,su(t,3),i,!0)}function sH(e){return(null==e?0:e.length)?rz(e,1):[]}function sJ(e){return e&&e.length?e[0]:n}var sG=nl(function(e){var t=tp(e,nj);return t.length&&t[0]===e[0]?r1(t):[]}),sK=nl(function(e){var t=sV(e),r=tp(e,nj);return t===sV(r)?t=n:r.pop(),r.length&&r[0]===e[0]?r1(r,su(t,2)):[]}),sW=nl(function(e){var t=sV(e),r=tp(e,nj);return(t="function"==typeof t?t:n)&&r.pop(),r.length&&r[0]===e[0]?r1(r,n,t):[]});function sV(e){var t=null==e?0:e.length;return t?e[t-1]:n}var sY=nl(sZ);function sZ(e,t){return e&&e.length&&t&&t.length?na(e,t):e}var sX=sn(function(e,t){var r=null==e?0:e.length,n=rN(e,t);return nc(e,tp(t,function(e){return sy(e,r)?+e:e}).sort(nU)),n});function sQ(e){return null==e?e:t8.call(e)}var s0=nl(function(e){return nx(rz(e,1,iF,!0))}),s1=nl(function(e){var t=sV(e);return iF(t)&&(t=n),nx(rz(e,1,iF,!0),su(t,2))}),s2=nl(function(e){var t=sV(e);return t="function"==typeof t?t:n,nx(rz(e,1,iF,!0),n,t)});function s3(e){if(!(e&&e.length))return[];var t=0;return e=tl(e,function(e){if(iF(e))return t=t2(e.length,t),!0}),tC(t,function(t){return tp(e,tO(t))})}function s5(e,t){if(!(e&&e.length))return[];var r=s3(e);return null==t?r:tp(r,function(e){return ta(t,n,e)})}var s4=nl(function(e,t){return iF(e)?rU(e,t):[]}),s6=nl(function(e){return nP(tl(e,iF))}),s8=nl(function(e){var t=sV(e);return iF(t)&&(t=n),nP(tl(e,iF),su(t,2))}),s7=nl(function(e){var t=sV(e);return t="function"==typeof t?t:n,nP(tl(e,iF),n,t)}),s9=nl(s3),ie=nl(function(e){var t=e.length,r=t>1?e[t-1]:n;return r="function"==typeof r?(e.pop(),r):n,s5(e,r)});function it(e){var t=rp(e);return t.__chain__=!0,t}function ir(e,t){return t(e)}var is=sn(function(e){var t=e.length,r=t?e[0]:0,s=this.__wrapped__,i=function(t){return rN(t,e)};return!(t>1)&&!this.__actions__.length&&s instanceof rb&&sy(r)?((s=s.slice(r,+r+ +!!t)).__actions__.push({func:ir,args:[i],thisArg:n}),new r_(s,this.__chain__).thru(function(e){return t&&!e.length&&e.push(n),e})):this.thru(i)}),ii=nD(function(e,t,r){eN.call(e,r)?++e[r]:rI(e,r,1)}),io=nV(sD),ia=nV(sz);function ic(e,t){return(iU(e)?tu:rq)(e,su(t,3))}function iu(e,t){return(iU(e)?function(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}:rL)(e,su(t,3))}var ih=nD(function(e,t,r){eN.call(e,r)?e[r].push(t):rI(e,r,[t])}),il=nl(function(e,t,r){var n=-1,s="function"==typeof t,i=iL(e)?eb(e.length):[];return rq(e,function(e){i[++n]=s?ta(t,e,r):r2(e,t,r)}),i}),id=nD(function(e,t,r){rI(e,r,t)});function ip(e,t){return(iU(e)?tp:ne)(e,su(t,3))}var ig=nD(function(e,t,r){e[+!r].push(t)},function(){return[[],[]]}),im=nl(function(e,t){if(null==e)return[];var r=t.length;return r>1&&sv(e,t[0],t[1])?t=[]:r>2&&sv(t[0],t[1],t[2])&&(t=[t[0]]),ni(e,rz(t,1),[])}),i_=te||function(){return e4.Date.now()};function ib(e,t,r){return t=r?n:t,t=e&&null==t?e.length:t,n7(e,128,n,n,n,n,t)}function iy(e,t){var r;if("function"!=typeof t)throw new eO(s);return e=i8(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=n),r}}var iv=nl(function(e,t,r){var n=1;if(r.length){var s=tz(r,sc(iv));n|=32}return n7(e,n,t,r,s)}),iw=nl(function(e,t,r){var n=3;if(r.length){var s=tz(r,sc(iw));n|=32}return n7(t,n,e,r,s)});function ix(e,t,r){t=r?n:t;var s=n7(e,8,n,n,n,n,n,t);return s.placeholder=ix.placeholder,s}function iS(e,t,r){t=r?n:t;var s=n7(e,16,n,n,n,n,n,t);return s.placeholder=iS.placeholder,s}function iE(e,t,r){var i,o,a,c,u,h,l=0,f=!1,d=!1,p=!0;if("function"!=typeof e)throw new eO(s);function g(t){var r=i,s=o;return i=o=n,l=t,c=e.apply(s,r)}function m(e){var r=e-h,s=e-l;return n===h||r>=t||r<0||d&&s>=a}function _(){var e,r,n,s=i_();if(m(s))return b(s);u=sC(_,(e=s-h,r=s-l,n=t-e,d?t3(n,a-r):n))}function b(e){return(u=n,p&&i)?g(e):(i=o=n,c)}function y(){var e,r=i_(),s=m(r);if(i=arguments,o=this,h=r,s){if(n===u)return l=e=h,u=sC(_,t),f?g(e):c;if(d)return nR(u),u=sC(_,t),g(h)}return n===u&&(u=sC(_,t)),c}return t=i9(t)||0,iK(r)&&(f=!!r.leading,a=(d="maxWait"in r)?t2(i9(r.maxWait)||0,t):a,p="trailing"in r?!!r.trailing:p),y.cancel=function(){n!==u&&nR(u),l=0,i=h=o=u=n},y.flush=function(){return n===u?c:b(i_())},y}var iA=nl(function(e,t){return r$(e,1,t)}),iO=nl(function(e,t,r){return r$(e,i9(t)||0,r)});function iP(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new eO(s);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],i=r.cache;if(i.has(s))return i.get(s);var o=e.apply(this,n);return r.cache=i.set(s,o)||i,o};return r.cache=new(iP.Cache||rw),r}function ik(e){if("function"!=typeof e)throw new eO(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}iP.Cache=rw;var ij=nl(function(e,t){var r=(t=1==t.length&&iU(t[0])?tp(t[0],tN(su())):tp(rz(t,1),tN(su()))).length;return nl(function(n){for(var s=-1,i=t3(n.length,r);++s<i;)n[s]=t[s].call(this,n[s]);return ta(e,this,n)})}),iC=nl(function(e,t){var r=tz(t,sc(iC));return n7(e,32,n,t,r)}),iI=nl(function(e,t){var r=tz(t,sc(iI));return n7(e,64,n,t,r)}),iN=sn(function(e,t){return n7(e,256,n,n,n,t)});function iR(e,t){return e===t||e!=e&&t!=t}var iM=n3(rX),iT=n3(function(e,t){return e>=t}),i$=r3(function(){return arguments}())?r3:function(e){return iW(e)&&eN.call(e,"callee")&&!eW.call(e,"callee")},iU=eb.isArray,iq=tt?tN(tt):function(e){return iW(e)&&rZ(e)==O};function iL(e){return null!=e&&iG(e.length)&&!iH(e)}function iF(e){return iW(e)&&iL(e)}var iB=tX||oQ,iD=tr?tN(tr):function(e){return iW(e)&&rZ(e)==d};function iz(e){if(!iW(e))return!1;var t=rZ(e);return t==p||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!iZ(e)}function iH(e){if(!iK(e))return!1;var t=rZ(e);return t==g||t==m||"[object AsyncFunction]"==t||"[object Proxy]"==t}function iJ(e){return"number"==typeof e&&e==i8(e)}function iG(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff}function iK(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function iW(e){return null!=e&&"object"==typeof e}var iV=tn?tN(tn):function(e){return iW(e)&&sg(e)==_};function iY(e){return"number"==typeof e||iW(e)&&rZ(e)==b}function iZ(e){if(!iW(e)||rZ(e)!=y)return!1;var t=ez(e);if(null===t)return!0;var r=eN.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&eI.call(r)==e$}var iX=ts?tN(ts):function(e){return iW(e)&&rZ(e)==w},iQ=ti?tN(ti):function(e){return iW(e)&&sg(e)==x};function i0(e){return"string"==typeof e||!iU(e)&&iW(e)&&rZ(e)==S}function i1(e){return"symbol"==typeof e||iW(e)&&rZ(e)==E}var i2=to?tN(to):function(e){return iW(e)&&iG(e.length)&&!!eX[rZ(e)]},i3=n3(r9),i5=n3(function(e,t){return e<=t});function i4(e){if(!e)return[];if(iL(e))return i0(e)?tG(e):nF(e);if(e5&&e[e5]){for(var t,r=e[e5](),n=[];!(t=r.next()).done;)n.push(t.value);return n}var s=sg(e);return(s==_?tB:s==x?tH:oS)(e)}function i6(e){return e?(e=i9(e))===a||e===-a?(e<0?-1:1)*17976931348623157e292:e==e?e:0:0===e?e:0}function i8(e){var t=i6(e),r=t%1;return t==t?r?t-r:t:0}function i7(e){return e?rR(i8(e),0,0xffffffff):0}function i9(e){if("number"==typeof e)return e;if(i1(e))return c;if(iK(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=iK(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=tI(e);var r=eu.test(e);return r||el.test(e)?e2(e.slice(2),r?2:8):ec.test(e)?c:+e}function oe(e){return nB(e,og(e))}function ot(e){return null==e?"":nw(e)}var or=nz(function(e,t){if(sE(t)||iL(t))return void nB(t,op(t),e);for(var r in t)eN.call(t,r)&&rP(e,r,t[r])}),on=nz(function(e,t){nB(t,og(t),e)}),os=nz(function(e,t,r,n){nB(t,og(t),e,n)}),oi=nz(function(e,t,r,n){nB(t,op(t),e,n)}),oo=sn(rN),oa=nl(function(e,t){e=eS(e);var r=-1,s=t.length,i=s>2?t[2]:n;for(i&&sv(t[0],t[1],i)&&(s=1);++r<s;)for(var o=t[r],a=og(o),c=-1,u=a.length;++c<u;){var h=a[c],l=e[h];(n===l||iR(l,ej[h])&&!eN.call(e,h))&&(e[h]=o[h])}return e}),oc=nl(function(e){return e.push(n,se),ta(o_,n,e)});function ou(e,t,r){var s=null==e?n:rV(e,t);return n===s?r:s}function oh(e,t){return null!=e&&sm(e,t,r0)}var ol=nX(function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=eT.call(t)),e[t]=r},oU(oF)),of=nX(function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=eT.call(t)),eN.call(e,t)?e[t].push(r):e[t]=[r]},su),od=nl(r2);function op(e){return iL(e)?rE(e):r7(e)}function og(e){return iL(e)?rE(e,!0):function(e){if(!iK(e)){var t=e,r=[];if(null!=t)for(var n in eS(t))r.push(n);return r}var s=sE(e),i=[];for(var o in e)"constructor"==o&&(s||!eN.call(e,o))||i.push(o);return i}(e)}var om=nz(function(e,t,r){nn(e,t,r)}),o_=nz(function(e,t,r,n){nn(e,t,r,n)}),ob=sn(function(e,t){var r={};if(null==e)return r;var n=!1;t=tp(t,function(t){return t=nI(t,e),n||(n=t.length>1),t}),nB(e,si(e),r),n&&(r=rM(r,7,st));for(var s=t.length;s--;)nS(r,t[s]);return r}),oy=sn(function(e,t){return null==e?{}:no(e,t,function(t,r){return oh(e,r)})});function ov(e,t){if(null==e)return{};var r=tp(si(e),function(e){return[e]});return t=su(t),no(e,r,function(e,r){return t(e,r[0])})}var ow=n8(op),ox=n8(og);function oS(e){return null==e?[]:tR(e,op(e))}var oE=nK(function(e,t,r){return t=t.toLowerCase(),e+(r?oA(t):t)});function oA(e){return oR(ot(e).toLowerCase())}function oO(e){return(e=ot(e))&&e.replace(ed,tU).replace(eJ,"")}var oP=nK(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),ok=nK(function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}),oj=nG("toLowerCase"),oC=nK(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}),oI=nK(function(e,t,r){return e+(r?" ":"")+oR(t)}),oN=nK(function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}),oR=nG("toUpperCase");function oM(e,t,r){if(e=ot(e),t=r?n:t,n===t){var s;return(s=e,eV.test(s))?e.match(eK)||[]:e.match(en)||[]}return e.match(t)||[]}var oT=nl(function(e,t){try{return ta(e,n,t)}catch(e){return iz(e)?e:new ev(e)}}),o$=sn(function(e,t){return tu(t,function(t){rI(e,t=s$(t),iv(e[t],e))}),e});function oU(e){return function(){return e}}var oq=nY(),oL=nY(!0);function oF(e){return e}function oB(e){return r8("function"==typeof e?e:rM(e,1))}var oD=nl(function(e,t){return function(r){return r2(r,e,t)}}),oz=nl(function(e,t){return function(r){return r2(e,r,t)}});function oH(e,t,r){var n=op(t),s=rW(t,n);null!=r||iK(t)&&(s.length||!n.length)||(r=t,t=e,e=this,s=rW(t,op(t)));var i=!(iK(r)&&"chain"in r)||!!r.chain,o=iH(e);return tu(s,function(r){var n=t[r];e[r]=n,o&&(e.prototype[r]=function(){var t=this.__chain__;if(i||t){var r=e(this.__wrapped__);return(r.__actions__=nF(this.__actions__)).push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,tg([this.value()],arguments))})}),e}function oJ(){}var oG=n0(tp),oK=n0(th),oW=n0(tb);function oV(e){return sw(e)?tO(s$(e)):function(t){return rV(t,e)}}var oY=n2(),oZ=n2(!0);function oX(){return[]}function oQ(){return!1}var o0=nQ(function(e,t){return e+t},0),o1=n4("ceil"),o2=nQ(function(e,t){return e/t},1),o3=n4("floor"),o5=nQ(function(e,t){return e*t},1),o4=n4("round"),o6=nQ(function(e,t){return e-t},0);return rp.after=function(e,t){if("function"!=typeof t)throw new eO(s);return e=i8(e),function(){if(--e<1)return t.apply(this,arguments)}},rp.ary=ib,rp.assign=or,rp.assignIn=on,rp.assignInWith=os,rp.assignWith=oi,rp.at=oo,rp.before=iy,rp.bind=iv,rp.bindAll=o$,rp.bindKey=iw,rp.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return iU(e)?e:[e]},rp.chain=it,rp.chunk=function(e,t,r){t=(r?sv(e,t,r):n===t)?1:t2(i8(t),0);var s=null==e?0:e.length;if(!s||t<1)return[];for(var i=0,o=0,a=eb(tP(s/t));i<s;)a[o++]=ng(e,i,i+=t);return a},rp.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,s=[];++t<r;){var i=e[t];i&&(s[n++]=i)}return s},rp.concat=function(){var e=arguments.length;if(!e)return[];for(var t=eb(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return tg(iU(r)?nF(r):[r],rz(t,1))},rp.cond=function(e){var t=null==e?0:e.length,r=su();return e=t?tp(e,function(e){if("function"!=typeof e[1])throw new eO(s);return[r(e[0]),e[1]]}):[],nl(function(r){for(var n=-1;++n<t;){var s=e[n];if(ta(s[0],this,r))return ta(s[1],this,r)}})},rp.conforms=function(e){var t,r;return r=op(t=rM(e,1)),function(e){return rT(e,t,r)}},rp.constant=oU,rp.countBy=ii,rp.create=function(e,t){var r=rg(e);return null==t?r:rC(r,t)},rp.curry=ix,rp.curryRight=iS,rp.debounce=iE,rp.defaults=oa,rp.defaultsDeep=oc,rp.defer=iA,rp.delay=iO,rp.difference=sL,rp.differenceBy=sF,rp.differenceWith=sB,rp.drop=function(e,t,r){var s=null==e?0:e.length;return s?ng(e,(t=r||n===t?1:i8(t))<0?0:t,s):[]},rp.dropRight=function(e,t,r){var s=null==e?0:e.length;return s?ng(e,0,(t=s-(t=r||n===t?1:i8(t)))<0?0:t):[]},rp.dropRightWhile=function(e,t){return e&&e.length?nA(e,su(t,3),!0,!0):[]},rp.dropWhile=function(e,t){return e&&e.length?nA(e,su(t,3),!0):[]},rp.fill=function(e,t,r,s){var i=null==e?0:e.length;if(!i)return[];r&&"number"!=typeof r&&sv(e,t,r)&&(r=0,s=i);var o=r,a=s,c=e.length;for((o=i8(o))<0&&(o=-o>c?0:c+o),(a=n===a||a>c?c:i8(a))<0&&(a+=c),a=o>a?0:i7(a);o<a;)e[o++]=t;return e},rp.filter=function(e,t){return(iU(e)?tl:rD)(e,su(t,3))},rp.flatMap=function(e,t){return rz(ip(e,t),1)},rp.flatMapDeep=function(e,t){return rz(ip(e,t),a)},rp.flatMapDepth=function(e,t,r){return r=n===r?1:i8(r),rz(ip(e,t),r)},rp.flatten=sH,rp.flattenDeep=function(e){return(null==e?0:e.length)?rz(e,a):[]},rp.flattenDepth=function(e,t){return(null==e?0:e.length)?rz(e,t=n===t?1:i8(t)):[]},rp.flip=function(e){return n7(e,512)},rp.flow=oq,rp.flowRight=oL,rp.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var s=e[t];n[s[0]]=s[1]}return n},rp.functions=function(e){return null==e?[]:rW(e,op(e))},rp.functionsIn=function(e){return null==e?[]:rW(e,og(e))},rp.groupBy=ih,rp.initial=function(e){return(null==e?0:e.length)?ng(e,0,-1):[]},rp.intersection=sG,rp.intersectionBy=sK,rp.intersectionWith=sW,rp.invert=ol,rp.invertBy=of,rp.invokeMap=il,rp.iteratee=oB,rp.keyBy=id,rp.keys=op,rp.keysIn=og,rp.map=ip,rp.mapKeys=function(e,t){var r={};return t=su(t,3),rG(e,function(e,n,s){rI(r,t(e,n,s),e)}),r},rp.mapValues=function(e,t){var r={};return t=su(t,3),rG(e,function(e,n,s){rI(r,n,t(e,n,s))}),r},rp.matches=function(e){return nt(rM(e,1))},rp.matchesProperty=function(e,t){return nr(e,rM(t,1))},rp.memoize=iP,rp.merge=om,rp.mergeWith=o_,rp.method=oD,rp.methodOf=oz,rp.mixin=oH,rp.negate=ik,rp.nthArg=function(e){return e=i8(e),nl(function(t){return ns(t,e)})},rp.omit=ob,rp.omitBy=function(e,t){return ov(e,ik(su(t)))},rp.once=function(e){return iy(2,e)},rp.orderBy=function(e,t,r,s){return null==e?[]:(iU(t)||(t=null==t?[]:[t]),iU(r=s?n:r)||(r=null==r?[]:[r]),ni(e,t,r))},rp.over=oG,rp.overArgs=ij,rp.overEvery=oK,rp.overSome=oW,rp.partial=iC,rp.partialRight=iI,rp.partition=ig,rp.pick=oy,rp.pickBy=ov,rp.property=oV,rp.propertyOf=function(e){return function(t){return null==e?n:rV(e,t)}},rp.pull=sY,rp.pullAll=sZ,rp.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?na(e,t,su(r,2)):e},rp.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?na(e,t,n,r):e},rp.pullAt=sX,rp.range=oY,rp.rangeRight=oZ,rp.rearg=iN,rp.reject=function(e,t){return(iU(e)?tl:rD)(e,ik(su(t,3)))},rp.remove=function(e,t){var r=[];if(!(e&&e.length))return r;var n=-1,s=[],i=e.length;for(t=su(t,3);++n<i;){var o=e[n];t(o,n,e)&&(r.push(o),s.push(n))}return nc(e,s),r},rp.rest=function(e,t){if("function"!=typeof e)throw new eO(s);return nl(e,t=n===t?t:i8(t))},rp.reverse=sQ,rp.sampleSize=function(e,t,r){return t=(r?sv(e,t,r):n===t)?1:i8(t),(iU(e)?function(e,t){return sM(nF(e),rR(t,0,e.length))}:function(e,t){var r=oS(e);return sM(r,rR(t,0,r.length))})(e,t)},rp.set=function(e,t,r){return null==e?e:nf(e,t,r)},rp.setWith=function(e,t,r,s){return s="function"==typeof s?s:n,null==e?e:nf(e,t,r,s)},rp.shuffle=function(e){return(iU(e)?function(e){return sM(nF(e))}:function(e){return sM(oS(e))})(e)},rp.slice=function(e,t,r){var s=null==e?0:e.length;return s?(r&&"number"!=typeof r&&sv(e,t,r)?(t=0,r=s):(t=null==t?0:i8(t),r=n===r?s:i8(r)),ng(e,t,r)):[]},rp.sortBy=im,rp.sortedUniq=function(e){return e&&e.length?ny(e):[]},rp.sortedUniqBy=function(e,t){return e&&e.length?ny(e,su(t,2)):[]},rp.split=function(e,t,r){return(r&&"number"!=typeof r&&sv(e,t,r)&&(t=r=n),r=n===r?0xffffffff:r>>>0)?(e=ot(e))&&("string"==typeof t||null!=t&&!iX(t))&&!(t=nw(t))&&tF(e)?nN(tG(e),0,r):e.split(t,r):[]},rp.spread=function(e,t){if("function"!=typeof e)throw new eO(s);return t=null==t?0:t2(i8(t),0),nl(function(r){var n=r[t],s=nN(r,0,t);return n&&tg(s,n),ta(e,this,s)})},rp.tail=function(e){var t=null==e?0:e.length;return t?ng(e,1,t):[]},rp.take=function(e,t,r){return e&&e.length?ng(e,0,(t=r||n===t?1:i8(t))<0?0:t):[]},rp.takeRight=function(e,t,r){var s=null==e?0:e.length;return s?ng(e,(t=s-(t=r||n===t?1:i8(t)))<0?0:t,s):[]},rp.takeRightWhile=function(e,t){return e&&e.length?nA(e,su(t,3),!1,!0):[]},rp.takeWhile=function(e,t){return e&&e.length?nA(e,su(t,3)):[]},rp.tap=function(e,t){return t(e),e},rp.throttle=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new eO(s);return iK(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),iE(e,t,{leading:n,maxWait:t,trailing:i})},rp.thru=ir,rp.toArray=i4,rp.toPairs=ow,rp.toPairsIn=ox,rp.toPath=function(e){return iU(e)?tp(e,s$):i1(e)?[e]:nF(sT(ot(e)))},rp.toPlainObject=oe,rp.transform=function(e,t,r){var n=iU(e),s=n||iB(e)||i2(e);if(t=su(t,4),null==r){var i=e&&e.constructor;r=s?n?new i:[]:iK(e)&&iH(i)?rg(ez(e)):{}}return(s?tu:rG)(e,function(e,n,s){return t(r,e,n,s)}),r},rp.unary=function(e){return ib(e,1)},rp.union=s0,rp.unionBy=s1,rp.unionWith=s2,rp.uniq=function(e){return e&&e.length?nx(e):[]},rp.uniqBy=function(e,t){return e&&e.length?nx(e,su(t,2)):[]},rp.uniqWith=function(e,t){return t="function"==typeof t?t:n,e&&e.length?nx(e,n,t):[]},rp.unset=function(e,t){return null==e||nS(e,t)},rp.unzip=s3,rp.unzipWith=s5,rp.update=function(e,t,r){return null==e?e:nE(e,t,nC(r))},rp.updateWith=function(e,t,r,s){return s="function"==typeof s?s:n,null==e?e:nE(e,t,nC(r),s)},rp.values=oS,rp.valuesIn=function(e){return null==e?[]:tR(e,og(e))},rp.without=s4,rp.words=oM,rp.wrap=function(e,t){return iC(nC(t),e)},rp.xor=s6,rp.xorBy=s8,rp.xorWith=s7,rp.zip=s9,rp.zipObject=function(e,t){return nk(e||[],t||[],rP)},rp.zipObjectDeep=function(e,t){return nk(e||[],t||[],nf)},rp.zipWith=ie,rp.entries=ow,rp.entriesIn=ox,rp.extend=on,rp.extendWith=os,oH(rp,rp),rp.add=o0,rp.attempt=oT,rp.camelCase=oE,rp.capitalize=oA,rp.ceil=o1,rp.clamp=function(e,t,r){return n===r&&(r=t,t=n),n!==r&&(r=(r=i9(r))==r?r:0),n!==t&&(t=(t=i9(t))==t?t:0),rR(i9(e),t,r)},rp.clone=function(e){return rM(e,4)},rp.cloneDeep=function(e){return rM(e,5)},rp.cloneDeepWith=function(e,t){return rM(e,5,t="function"==typeof t?t:n)},rp.cloneWith=function(e,t){return rM(e,4,t="function"==typeof t?t:n)},rp.conformsTo=function(e,t){return null==t||rT(e,t,op(t))},rp.deburr=oO,rp.defaultTo=function(e,t){return null==e||e!=e?t:e},rp.divide=o2,rp.endsWith=function(e,t,r){e=ot(e),t=nw(t);var s=e.length,i=r=n===r?s:rR(i8(r),0,s);return(r-=t.length)>=0&&e.slice(r,i)==t},rp.eq=iR,rp.escape=function(e){return(e=ot(e))&&z.test(e)?e.replace(B,tq):e},rp.escapeRegExp=function(e){return(e=ot(e))&&Z.test(e)?e.replace(Y,"\\$&"):e},rp.every=function(e,t,r){var s=iU(e)?th:rF;return r&&sv(e,t,r)&&(t=n),s(e,su(t,3))},rp.find=io,rp.findIndex=sD,rp.findKey=function(e,t){return tv(e,su(t,3),rG)},rp.findLast=ia,rp.findLastIndex=sz,rp.findLastKey=function(e,t){return tv(e,su(t,3),rK)},rp.floor=o3,rp.forEach=ic,rp.forEachRight=iu,rp.forIn=function(e,t){return null==e?e:rH(e,su(t,3),og)},rp.forInRight=function(e,t){return null==e?e:rJ(e,su(t,3),og)},rp.forOwn=function(e,t){return e&&rG(e,su(t,3))},rp.forOwnRight=function(e,t){return e&&rK(e,su(t,3))},rp.get=ou,rp.gt=iM,rp.gte=iT,rp.has=function(e,t){return null!=e&&sm(e,t,rQ)},rp.hasIn=oh,rp.head=sJ,rp.identity=oF,rp.includes=function(e,t,r,n){e=iL(e)?e:oS(e),r=r&&!n?i8(r):0;var s=e.length;return r<0&&(r=t2(s+r,0)),i0(e)?r<=s&&e.indexOf(t,r)>-1:!!s&&tx(e,t,r)>-1},rp.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return -1;var s=null==r?0:i8(r);return s<0&&(s=t2(n+s,0)),tx(e,t,s)},rp.inRange=function(e,t,r){var s,i,o;return t=i6(t),n===r?(r=t,t=0):r=i6(r),(s=e=i9(e))>=t3(i=t,o=r)&&s<t2(i,o)},rp.invoke=od,rp.isArguments=i$,rp.isArray=iU,rp.isArrayBuffer=iq,rp.isArrayLike=iL,rp.isArrayLikeObject=iF,rp.isBoolean=function(e){return!0===e||!1===e||iW(e)&&rZ(e)==f},rp.isBuffer=iB,rp.isDate=iD,rp.isElement=function(e){return iW(e)&&1===e.nodeType&&!iZ(e)},rp.isEmpty=function(e){if(null==e)return!0;if(iL(e)&&(iU(e)||"string"==typeof e||"function"==typeof e.splice||iB(e)||i2(e)||i$(e)))return!e.length;var t=sg(e);if(t==_||t==x)return!e.size;if(sE(e))return!r7(e).length;for(var r in e)if(eN.call(e,r))return!1;return!0},rp.isEqual=function(e,t){return r5(e,t)},rp.isEqualWith=function(e,t,r){var s=(r="function"==typeof r?r:n)?r(e,t):n;return n===s?r5(e,t,n,r):!!s},rp.isError=iz,rp.isFinite=function(e){return"number"==typeof e&&tQ(e)},rp.isFunction=iH,rp.isInteger=iJ,rp.isLength=iG,rp.isMap=iV,rp.isMatch=function(e,t){return e===t||r4(e,t,sl(t))},rp.isMatchWith=function(e,t,r){return r="function"==typeof r?r:n,r4(e,t,sl(t),r)},rp.isNaN=function(e){return iY(e)&&e!=+e},rp.isNative=function(e){if(sS(e))throw new ev("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return r6(e)},rp.isNil=function(e){return null==e},rp.isNull=function(e){return null===e},rp.isNumber=iY,rp.isObject=iK,rp.isObjectLike=iW,rp.isPlainObject=iZ,rp.isRegExp=iX,rp.isSafeInteger=function(e){return iJ(e)&&e>=-0x1fffffffffffff&&e<=0x1fffffffffffff},rp.isSet=iQ,rp.isString=i0,rp.isSymbol=i1,rp.isTypedArray=i2,rp.isUndefined=function(e){return n===e},rp.isWeakMap=function(e){return iW(e)&&sg(e)==A},rp.isWeakSet=function(e){return iW(e)&&"[object WeakSet]"==rZ(e)},rp.join=function(e,t){return null==e?"":t0.call(e,t)},rp.kebabCase=oP,rp.last=sV,rp.lastIndexOf=function(e,t,r){var s=null==e?0:e.length;if(!s)return -1;var i=s;return n!==r&&(i=(i=i8(r))<0?t2(s+i,0):t3(i,s-1)),t==t?function(e,t,r){for(var n=r+1;n--&&e[n]!==t;);return n}(e,t,i):tw(e,tE,i,!0)},rp.lowerCase=ok,rp.lowerFirst=oj,rp.lt=i3,rp.lte=i5,rp.max=function(e){return e&&e.length?rB(e,oF,rX):n},rp.maxBy=function(e,t){return e&&e.length?rB(e,su(t,2),rX):n},rp.mean=function(e){return tA(e,oF)},rp.meanBy=function(e,t){return tA(e,su(t,2))},rp.min=function(e){return e&&e.length?rB(e,oF,r9):n},rp.minBy=function(e,t){return e&&e.length?rB(e,su(t,2),r9):n},rp.stubArray=oX,rp.stubFalse=oQ,rp.stubObject=function(){return{}},rp.stubString=function(){return""},rp.stubTrue=function(){return!0},rp.multiply=o5,rp.nth=function(e,t){return e&&e.length?ns(e,i8(t)):n},rp.noConflict=function(){return e4._===this&&(e4._=eU),this},rp.noop=oJ,rp.now=i_,rp.pad=function(e,t,r){e=ot(e);var n=(t=i8(t))?tJ(e):0;if(!t||n>=t)return e;var s=(t-n)/2;return n1(tY(s),r)+e+n1(tP(s),r)},rp.padEnd=function(e,t,r){e=ot(e);var n=(t=i8(t))?tJ(e):0;return t&&n<t?e+n1(t-n,r):e},rp.padStart=function(e,t,r){e=ot(e);var n=(t=i8(t))?tJ(e):0;return t&&n<t?n1(t-n,r)+e:e},rp.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t*=1),t4(ot(e).replace(X,""),t||0)},rp.random=function(e,t,r){if(r&&"boolean"!=typeof r&&sv(e,t,r)&&(t=r=n),n===r&&("boolean"==typeof t?(r=t,t=n):"boolean"==typeof e&&(r=e,e=n)),n===e&&n===t?(e=0,t=1):(e=i6(e),n===t?(t=e,e=0):t=i6(t)),e>t){var s=e;e=t,t=s}if(r||e%1||t%1){var i=t6();return t3(e+i*(t-e+e1("1e-"+((i+"").length-1))),t)}return nu(e,t)},rp.reduce=function(e,t,r){var n=iU(e)?tm:tk,s=arguments.length<3;return n(e,su(t,4),r,s,rq)},rp.reduceRight=function(e,t,r){var n=iU(e)?t_:tk,s=arguments.length<3;return n(e,su(t,4),r,s,rL)},rp.repeat=function(e,t,r){return t=(r?sv(e,t,r):n===t)?1:i8(t),nh(ot(e),t)},rp.replace=function(){var e=arguments,t=ot(e[0]);return e.length<3?t:t.replace(e[1],e[2])},rp.result=function(e,t,r){t=nI(t,e);var s=-1,i=t.length;for(i||(i=1,e=n);++s<i;){var o=null==e?n:e[s$(t[s])];n===o&&(s=i,o=r),e=iH(o)?o.call(e):o}return e},rp.round=o4,rp.runInContext=e,rp.sample=function(e){return(iU(e)?rA:function(e){return rA(oS(e))})(e)},rp.size=function(e){if(null==e)return 0;if(iL(e))return i0(e)?tJ(e):e.length;var t=sg(e);return t==_||t==x?e.size:r7(e).length},rp.snakeCase=oC,rp.some=function(e,t,r){var s=iU(e)?tb:nm;return r&&sv(e,t,r)&&(t=n),s(e,su(t,3))},rp.sortedIndex=function(e,t){return n_(e,t)},rp.sortedIndexBy=function(e,t,r){return nb(e,t,su(r,2))},rp.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=n_(e,t);if(n<r&&iR(e[n],t))return n}return -1},rp.sortedLastIndex=function(e,t){return n_(e,t,!0)},rp.sortedLastIndexBy=function(e,t,r){return nb(e,t,su(r,2),!0)},rp.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var r=n_(e,t,!0)-1;if(iR(e[r],t))return r}return -1},rp.startCase=oI,rp.startsWith=function(e,t,r){return e=ot(e),r=null==r?0:rR(i8(r),0,e.length),t=nw(t),e.slice(r,r+t.length)==t},rp.subtract=o6,rp.sum=function(e){return e&&e.length?tj(e,oF):0},rp.sumBy=function(e,t){return e&&e.length?tj(e,su(t,2)):0},rp.template=function(e,t,r){var s=rp.templateSettings;r&&sv(e,t,r)&&(t=n),e=ot(e),t=os({},t,s,n9);var i,o,a=os({},t.imports,s.imports,n9),c=op(a),u=tR(a,c),h=0,l=t.interpolate||ep,f="__p += '",d=eE((t.escape||ep).source+"|"+l.source+"|"+(l===G?eo:ep).source+"|"+(t.evaluate||ep).source+"|$","g"),p="//# sourceURL="+(eN.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++eZ+"]")+"\n";e.replace(d,function(t,r,n,s,a,c){return n||(n=s),f+=e.slice(h,c).replace(eg,tL),r&&(i=!0,f+="' +\n__e("+r+") +\n'"),a&&(o=!0,f+="';\n"+a+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),h=c+t.length,t}),f+="';\n";var g=eN.call(t,"variable")&&t.variable;if(g){if(es.test(g))throw new ev("Invalid `variable` option passed into `_.template`")}else f="with (obj) {\n"+f+"\n}\n";f=(o?f.replace(U,""):f).replace(q,"$1").replace(L,"$1;"),f="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var m=oT(function(){return ew(c,p+"return "+f).apply(n,u)});if(m.source=f,iz(m))throw m;return m},rp.times=function(e,t){if((e=i8(e))<1||e>0x1fffffffffffff)return[];var r=0xffffffff,n=t3(e,0xffffffff);t=su(t),e-=0xffffffff;for(var s=tC(n,t);++r<e;)t(r);return s},rp.toFinite=i6,rp.toInteger=i8,rp.toLength=i7,rp.toLower=function(e){return ot(e).toLowerCase()},rp.toNumber=i9,rp.toSafeInteger=function(e){return e?rR(i8(e),-0x1fffffffffffff,0x1fffffffffffff):0===e?e:0},rp.toString=ot,rp.toUpper=function(e){return ot(e).toUpperCase()},rp.trim=function(e,t,r){if((e=ot(e))&&(r||n===t))return tI(e);if(!e||!(t=nw(t)))return e;var s=tG(e),i=tG(t),o=tT(s,i),a=t$(s,i)+1;return nN(s,o,a).join("")},rp.trimEnd=function(e,t,r){if((e=ot(e))&&(r||n===t))return e.slice(0,tK(e)+1);if(!e||!(t=nw(t)))return e;var s=tG(e),i=t$(s,tG(t))+1;return nN(s,0,i).join("")},rp.trimStart=function(e,t,r){if((e=ot(e))&&(r||n===t))return e.replace(X,"");if(!e||!(t=nw(t)))return e;var s=tG(e),i=tT(s,tG(t));return nN(s,i).join("")},rp.truncate=function(e,t){var r=30,s="...";if(iK(t)){var i="separator"in t?t.separator:i;r="length"in t?i8(t.length):r,s="omission"in t?nw(t.omission):s}var o=(e=ot(e)).length;if(tF(e)){var a=tG(e);o=a.length}if(r>=o)return e;var c=r-tJ(s);if(c<1)return s;var u=a?nN(a,0,c).join(""):e.slice(0,c);if(n===i)return u+s;if(a&&(c+=u.length-c),iX(i)){if(e.slice(c).search(i)){var h,l=u;for(i.global||(i=eE(i.source,ot(ea.exec(i))+"g")),i.lastIndex=0;h=i.exec(l);)var f=h.index;u=u.slice(0,n===f?c:f)}}else if(e.indexOf(nw(i),c)!=c){var d=u.lastIndexOf(i);d>-1&&(u=u.slice(0,d))}return u+s},rp.unescape=function(e){return(e=ot(e))&&D.test(e)?e.replace(F,tW):e},rp.uniqueId=function(e){var t=++eR;return ot(e)+t},rp.upperCase=oN,rp.upperFirst=oR,rp.each=ic,rp.eachRight=iu,rp.first=sJ,oH(rp,(e_={},rG(rp,function(e,t){eN.call(rp.prototype,t)||(e_[t]=e)}),e_),{chain:!1}),rp.VERSION="4.17.21",tu(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){rp[e].placeholder=rp}),tu(["drop","take"],function(e,t){rb.prototype[e]=function(r){r=n===r?1:t2(i8(r),0);var s=this.__filtered__&&!t?new rb(this):this.clone();return s.__filtered__?s.__takeCount__=t3(r,s.__takeCount__):s.__views__.push({size:t3(r,0xffffffff),type:e+(s.__dir__<0?"Right":"")}),s},rb.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),tu(["filter","map","takeWhile"],function(e,t){var r=t+1,n=1==r||3==r;rb.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:su(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}}),tu(["head","last"],function(e,t){var r="take"+(t?"Right":"");rb.prototype[e]=function(){return this[r](1).value()[0]}}),tu(["initial","tail"],function(e,t){var r="drop"+(t?"":"Right");rb.prototype[e]=function(){return this.__filtered__?new rb(this):this[r](1)}}),rb.prototype.compact=function(){return this.filter(oF)},rb.prototype.find=function(e){return this.filter(e).head()},rb.prototype.findLast=function(e){return this.reverse().find(e)},rb.prototype.invokeMap=nl(function(e,t){return"function"==typeof e?new rb(this):this.map(function(r){return r2(r,e,t)})}),rb.prototype.reject=function(e){return this.filter(ik(su(e)))},rb.prototype.slice=function(e,t){e=i8(e);var r=this;return r.__filtered__&&(e>0||t<0)?new rb(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),n!==t&&(r=(t=i8(t))<0?r.dropRight(-t):r.take(t-e)),r)},rb.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},rb.prototype.toArray=function(){return this.take(0xffffffff)},rG(rb.prototype,function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),s=/^(?:head|last)$/.test(t),i=rp[s?"take"+("last"==t?"Right":""):t],o=s||/^find/.test(t);i&&(rp.prototype[t]=function(){var t=this.__wrapped__,a=s?[1]:arguments,c=t instanceof rb,u=a[0],h=c||iU(t),l=function(e){var t=i.apply(rp,tg([e],a));return s&&f?t[0]:t};h&&r&&"function"==typeof u&&1!=u.length&&(c=h=!1);var f=this.__chain__,d=!!this.__actions__.length,p=o&&!f,g=c&&!d;if(!o&&h){t=g?t:new rb(this);var m=e.apply(t,a);return m.__actions__.push({func:ir,args:[l],thisArg:n}),new r_(m,f)}return p&&g?e.apply(this,a):(m=this.thru(l),p?s?m.value()[0]:m.value():m)})}),tu(["pop","push","shift","sort","splice","unshift"],function(e){var t=eP[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);rp.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var s=this.value();return t.apply(iU(s)?s:[],e)}return this[r](function(r){return t.apply(iU(r)?r:[],e)})}}),rG(rb.prototype,function(e,t){var r=rp[t];if(r){var n=r.name+"";eN.call(ri,n)||(ri[n]=[]),ri[n].push({name:t,func:r})}}),ri[nZ(n,2).name]=[{name:"wrapper",func:n}],rb.prototype.clone=function(){var e=new rb(this.__wrapped__);return e.__actions__=nF(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nF(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nF(this.__views__),e},rb.prototype.reverse=function(){if(this.__filtered__){var e=new rb(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e},rb.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=iU(e),n=t<0,s=r?e.length:0,i=function(e,t,r){for(var n=-1,s=r.length;++n<s;){var i=r[n],o=i.size;switch(i.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=t3(t,e+o);break;case"takeRight":e=t2(e,t-o)}}return{start:e,end:t}}(0,s,this.__views__),o=i.start,a=i.end,c=a-o,u=n?a:o-1,h=this.__iteratees__,l=h.length,f=0,d=t3(c,this.__takeCount__);if(!r||!n&&s==c&&d==c)return nO(e,this.__actions__);var p=[];e:for(;c--&&f<d;){for(var g=-1,m=e[u+=t];++g<l;){var _=h[g],b=_.iteratee,y=_.type,v=b(m);if(2==y)m=v;else if(!v)if(1==y)continue e;else break e}p[f++]=m}return p},rp.prototype.at=is,rp.prototype.chain=function(){return it(this)},rp.prototype.commit=function(){return new r_(this.value(),this.__chain__)},rp.prototype.next=function(){this.__values__===n&&(this.__values__=i4(this.value()));var e=this.__index__>=this.__values__.length,t=e?n:this.__values__[this.__index__++];return{done:e,value:t}},rp.prototype.plant=function(e){for(var t,r=this;r instanceof rm;){var s=sq(r);s.__index__=0,s.__values__=n,t?i.__wrapped__=s:t=s;var i=s;r=r.__wrapped__}return i.__wrapped__=e,t},rp.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof rb){var t=e;return this.__actions__.length&&(t=new rb(this)),(t=t.reverse()).__actions__.push({func:ir,args:[sQ],thisArg:n}),new r_(t,this.__chain__)}return this.thru(sQ)},rp.prototype.toJSON=rp.prototype.valueOf=rp.prototype.value=function(){return nO(this.__wrapped__,this.__actions__)},rp.prototype.first=rp.prototype.head,e5&&(rp.prototype[e5]=function(){return this}),rp}();if("function"==typeof define&&"object"==typeof define.amd&&define.amd)e4._=tV,e.r,n!==tV&&e.v(tV);else e8?((e8.exports=tV)._=tV,e6._=tV):e4._=tV}).call(e.e)},208727,422499,984639,e=>{"use strict";let t,r;e.s(["cleanupAllConnections",()=>r6,"getActiveSubscriptionsByInstance",()=>nr,"getAllHandlers",()=>nn,"getConnectionStatus",()=>r8,"getSubscriptionStats",()=>ns,"onConnectionStatusChange",()=>r7,"removeConnectionStatusListener",()=>r9,"subscribe",()=>ni,"unsubscribe",()=>no],208727);var n,s,i,o,a,c,u,h,l,f,d,p,g,m,_,b,y,v,w,x,S,E,A,O,P,k,j,C,I,N,R,M,T,$,U,q,L,F,B,D,z,H,J,G,K,W,V,Y,Z,X,Q,ee,et,er,en,es,ei,eo,ea,ec,eu,eh,el,ef,ed,ep=e.i(228337);let eg=new Uint8Array(0),em=new TextEncoder,e_=new TextDecoder;function eb(...e){let t=[];for(let r=0;r<e.length;r++)t.push(em.encode(e[r]));return 0===t.length?eg:1===t.length?t[0]:function(...e){let t=0;for(let r=0;r<e.length;r++)t+=e[r].length;let r=new Uint8Array(t),n=0;for(let t=0;t<e.length;t++)r.set(e[t],n),n+=e[t].length;return r}(...t)}function ey(e){return e&&0!==e.length?e_.decode(e):""}let ev="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",ew=new class{buf;seq;inc;inited;constructor(){this.buf=new Uint8Array(22),this.inited=!1}init(){this.inited=!0,this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)}setPre(){let e=new Uint8Array(12);if(globalThis?.crypto?.getRandomValues)globalThis.crypto.getRandomValues(e);else for(let t=0;t<e.length;t++)e[t]=Math.floor(255*Math.random());for(let t=0;t<12;t++){let r=e[t]%36;this.buf[t]=ev.charCodeAt(r)}}fillSeq(){let e=this.seq;for(let t=21;t>=12;t--)this.buf[t]=ev.charCodeAt(e%36),e=Math.floor(e/36)}next(){return this.inited||this.init(),this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}};(n=E||(E={})).Disconnect="disconnect",n.Reconnect="reconnect",n.Update="update",n.LDM="ldm",n.Error="error",(s=A||(A={})).Reconnecting="reconnecting",s.PingTimer="pingTimer",s.StaleConnection="staleConnection",s.ClientInitiatedReconnect="client initiated reconnect",(i=O||(O={})).ApiError="BAD API",i.BadAuthentication="BAD_AUTHENTICATION",i.BadCreds="BAD_CREDS",i.BadHeader="BAD_HEADER",i.BadJson="BAD_JSON",i.BadPayload="BAD_PAYLOAD",i.BadSubject="BAD_SUBJECT",i.Cancelled="CANCELLED",i.ConnectionClosed="CONNECTION_CLOSED",i.ConnectionDraining="CONNECTION_DRAINING",i.ConnectionRefused="CONNECTION_REFUSED",i.ConnectionTimeout="CONNECTION_TIMEOUT",i.Disconnect="DISCONNECT",i.InvalidOption="INVALID_OPTION",i.InvalidPayload="INVALID_PAYLOAD",i.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",i.NoResponders="503",i.NotFunction="NOT_FUNC",i.RequestError="REQUEST_ERROR",i.ServerOptionNotAvailable="SERVER_OPT_NA",i.SubClosed="SUB_CLOSED",i.SubDraining="SUB_DRAINING",i.Timeout="TIMEOUT",i.Tls="TLS",i.Unknown="UNKNOWN_ERROR",i.WssRequired="WSS_REQUIRED",i.JetStreamInvalidAck="JESTREAM_INVALID_ACK",i.JetStream404NoMessages="404",i.JetStream408RequestTimeout="408",i.JetStream409MaxAckPendingExceeded="409",i.JetStream409="409",i.JetStreamNotEnabled="503",i.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",i.AuthorizationViolation="AUTHORIZATION_VIOLATION",i.AuthenticationExpired="AUTHENTICATION_EXPIRED",i.ProtocolError="NATS_PROTOCOL_ERR",i.PermissionsViolation="PERMISSIONS_VIOLATION",i.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",i.AccountExpired="ACCOUNT_EXPIRED";class ex{messages;constructor(){this.messages=new Map,this.messages.set(O.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(O.BadJson,"Bad JSON"),this.messages.set(O.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return eS.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}let eS=new ex;class eE extends Error{name;message;code;permissionContext;chainedError;api_error;constructor(e,t,r){super(e),this.name="NatsError",this.message=e,this.code=t,this.chainedError=r}static errorForCode(e,t){return new eE(ex.getMessage(e),e,t)}isAuthError(){return this.code===O.AuthenticationExpired||this.code===O.AuthorizationViolation||this.code===O.AccountExpired}isAuthTimeout(){return this.code===O.AuthenticationTimeout}isPermissionError(){return this.code===O.PermissionsViolation}isProtocolError(){return this.code===O.ProtocolError}isJetStreamError(){return void 0!==this.api_error}jsError(){return this.api_error?this.api_error:null}}(o=P||(P={}))[o.Exact=0]="Exact",o[o.CanonicalMIME=1]="CanonicalMIME",o[o.IgnoreCase=2]="IgnoreCase",(a=k||(k={})).Timer="timer",a.Count="count",a.JitterTimer="jitterTimer",a.SentinelMsg="sentinelMsg",(c=j||(j={})).STATS="io.nats.micro.v1.stats_response",c.INFO="io.nats.micro.v1.info_response",c.PING="io.nats.micro.v1.ping_response";let eA="Nats-Service-Error",eO="Nats-Service-Error-Code";class eP extends Error{code;constructor(e,t){super(t),this.code=e}static isServiceError(e){return null!==eP.toServiceError(e)}static toServiceError(e){let t=e?.headers?.get(eO)||"";if(""!==t){let r=parseInt(t)||400,n=e?.headers?.get(eA)||"";return new eP(r,n.length?n:t)}return null}}function ek(e=""){if("string"!=typeof(e=e||"_INBOX"))throw Error("prefix must be a string");return e.split(".").forEach(t=>{if("*"===t||">"===t)throw Error(`inbox prefixes cannot have wildcards '${e}'`)}),`${e}.${ew.next()}`}let ej="127.0.0.1";function eC(e,...t){for(let r=0;r<t.length;r++){let n=t[r];Object.keys(n).forEach(function(t){e[t]=n[t]})}return e}function eI(e){return e_.decode(e).replace(/\n/g,"␊").replace(/\r/g,"␍")}function eN(e,t=!0){let r,n,s=t?eE.errorForCode(O.Timeout):null;return Object.assign(new Promise((t,i)=>{r={cancel:()=>{n&&clearTimeout(n)}},n=setTimeout(()=>{null===s?i(eE.errorForCode(O.Timeout)):i(s)},e)}),r)}function eR(e=0){let t;return Object.assign(new Promise(r=>{let n=setTimeout(()=>{r()},e);t={cancel:()=>{n&&clearTimeout(n)}}}),t)}function eM(){let e={};return Object.assign(new Promise((t,r)=>{e={resolve:t,reject:r}}),e)}function eT(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}function e$(e=[0,250,250,500,500,3e3,5e3]){Array.isArray(e)||(e=[0,250,250,500,500,3e3,5e3]);let t=e.length-1;return{backoff:r=>{var n;return 0===(n=r>t?e[t]:e[r])?0:Math.floor(n/2+Math.random()*n)}}}function eU(e){return 1e6*e}function eq(e){return Math.floor(e/1e6)}function eL(e){let t=!0,r=Array(e.length);for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);if(58===s||s<33||s>126)throw new eE(`'${e[n]}' is not a valid character for a header key`,O.BadHeader);t&&97<=s&&s<=122?s-=32:!t&&65<=s&&s<=90&&(s+=32),r[n]=s,t=45==s}return String.fromCharCode(...r)}function eF(e=0,t=""){if(0===e&&""!==t||e>0&&""===t)throw Error("setting status requires both code and description");return new eD(e,t)}(u=C||(C={})).PING="PING",u.STATS="STATS",u.INFO="INFO";let eB="NATS/1.0";class eD{_code;headers;_description;constructor(e=0,t=""){this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(let[t,r]of this.headers){let n=e.values(t);if(r.length!==n.length)return!1;let s=[...r].sort(),i=[...n].sort();for(let e=0;e<s.length;e++)if(s[e]!==i[e])return!1}return!0}return!1}static decode(e){let t=new eD,r=e_.decode(e).split("\r\n"),n=r[0];if(n!==eB){let e=n.replace(eB,"").trim();if(e.length>0){t._code=parseInt(e,10),isNaN(t._code)&&(t._code=0);let r=t._code.toString();t._description=(e=e.replace(r,"")).trim()}}return r.length>=1&&r.slice(1).map(e=>{if(e){let r=e.indexOf(":");if(r>-1){let n=e.slice(0,r),s=e.slice(r+1).trim();t.append(n,s)}}}),t}toString(){if(0===this.headers.size&&0===this._code)return"";let e=eB;for(let[t,r]of(this._code>0&&""!==this._description&&(e+=` ${this._code} ${this._description}`),this.headers))for(let n=0;n<r.length;n++)e=`${e}\r
${t}: ${r[n]}`;return`${e}\r
\r
`}encode(){return em.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new eE("invalid header value - \\r and \\n are not allowed.",O.BadHeader);return e.trim()}keys(){let e=[];for(let t of this.headers.keys())e.push(t);return e}findKeys(e,t=P.Exact){let r=this.keys();switch(t){case P.Exact:return r.filter(t=>t===e);case P.CanonicalMIME:return e=eL(e),r.filter(t=>t===e);default:{let t=e.toLowerCase();return r.filter(e=>t===e.toLowerCase())}}}get(e,t=P.Exact){let r=this.findKeys(e,t);if(r.length){let e=this.headers.get(r[0]);if(e)return Array.isArray(e)?e[0]:e}return""}last(e,t=P.Exact){let r=this.findKeys(e,t);if(r.length){let e=this.headers.get(r[0]);if(e)return Array.isArray(e)?e[e.length-1]:e}return""}has(e,t=P.Exact){return this.findKeys(e,t).length>0}set(e,t,r=P.Exact){this.delete(e,r),this.append(e,t,r)}append(e,t,r=P.Exact){let n=eL(e);r===P.CanonicalMIME&&(e=n);let s=this.findKeys(e,r);e=s.length>0?s[0]:e;let i=eD.validHeaderValue(t),o=this.headers.get(e);o||(o=[],this.headers.set(e,o)),o.push(i)}values(e,t=P.Exact){let r=[];return this.findKeys(e,t).forEach(e=>{let t=this.headers.get(e);t&&r.push(...t)}),r}delete(e,t=P.Exact){this.findKeys(e,t).forEach(e=>{this.headers.delete(e)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){let e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){let t=new eD;for(let r in e)t.headers.set(r,e[r]);return t}}function ez(){return{encode:e=>em.encode(e),decode:e=>e_.decode(e)}}function eH(e){return{encode(e){try{return void 0===e&&(e=null),em.encode(JSON.stringify(e))}catch(e){throw eE.errorForCode(O.BadJson,e)}},decode(t){try{return JSON.parse(e_.decode(t),e)}catch(e){throw eE.errorForCode(O.BadJson,e)}}}}function eJ(e){return e&&0===e.data.length&&e.headers?.code===503?eE.errorForCode(O.NoResponders):null}class eG{_headers;_msg;_rdata;_reply;_subject;publisher;static jc;constructor(e,t,r){this._msg=e,this._rdata=t,this.publisher=r}get subject(){return this._subject||(this._subject=e_.decode(this._msg.subject)),this._subject}get reply(){return this._reply||(this._reply=e_.decode(this._msg.reply)),this._reply}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){let e=this._rdata.subarray(0,this._msg.hdr);this._headers=eD.decode(e)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(e=eg,t){return!!this.reply&&(this.publisher.publish(this.reply,e,t),!0)}size(){return this._msg.subject.length+(this._msg.reply?.length||0)+(-1===this._msg.size?0:this._msg.size)}json(e){return eH(e).decode(this.data)}string(){return e_.decode(this.data)}requestInfo(){let e=this.headers?.get("Nats-Request-Info");return e?JSON.parse(e,function(e,t){return("start"===e||"stop"===e)&&""!==t?new Date(Date.parse(t)):t}):null}}function eK(e){return eV("durable",e)}function eW(e){return eV("stream",e)}function eV(e,t=""){if(""===t)throw Error(`${e} name required`);return[".","*",">","/","\\"," ","	","\n","\r"].forEach(r=>{if(-1!==t.indexOf(r)){switch(r){case"\n":r="\\n";break;case"\r":r="\\r";break;case"	":r="\\t"}throw Error(`invalid ${e} name - ${e} name cannot contain '${r}'`)}}),""}function eY(e,t=""){if(""===t)throw Error(`${e} name required`);let r=function(e=""){if(""===e)throw Error("name required");let t=/^[-\w]+$/g;if(null===e.match(t)){for(let r of e.split(""))if(null===r.match(t))return`cannot contain '${r}'`}return""}(t);if(r.length)throw Error(`invalid ${e} name - ${e} name ${r}`)}function eZ(e){if(e.data.length>0)return!1;let t=e.headers;return!!t&&t.code>=100&&t.code<200}function eX(e){return eZ(e)&&e.headers?.description==="Idle Heartbeat"}function eQ(e){if(0!==e.data.length)return null;let t=e.headers;return t?e0(t.code,t.description):null}function e0(e,t=""){if(e<300)return null;switch(t=t.toLowerCase(),e){case 404:return new eE(t,O.JetStream404NoMessages);case 408:return new eE(t,O.JetStream408RequestTimeout);case 409:{let e=t.startsWith(I.IdleHeartbeatMissed)?O.JetStreamIdleHeartBeat:O.JetStream409;return new eE(t,e)}case 503:return eE.errorForCode(O.JetStreamNotEnabled,Error(t));default:return""===t&&(t=O.Unknown),new eE(t,`${e}`)}}(h=I||(I={})).MaxBatchExceeded="exceeded maxrequestbatch of",h.MaxExpiresExceeded="exceeded maxrequestexpires of",h.MaxBytesExceeded="exceeded maxrequestmaxbytes of",h.MaxMessageSizeExceeded="message size exceeds maxbytes",h.PushConsumer="consumer is push based",h.MaxWaitingExceeded="exceeded maxwaiting",h.IdleHeartbeatMissed="idle heartbeats missed",h.ConsumerDeleted="consumer deleted";class e1{inflight;processed;received;noIterator;iterClosed;done;signal;yields;filtered;pendingFiltered;ingestionFilterFn;protocolFilterFn;dispatchedFn;ctx;_data;err;time;yielding;constructor(){this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=eM(),this.yields=[],this.iterClosed=eM(),this.time=0,this.yielding=!1}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if("function"==typeof e){this.yields.push(e),this.signal.resolve();return}let{ingest:t,protocol:r}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(r&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}async *iterate(){if(this.noIterator)throw new eE("unsupported iterator",O.ApiError);if(this.yielding)throw new eE("already yielding",O.ApiError);this.yielding=!0;try{for(;;){if(0===this.yields.length&&await this.signal,this.err)throw this.err;let e=this.yields;this.inflight=e.length,this.yields=[];for(let t=0;t<e.length;t++){if("function"==typeof e[t]){let r=e[t];try{r()}catch(e){throw e}if(this.err)throw this.err;continue}if(!this.protocolFilterFn||this.protocolFilterFn(e[t])){this.processed++;let r=Date.now();yield e[t],this.time=Date.now()-r,this.dispatchedFn&&e[t]&&this.dispatchedFn(e[t])}else this.pendingFiltered--;this.inflight--}if(this.done)break;0===this.yields.length&&(e.length=0,this.yields=e,this.signal=eM())}}finally{this.stop()}}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve(e))}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}class e2{interval;maxOut;cancelAfter;timer;autoCancelTimer;last;missed;count;callback;constructor(e,t,r={maxOut:2}){this.interval=e,this.maxOut=r?.maxOut||2,this.cancelAfter=r?.cancelAfter||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0,this.missed=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,r=2){this.interval=e,this.maxOut=r,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{!0===this.callback(this.missed)&&this.cancel()}catch(e){console.log(e)}},this.interval)}}(l=N||(N={})).Limits="limits",l.Interest="interest",l.Workqueue="workqueue",(f=R||(R={})).Old="old",f.New="new",(d=M||(M={})).File="file",d.Memory="memory",(p=T||(T={})).All="all",p.Last="last",p.New="new",p.StartSequence="by_start_sequence",p.StartTime="by_start_time",p.LastPerSubject="last_per_subject",(g=$||($={})).None="none",g.All="all",g.Explicit="explicit",g.NotSet="",(m=U||(U={})).Instant="instant",m.Original="original",(_=q||(q={})).None="none",_.S2="s2",(b=L||(L={})).CreateOrUpdate="",b.Update="update",b.Create="create",(y=F||(F={})).API="api_audit",y.StreamAction="stream_action",y.ConsumerAction="consumer_action",y.SnapshotCreate="snapshot_create",y.SnapshotComplete="snapshot_complete",y.RestoreCreate="restore_create",y.RestoreComplete="restore_complete",y.MaxDeliver="max_deliver",y.Terminated="terminated",y.Ack="consumer_ack",y.StreamLeaderElected="stream_leader_elected",y.StreamQuorumLost="stream_quorum_lost",y.ConsumerLeaderElected="consumer_leader_elected",y.ConsumerQuorumLost="consumer_quorum_lost",(v=B||(B={})).StreamSourceHdr="Nats-Stream-Source",v.LastConsumerSeqHdr="Nats-Last-Consumer",v.LastStreamSeqHdr="Nats-Last-Stream",v.ConsumerStalledHdr="Nats-Consumer-Stalled",v.MessageSizeHdr="Nats-Msg-Size",v.RollupHdr="Nats-Rollup",v.RollupValueSubject="sub",v.RollupValueAll="all",v.PendingMessagesHdr="Nats-Pending-Messages",v.PendingBytesHdr="Nats-Pending-Bytes",(w=D||(D={})).LastValue="",w.AllHistory="history",w.UpdatesOnly="updates",(x=z||(z={})).Stream="Nats-Stream",x.Sequence="Nats-Sequence",x.TimeStamp="Nats-Time-Stamp",x.Subject="Nats-Subject",(S=H||(H={})).Stream="Nats-Stream",S.Subject="Nats-Subject",S.Sequence="Nats-Sequence",S.LastSequence="Nats-Last-Sequence",S.Size="Nats-Msg-Size";class e3{config;ordered;mack;stream;callbackFn;max;qname;isBind;filters;constructor(e){this.stream="",this.mack=!1,this.ordered=!1,this.config=function(e,t={}){return Object.assign({name:"",deliver_policy:T.All,ack_policy:$.Explicit,ack_wait:eU(3e4),replay_policy:U.Instant},t)}(0,e||{})}getOpts(){let e={};if(e.config=Object.assign({},this.config),e.config.filter_subject&&(this.filterSubject(e.config.filter_subject),e.config.filter_subject=void 0),e.config.filter_subjects&&(e.config.filter_subjects?.forEach(e=>{this.filterSubject(e)}),e.config.filter_subjects=void 0),e.mack=this.mack,e.stream=this.stream,e.callbackFn=this.callbackFn,e.max=this.max,e.queue=this.qname,e.ordered=this.ordered,e.config.ack_policy=e.ordered?$.None:e.config.ack_policy,e.isBind=e.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:e.config.filter_subject=this.filters[0];break;default:e.config.filter_subjects=this.filters}return e}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return eK(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw Error("sequence must be greater than 0");return this.config.deliver_policy=T.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=T.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=T.All,this}deliverLastPerSubject(){return this.config.deliver_policy=T.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=T.Last,this}deliverNew(){return this.config.deliver_policy=T.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=$.None,this}ackAll(){return this.config.ack_policy=$.All,this}ackExplicit(){return this.config.ack_policy=$.Explicit,this}ackWait(e){return this.config.ack_wait=eU(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=U.Instant,this}replayOriginal(){return this.config.replay_policy=U.Original,this}sample(e){if((e=Math.trunc(e))<0||e>100)throw Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=eU(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=eU(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=eU(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}consumerName(e){return this.config.name=e,this}}function e5(e){return new e3(e)}function e4(e){return"function"==typeof e.getOpts}class e6{static encode(e){return"string"==typeof e?btoa(e):btoa(String.fromCharCode(...Array.from(e)))}static decode(e,t=!1){let r=atob(e);return t?Uint8Array.from(r,e=>e.charCodeAt(0)):r}}class e8{static encode(e){return e8.toB64URLEncoding(e6.encode(e))}static decode(e,t=!1){return e8.decode(e8.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}class e7{buffers;byteLength;constructor(){this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let r=0;r<e.length;r++)t+=e[r].length;let r=new Uint8Array(t),n=0;for(let t=0;t<e.length;t++)r.set(e[t],n),n+=e[t].length;return r}static fromAscii(e){return e||(e=""),em.encode(e)}static toAscii(e){return e_.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){let e=new Uint8Array(this.byteLength),t=0;for(let r=0;r<this.buffers.length;r++)e.set(this.buffers[r],t),t+=this.buffers[r].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){let e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();let t=this.buffers.pop();if(t){let r=this.byteLength;(void 0===e||e>r)&&(e=r);let n=t.subarray(0,e);return r>e&&this.buffers.push(t.subarray(e)),this.byteLength=r-e,n}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let e=0;e<t.length;e++)t[e]&&t[e].length&&(this.buffers.push(t[e]),this.byteLength+=t[e].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}var e9=e.g;function te(){throw Error("setTimeout has not been defined")}function tt(){throw Error("clearTimeout has not been defined")}var tr=te,tn=tt;"function"==typeof e9.setTimeout&&(tr=setTimeout),"function"==typeof e9.clearTimeout&&(tn=clearTimeout);(function(e,t){this.fun=e,this.array=t}).prototype.run=function(){this.fun.apply(null,this.array)};var ts=e9.performance||{},ti=(ts.now||ts.mozNow||ts.msNow||ts.oNow||ts.webkitNow,{}),to="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,ta={exports:{}},tc={},tu=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}),t}((J={__proto__:null,default:tc},[tc].forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(t){if("default"!==t&&!(t in J)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(J,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}})}),Object.freeze(J)));(function(){var e="input is invalid type",t="object"==typeof window,r=t?window:{};r.JS_SHA256_NO_WINDOW&&(t=!1);var n=!t&&"object"==typeof self,s=!r.JS_SHA256_NO_NODE_JS&&ti&&ti.node;s?r=to:n&&(r=self);var i=!r.JS_SHA256_NO_COMMON_JS&&ta.exports,o=!r.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,a="0123456789abcdef".split(""),c=[-0x80000000,8388608,32768,128],u=[24,16,8,0],h=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],l=["hex","array","digest","arrayBuffer"],f=[];!r.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),o&&(r.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var d=function(e,t){return function(r){return new b(t,!0).update(r)[e]()}},p=function(e){var t=d("hex",e);s&&(t=g(t,e)),t.create=function(){return new b(e)},t.update=function(e){return t.create().update(e)};for(var r=0;r<l.length;++r){var n=l[r];t[n]=d(n,e)}return t},g=function(t,n){var s,i=tu.Buffer,o=n?"sha224":"sha256";return s=i.from&&!r.JS_SHA256_NO_BUFFER_FROM?i.from:function(e){return new i(e)},function(r){if("string"==typeof r)return tu.createHash(o).update(r,"utf8").digest("hex");if(null==r)throw Error(e);return r.constructor===ArrayBuffer&&(r=new Uint8Array(r)),Array.isArray(r)||ArrayBuffer.isView(r)||r.constructor===i?tu.createHash(o).update(s(r)).digest("hex"):t(r)}},m=function(e,t){return function(r,n){return new y(r,t,!0).update(n)[e]()}},_=function(e){var t=m("hex",e);t.create=function(t){return new y(t,e)},t.update=function(e,r){return t.create(e).update(r)};for(var r=0;r<l.length;++r){var n=l[r];t[n]=m(n,e)}return t};function b(e,t){t?(f[0]=f[16]=f[1]=f[2]=f[3]=f[4]=f[5]=f[6]=f[7]=f[8]=f[9]=f[10]=f[11]=f[12]=f[13]=f[14]=f[15]=0,this.blocks=f):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=0xc1059ed8,this.h1=0x367cd507,this.h2=0x3070dd17,this.h3=0xf70e5939,this.h4=0xffc00b31,this.h5=0x68581511,this.h6=0x64f98fa7,this.h7=0xbefa4fa4):(this.h0=0x6a09e667,this.h1=0xbb67ae85,this.h2=0x3c6ef372,this.h3=0xa54ff53a,this.h4=0x510e527f,this.h5=0x9b05688c,this.h6=0x1f83d9ab,this.h7=0x5be0cd19),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function y(t,r,n){var s,i=typeof t;if("string"===i){var a,c=[],u=t.length,h=0;for(s=0;s<u;++s)(a=t.charCodeAt(s))<128?c[h++]=a:(a<2048?c[h++]=192|a>>>6:(a<55296||a>=57344?c[h++]=224|a>>>12:(a=65536+((1023&a)<<10|1023&t.charCodeAt(++s)),c[h++]=240|a>>>18,c[h++]=128|a>>>12&63),c[h++]=128|a>>>6&63),c[h++]=128|63&a);t=c}else{if("object"!==i||null===t)throw Error(e);if(o&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||o&&ArrayBuffer.isView(t)))throw Error(e)}t.length>64&&(t=new b(r,!0).update(t).array());var l=[],f=[];for(s=0;s<64;++s){var d=t[s]||0;l[s]=92^d,f[s]=54^d}b.call(this,r,n),this.update(f),this.oKeyPad=l,this.inner=!0,this.sharedMemory=n}b.prototype.update=function(t){if(!this.finalized){var r,n=typeof t;if("string"!==n){if("object"!==n||null===t)throw Error(e);if(o&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||o&&ArrayBuffer.isView(t)))throw Error(e);r=!0}for(var s,i,a=0,c=t.length,h=this.blocks;a<c;){if(this.hashed&&(this.hashed=!1,h[0]=this.block,this.block=h[16]=h[1]=h[2]=h[3]=h[4]=h[5]=h[6]=h[7]=h[8]=h[9]=h[10]=h[11]=h[12]=h[13]=h[14]=h[15]=0),r)for(i=this.start;a<c&&i<64;++a)h[i>>>2]|=t[a]<<u[3&i++];else for(i=this.start;a<c&&i<64;++a)(s=t.charCodeAt(a))<128?h[i>>>2]|=s<<u[3&i++]:(s<2048?h[i>>>2]|=(192|s>>>6)<<u[3&i++]:(s<55296||s>=57344?h[i>>>2]|=(224|s>>>12)<<u[3&i++]:(s=65536+((1023&s)<<10|1023&t.charCodeAt(++a)),h[i>>>2]|=(240|s>>>18)<<u[3&i++],h[i>>>2]|=(128|s>>>12&63)<<u[3&i++]),h[i>>>2]|=(128|s>>>6&63)<<u[3&i++]),h[i>>>2]|=(128|63&s)<<u[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=h[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000|0,this.bytes=this.bytes%0x100000000),this}},b.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>>2]|=c[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},b.prototype.hash=function(){var e,t,r,n,s,i,o,a,c,u=this.h0,l=this.h1,f=this.h2,d=this.h3,p=this.h4,g=this.h5,m=this.h6,_=this.h7,b=this.blocks;for(e=16;e<64;++e)t=((s=b[e-15])>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,r=((s=b[e-2])>>>17|s<<15)^(s>>>19|s<<13)^s>>>10,b[e]=b[e-16]+t+b[e-7]+r|0;for(c=l&f,e=0;e<64;e+=4)this.first?(this.is224?(i=300032,_=(s=b[0]-0x543c9a5b)-0x8f1a6c7|0,d=s+0x170e9b5|0):(i=0x2a01a605,_=(s=b[0]-0xc881298)-0x5ab00ac6|0,d=s+0x8909ae5|0),this.first=!1):(t=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),n=(i=u&l)^u&f^c,_=d+(s=_+(r=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&g^~p&m)+h[e]+b[e])|0,d=s+(t+n)|0),t=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),n=(o=d&u)^d&l^i,m=f+(s=m+(r=(_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7))+(_&p^~_&g)+h[e+1]+b[e+1])|0,t=((f=s+(t+n)|0)>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),n=(a=f&d)^f&u^o,g=l+(s=g+(r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&_^~m&p)+h[e+2]+b[e+2])|0,t=((l=s+(t+n)|0)>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),n=(c=l&f)^l&d^a,p=u+(s=p+(r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&m^~g&_)+h[e+3]+b[e+3])|0,u=s+(t+n)|0,this.chromeBugWorkAround=!0;this.h0=this.h0+u|0,this.h1=this.h1+l|0,this.h2=this.h2+f|0,this.h3=this.h3+d|0,this.h4=this.h4+p|0,this.h5=this.h5+g|0,this.h6=this.h6+m|0,this.h7=this.h7+_|0},b.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,s=this.h4,i=this.h5,o=this.h6,c=this.h7,u=a[e>>>28&15]+a[e>>>24&15]+a[e>>>20&15]+a[e>>>16&15]+a[e>>>12&15]+a[e>>>8&15]+a[e>>>4&15]+a[15&e]+a[t>>>28&15]+a[t>>>24&15]+a[t>>>20&15]+a[t>>>16&15]+a[t>>>12&15]+a[t>>>8&15]+a[t>>>4&15]+a[15&t]+a[r>>>28&15]+a[r>>>24&15]+a[r>>>20&15]+a[r>>>16&15]+a[r>>>12&15]+a[r>>>8&15]+a[r>>>4&15]+a[15&r]+a[n>>>28&15]+a[n>>>24&15]+a[n>>>20&15]+a[n>>>16&15]+a[n>>>12&15]+a[n>>>8&15]+a[n>>>4&15]+a[15&n]+a[s>>>28&15]+a[s>>>24&15]+a[s>>>20&15]+a[s>>>16&15]+a[s>>>12&15]+a[s>>>8&15]+a[s>>>4&15]+a[15&s]+a[i>>>28&15]+a[i>>>24&15]+a[i>>>20&15]+a[i>>>16&15]+a[i>>>12&15]+a[i>>>8&15]+a[i>>>4&15]+a[15&i]+a[o>>>28&15]+a[o>>>24&15]+a[o>>>20&15]+a[o>>>16&15]+a[o>>>12&15]+a[o>>>8&15]+a[o>>>4&15]+a[15&o];return this.is224||(u+=a[c>>>28&15]+a[c>>>24&15]+a[c>>>20&15]+a[c>>>16&15]+a[c>>>12&15]+a[c>>>8&15]+a[c>>>4&15]+a[15&c]),u},b.prototype.toString=b.prototype.hex,b.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,s=this.h4,i=this.h5,o=this.h6,a=this.h7,c=[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s,i>>>24&255,i>>>16&255,i>>>8&255,255&i,o>>>24&255,o>>>16&255,o>>>8&255,255&o];return this.is224||c.push(a>>>24&255,a>>>16&255,a>>>8&255,255&a),c},b.prototype.array=b.prototype.digest,b.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},y.prototype=new b,y.prototype.finalize=function(){if(b.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();b.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),b.prototype.finalize.call(this)}};var v=p();v.sha256=v,v.sha224=p(!0),v.sha256.hmac=_(),v.sha224.hmac=_(!0),i?ta.exports=v:(r.sha256=v.sha256,r.sha224=v.sha224)})(),ta.exports,ta.exports.sha224;var th=ta.exports.sha256;function tl(e){switch(function(e){return function(e){if(!/^[0-9A-Fa-f]+$/.test(e))return!1;let t=/^[0-9A-F]+$/.test(e),r=/^[0-9a-f]+$/.test(e);return!!(t||r)&&e.length%2==0}(e)?"hex":/^[A-Za-z0-9\-_]*(={0,2})?$/.test(e)||/^[A-Za-z0-9+/]*(={0,2})?$/.test(e)?"b64":""}(e)){case"hex":if(e.length%2!=0)throw Error("hex string must have an even length");let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substring(r,r+2),16);return t;case"b64":let r;return r=atob(e.replace(/-/g,"+").replace(/_/g,"/")),Uint8Array.from(r,e=>e.charCodeAt(0))}return null}class tf{token;received;ctx;requestSubject;mux;constructor(e,t,r=!0){this.mux=e,this.requestSubject=t,this.received=0,this.token=ew.next(),r&&(this.ctx=Error())}}class td extends tf{callback;done;timer;max;opts;constructor(e,t,r={maxWait:1e3}){if(super(e,t),this.opts=r,"function"!=typeof this.opts.callback)throw Error("callback is required");this.callback=this.opts.callback,this.max="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,this.done=eM(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},r.maxWait)}cancel(e){e&&this.callback(e,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(e,t){e?(this.ctx&&(e.stack+=`

${this.ctx.stack}`),this.cancel(e)):(this.callback(null,t),this.opts.strategy===k.Count&&(this.max--,0===this.max&&this.cancel()),this.opts.strategy===k.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===k.SentinelMsg&&t&&0===t.data.length&&this.cancel())}}class tp extends tf{deferred;timer;constructor(e,t,r={timeout:1e3},n=!0){super(e,t,n),this.deferred=eM(),this.timer=eN(r.timeout,n)}resolver(e,t){this.timer&&this.timer.cancel(),e?(this.ctx&&(e.stack+=`

${this.ctx.stack}`),this.deferred.reject(e)):this.deferred.resolve(t),this.cancel()}cancel(e){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(e||eE.errorForCode(O.Cancelled))}}class tg{nc;opts;prefix;timeout;jc;constructor(e,t){this.nc=e,this.opts=function(e){return(e=e||{}).domain&&(e.apiPrefix=`$JS.${e.domain}.API`,delete e.domain),eC({apiPrefix:"$JS.API",timeout:5e3},e)}(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=eH()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||0===e.length)throw Error("invalid empty prefix");"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}async _request(e,t=null,r){(r=r||{}).timeout=this.timeout;let n=eg;t&&(n=this.jc.encode(t));let{retries:s}=r;s=-1===(s=s||1)?Number.MAX_SAFE_INTEGER:s;let i=e$();for(let t=0;t<s;t++)try{let t=await this.nc.request(e,n,r);return this.parseJsResponse(t)}catch(e){if(("503"===e.code||e.code===O.Timeout)&&t+1<s)await eR(i.backoff(t));else throw e}}async findStream(e){let t=await this._request(`${this.prefix}.STREAM.NAMES`,{subject:e});if(!t.streams||1!==t.streams.length)throw Error("no stream matches subject");return t.streams[0]}getConnection(){return this.nc}parseJsResponse(e){let t=this.jc.decode(e.data);if(t.error){let e=e0(t.error.code,t.error.description);if(null!==e)throw e.api_error=t.error,e}return t}}class tm{err;offset;pageInfo;subject;jsm;filter;payload;constructor(e,t,r,n){if(!e)throw Error("subject is required");this.subject=e,this.jsm=r,this.offset=0,this.pageInfo={},this.filter=t,this.payload=n||{}}async next(){if(this.err||this.pageInfo&&this.offset>=this.pageInfo.total)return[];let e={offset:this.offset};this.payload&&Object.assign(e,this.payload);try{let t=await this.jsm._request(this.subject,e,{timeout:this.jsm.timeout});this.pageInfo=t;let r=this.countResponse(t);if(0===r)return[];return this.offset+=r,this.filter(t)}catch(e){throw this.err=e,e}}countResponse(e){switch(e?.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return e.streams?.length||0;case"io.nats.jetstream.api.v1.consumer_list_response":return e.consumers?.length||0;default:return console.error(`jslister.ts: unknown API response for paged output: ${e?.type}`),e.streams?.length||0}}async *[Symbol.asyncIterator](){let e=await this.next();for(;e.length>0;){for(let t of e)yield t;e=await this.next()}}}function t_(e=""){let t=e.match(/(\d+).(\d+).(\d+)/);if(t)return{major:parseInt(t[1]),minor:parseInt(t[2]),micro:parseInt(t[3])};throw Error(`'${e}' is not a semver value`)}function tb(e,t){return e.major<t.major?-1:e.major>t.major?1:e.minor<t.minor?-1:e.minor>t.minor?1:e.micro<t.micro?-1:+(e.micro>t.micro)}(G=es||(es={})).JS_KV="js_kv",G.JS_OBJECTSTORE="js_objectstore",G.JS_PULL_MAX_BYTES="js_pull_max_bytes",G.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",G.JS_ALLOW_DIRECT="js_allow_direct",G.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",G.JS_SIMPLIFICATION="js_simplification",G.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",G.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",G.JS_STREAM_FIRST_SEQ="js_stream_first_seq",G.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",G.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",G.JS_STREAM_COMPRESSION="js_stream_compression",G.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",G.JS_BATCH_DIRECT_GET="js_batch_direct_get";class ty{server;features;disabled;constructor(e){this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return -1!==this.disabled.indexOf(e)}update(e){"string"==typeof e&&(e=t_(e)),this.server=e,this.set(es.JS_KV,"2.6.2"),this.set(es.JS_OBJECTSTORE,"2.6.3"),this.set(es.JS_PULL_MAX_BYTES,"2.8.3"),this.set(es.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(es.JS_ALLOW_DIRECT,"2.9.0"),this.set(es.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(es.JS_SIMPLIFICATION,"2.9.4"),this.set(es.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(es.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(es.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(es.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(es.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(es.JS_STREAM_COMPRESSION,"2.10.0"),this.set(es.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.set(es.JS_BATCH_DIRECT_GET,"2.11.0"),this.disabled.forEach(e=>{this.features.delete(e)})}set(e,t){this.features.set(e,{min:t,ok:tb(this.server,t_(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){return this.get(e)?.ok||!1}require(e){return"string"==typeof e&&(e=t_(e)),tb(this.server,e)>=0}}class tv extends tg{constructor(e,t){super(e,t)}async add(e,t,r=L.Create){let n;if(eW(e),t.deliver_group&&t.flow_control)throw Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw Error("jetstream idle heartbeat is not supported with queue groups");let s={};s.config=t,s.stream_name=e,s.action=r,s.config.durable_name&&eK(s.config.durable_name);let i=this.nc,{min:o,ok:a}=i.features.get(es.JS_NEW_CONSUMER_CREATE_API),c=""===t.name?void 0:t.name;if(c&&!a)throw Error(`consumer 'name' requires server ${o}`);if(c)try{eV("name",c)}catch(r){let e=r.message,t=e.indexOf("cannot contain");if(-1!==t)throw Error(`consumer 'name' ${e.substring(t)}`);throw r}let u="";if(Array.isArray(t.filter_subjects)){let{min:e,ok:t}=i.features.get(es.JS_MULTIPLE_CONSUMER_FILTER);if(!t)throw Error(`consumer 'filter_subjects' requires server ${e}`);a=!1}if(t.metadata){let{min:e,ok:t}=i.features.get(es.JS_STREAM_CONSUMER_METADATA);if(!t)throw Error(`consumer 'metadata' requires server ${e}`)}if(a&&(u=t.name??t.durable_name??""),""!==u){let r=t.filter_subject??void 0;">"===r&&(r=void 0),n=void 0!==r?`${this.prefix}.CONSUMER.CREATE.${e}.${u}.${r}`:`${this.prefix}.CONSUMER.CREATE.${e}.${u}`}else n=t.durable_name?`${this.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${this.prefix}.CONSUMER.CREATE.${e}`;return await this._request(n,s)}async update(e,t,r){let n=await this.info(e,t);return this.add(e,Object.assign(n.config,r),L.Update)}async info(e,t){return eW(e),eK(t),await this._request(`${this.prefix}.CONSUMER.INFO.${e}.${t}`)}async delete(e,t){return eW(e),eK(t),(await this._request(`${this.prefix}.CONSUMER.DELETE.${e}.${t}`)).success}list(e){return eW(e),new tm(`${this.prefix}.CONSUMER.LIST.${e}`,e=>e.consumers,this)}pause(e,t,r){let n=`${this.prefix}.CONSUMER.PAUSE.${e}.${t}`,s={pause_until:r.toISOString()};return this._request(n,s)}resume(e,t){return this.pause(e,t,new Date(0))}}function tw(e,t,r=!1){if(!0===r&&!e||e&&"function"!=typeof e)throw eE.errorForCode(O.ApiError,Error(`${t} is not a function`))}class tx extends e1{sub;adapter;subIterDone;constructor(e,t,r){super(),tw(r.adapter,"adapter",!0),this.adapter=r.adapter,r.callback&&tw(r.callback,"callback"),this.noIterator="function"==typeof r.callback,r.ingestionFilterFn&&(tw(r.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=r.ingestionFilterFn),r.protocolFilterFn&&(tw(r.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=r.protocolFilterFn),r.dispatchedFn&&(tw(r.dispatchedFn,"dispatchedFn"),this.dispatchedFn=r.dispatchedFn),r.cleanupFn&&tw(r.cleanupFn,"cleanupFn");let n=(e,t)=>{this.callback(e,t)};if(r.callback){const e=r.callback;n=(t,r)=>{let[n,s]=this.adapter(t,r);if(n)return void e(n,null);let{ingest:i}=this.ingestionFilterFn?this.ingestionFilterFn(s,this):{ingest:!0};i&&(!this.protocolFilterFn||this.protocolFilterFn(s))&&(e(n,s),this.dispatchedFn&&s&&this.dispatchedFn(s))}}const{max:s,queue:i,timeout:o}=r,a={queue:i,timeout:o,callback:n};s&&s>0&&(a.max=s),this.sub=e.subscribe(t,a),r.cleanupFn&&(this.sub.cleanupFn=r.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=eM(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(async e=>{await e.closed,this.stop()})(this.sub).then().catch()}unsubscribe(e){this.sub.unsubscribe(e)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(e,t){this.sub.cancelTimeout();let[r,n]=this.adapter(e,t);r&&this.stop(r),n&&this.push(n)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}function tS(){return void 0!==t&&void 0!==t.defaultPort?t.defaultPort:4222}function tE(){return void 0!==t&&t.urlParseFn?t.urlParseFn:void 0}function tA(){return void 0!==t&&t.dnsResolveFn?t.dnsResolveFn:void 0}let tO=e7.fromAscii("\r\n"),tP=new Uint8Array(tO)[0],tk=new Uint8Array(tO)[1];function tj(e){return void 0!==function(e){for(let t=0;t<e.length;t++)switch(e[t]){case".":return tC(e);case":":return function(e){let t=new Uint8Array(16),r=-1;if(e.length>=2&&":"===e[0]&&":"===e[1]&&(r=0,0===(e=e.substring(2)).length))return t;let n=0;for(;n<16;){let{n:s,c:i,ok:o}=function(e){let t=0,r=0;for(r=0;r<e.length;r++){if(48<=e.charCodeAt(r)&&57>=e.charCodeAt(r))t*=16,t+=e.charCodeAt(r)-48;else if(97<=e.charCodeAt(r)&&102>=e.charCodeAt(r))t*=16,t+=e.charCodeAt(r)-97+10;else if(65<=e.charCodeAt(r)&&70>=e.charCodeAt(r))t*=16,t+=e.charCodeAt(r)-65+10;else break;if(t>=0xffffff)return{n:0,c:r,ok:!1}}return 0===r?{n:0,c:r,ok:!1}:{n:t,c:r,ok:!0}}(e);if(!o||s>65535)return;if(i<e.length&&"."===e[i]){if(r<0&&12!=n||n+4>16)return;let s=tC(e);if(void 0===s)return;t[n]=s[12],t[n+1]=s[13],t[n+2]=s[14],t[n+3]=s[15],e="",n+=4;break}if(t[n]=s>>8,t[n+1]=s,n+=2,0===(e=e.substring(i)).length)break;if(":"!==e[0]||1==e.length)return;if(":"===(e=e.substring(1))[0]){if(r>=0)return;if(r=n,0===(e=e.substring(1)).length)break}}if(0===e.length){if(n<16){if(r<0)return;let e=16-n;for(let s=n-1;s>=r;s--)t[s+e]=t[s];for(let n=r+e-1;n>=r;n--)t[n]=0}else if(r>=0)return;return t}}(e)}}(e)}function tC(e){var t,r,n,s;let i,o=new Uint8Array(4);for(let t=0;t<4;t++){if(0===e.length)return;if(t>0){if("."!==e[0])return;e=e.substring(1)}let{n:r,c:n,ok:s}=function(e){let t=0,r=0;for(t=0;t<e.length&&48<=e.charCodeAt(t)&&57>=e.charCodeAt(t);t++)if((r=10*r+(e.charCodeAt(t)-48))>=0xffffff)return{n:0xffffff,c:t,ok:!1};return 0===t?{n:0,c:0,ok:!1}:{n:r,c:t,ok:!0}}(e);if(!s||r>255)return;e=e.substring(n),o[t]=r}return t=o[0],r=o[1],n=o[2],s=o[3],i=new Uint8Array(16),[0,0,0,0,0,0,0,0,0,0,255,255].forEach((e,t)=>{i[t]=e}),i[12]=t,i[13]=r,i[14]=n,i[15]=s,i}function tI(e){return!(-1===e.indexOf("[")&&-1===e.indexOf("::")&&(-1!==e.indexOf(".")||e.split(":").length<=2))}class tN{src;listen;hostname;port;didConnect;reconnects;lastConnect;gossiped;tlsName;resolves;constructor(e,t=!1){this.src=e,this.tlsName="";const r=function(e){(e=e.trim()).match(/^(.*:\/\/)(.*)/m)&&(e=e.replace(/^(.*:\/\/)(.*)/gm,"$2")),tI(e=function(e){let t="::FFFF:",r=e.toUpperCase().indexOf(t);if(-1!==r&&-1!==e.indexOf(".")){let n=e.substring(r+t.length);return(n=n.replace("[","")).replace("]","")}return e}(e))&&-1===e.indexOf("[")&&(e=`[${e}]`);let t=tI(e)?e.match(/(]:)(\d+)/):e.match(/(:)(\d+)/),r=t&&3===t.length&&t[1]&&t[2]?parseInt(t[2]):4222,n=new URL(`${80===r?"https":"http"}://${e}`);n.port=`${r}`;let s=n.hostname;return"["===s.charAt(0)&&(s=s.substring(1,s.length-1)),{listen:n.host,hostname:s,port:r}}(e);this.listen=r.listen,this.hostname=r.hostname,this.port=r.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}async resolve(e){if(!e.fn||!1===e.resolve)return[this];let t=[];if(tj(this.hostname))return[this];{let r=await e.fn(this.hostname);for(let n of(e.debug&&console.log(`resolve ${this.hostname} = ${r.join(",")}`),r)){let e=80===this.port?"https":"http",r=new URL(`${e}://${tI(n)?"["+n+"]":n}`);r.port=`${this.port}`;let s=new tN(r.host,!1);s.tlsName=this.hostname,t.push(s)}}return e.randomize&&eT(t),this.resolves=t,t}}class tR{firstSelect;servers;currentServer;tlsName;randomize;constructor(e=[],t={}){this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;const r=tE();e&&(e.forEach(e=>{e=r?r(e):e,this.servers.push(new tN(e))}),this.randomize&&(this.servers=eT(this.servers))),0===this.servers.length&&this.addServer(`${ej}:${tS()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){let e=this.getCurrentServer();tj(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(e=>{e.gossiped&&(e.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){let r=tE(),n=new tN(e=r?r(e):e,t);tj(n.hostname)&&(n.tlsName=this.tlsName),this.servers.push(n)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;let e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){let t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e,t){let r=[],n=[],s=tE(),i=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(e=>{let r=new tN(e=s?s(e,t):e,!0);i.set(e,r)});let o=[];return this.servers.forEach((e,t)=>{let r=e.listen;e.gossiped&&this.currentServer.listen!==r&&void 0===i.get(r)&&o.push(t),i.delete(r)}),o.reverse(),o.forEach(e=>{let t=this.servers.splice(e,1);n=n.concat(t[0].listen)}),i.forEach((e,t)=>{this.servers.push(e),r.push(t)}),{added:r,deleted:n}}}class tM{baseInbox;reqs;constructor(){this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${ek(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){let t=e.subject||"";return 0===t.indexOf(this.baseInbox)?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(e=>{e.resolver(t,{})}),!0;let r=t.permissionContext;if("publish"===r.operation){let e=this.all().find(e=>e.requestSubject===r.subject);if(e)return e.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{let r=this.getToken(t);if(r){let n=this.get(r);n&&(null===e&&t.headers&&(e=eJ(t)),n.resolver(e,t))}}}close(){let e=eE.errorForCode(O.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}class tT{ph;interval;maxOut;timer;pendings;constructor(e,t,r){this.ph=e,this.interval=t,this.maxOut=r,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:A.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut)return void this.cancel(!0);let e=eM();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}class t$ extends Error{constructor(e){super(e),this.name="AssertionError"}}let tU=0x100000000-2;function tq(e,t,r=0){let n=t.byteLength-r;return e.byteLength>n&&(e=e.subarray(0,n)),t.set(e,r),e.byteLength}class tL{_buf;_off;constructor(e){if(this._off=0,null==e){this._buf=new Uint8Array(0);return}this._buf=new Uint8Array(e)}bytes(e={copy:!0}){return!1===e.copy?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(0===e)return void this.reset();if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){let t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){!function(e,t="Assertion failed."){if(!e)throw new t$(t)}(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){let e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return(this.reset(),0===e.byteLength)?0:null;let t=tq(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(em.encode(e))}write(e){let t=this._grow(e.byteLength);return tq(e,this._buf,t)}_grow(e){let t=this.length;0===t&&0!==this._off&&this.reset();let r=this._tryGrowByReslice(e);if(r>=0)return r;let n=this.capacity;if(e<=Math.floor(n/2)-t)tq(this._buf.subarray(this._off),this._buf);else if(n+e>tU)throw Error("The buffer cannot be grown beyond the maximum size.");else{let t=new Uint8Array(Math.min(2*n+e,tU));tq(this._buf.subarray(this._off),t),this._buf=t}return this._off=0,this._reslice(Math.min(t+e,tU)),t}grow(e){if(e<0)throw Error("Buffer._grow: negative count");let t=this._grow(e);this._reslice(t)}readFrom(e){let t=0,r=new Uint8Array(32768);for(;;){let n=this.capacity-this.length<32768,s=n?r:new Uint8Array(this._buf.buffer,this.length),i=e.read(s);if(null===i)return t;n?this.write(s.subarray(0,i)):this._reslice(this.length+i),t+=i}}}function tF(){let e={};return e.sid=-1,e.hdr=-1,e.size=-1,e}(K=ei||(ei={}))[K.OK=0]="OK",K[K.ERR=1]="ERR",K[K.MSG=2]="MSG",K[K.INFO=3]="INFO",K[K.PING=4]="PING",K[K.PONG=5]="PONG";class tB{dispatcher;state;as;drop;hdr;ma;argBuf;msgBuf;constructor(e){this.dispatcher=e,this.state=eo.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){let r=e[t];switch(this.state){case eo.OP_START:switch(r){case ea.M:case ea.m:this.state=eo.OP_M,this.hdr=-1,this.ma=tF();break;case ea.H:case ea.h:this.state=eo.OP_H,this.hdr=0,this.ma=tF();break;case ea.P:case ea.p:this.state=eo.OP_P;break;case ea.PLUS:this.state=eo.OP_PLUS;break;case ea.MINUS:this.state=eo.OP_MINUS;break;case ea.I:case ea.i:this.state=eo.OP_I;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_H:switch(r){case ea.M:case ea.m:this.state=eo.OP_M;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_M:switch(r){case ea.S:case ea.s:this.state=eo.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_MS:switch(r){case ea.G:case ea.g:this.state=eo.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_MSG:switch(r){case ea.SPACE:case ea.TAB:this.state=eo.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_MSG_SPC:switch(r){case ea.SPACE:case ea.TAB:continue;default:this.state=eo.MSG_ARG,this.as=t}break;case eo.MSG_ARG:switch(r){case ea.CR:this.drop=1;break;case ea.NL:{let r=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(r),this.drop=0,this.as=t+1,this.state=eo.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;case eo.MSG_PAYLOAD:if(this.msgBuf)if(this.msgBuf.length>=this.ma.size){let e=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:ei.MSG,msg:this.ma,data:e}),this.argBuf=void 0,this.msgBuf=void 0,this.state=eo.MSG_END}else{let n=this.ma.size-this.msgBuf.length,s=e.length-t;s<n&&(n=s),n>0?(this.msgBuf.write(e.subarray(t,t+n)),t=t+n-1):this.msgBuf.writeByte(r)}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:ei.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=eo.MSG_END);break;case eo.MSG_END:if(r!==ea.NL)continue;this.drop=0,this.as=t+1,this.state=eo.OP_START;break;case eo.OP_PLUS:switch(r){case ea.O:case ea.o:this.state=eo.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_PLUS_O:switch(r){case ea.K:case ea.k:this.state=eo.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_PLUS_OK:r===ea.NL&&(this.dispatcher.push({kind:ei.OK}),this.drop=0,this.state=eo.OP_START);break;case eo.OP_MINUS:switch(r){case ea.E:case ea.e:this.state=eo.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_MINUS_E:switch(r){case ea.R:case ea.r:this.state=eo.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_MINUS_ER:switch(r){case ea.R:case ea.r:this.state=eo.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_MINUS_ERR:switch(r){case ea.SPACE:case ea.TAB:this.state=eo.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_MINUS_ERR_SPC:switch(r){case ea.SPACE:case ea.TAB:continue;default:this.state=eo.MINUS_ERR_ARG,this.as=t}break;case eo.MINUS_ERR_ARG:switch(r){case ea.CR:this.drop=1;break;case ea.NL:{let r;this.argBuf?(r=this.argBuf.bytes(),this.argBuf=void 0):r=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:ei.ERR,data:r}),this.drop=0,this.as=t+1,this.state=eo.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(r))}break;case eo.OP_P:switch(r){case ea.I:case ea.i:this.state=eo.OP_PI;break;case ea.O:case ea.o:this.state=eo.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_PO:switch(r){case ea.N:case ea.n:this.state=eo.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_PON:switch(r){case ea.G:case ea.g:this.state=eo.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_PONG:r===ea.NL&&(this.dispatcher.push({kind:ei.PONG}),this.drop=0,this.state=eo.OP_START);break;case eo.OP_PI:switch(r){case ea.N:case ea.n:this.state=eo.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_PIN:switch(r){case ea.G:case ea.g:this.state=eo.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_PING:r===ea.NL&&(this.dispatcher.push({kind:ei.PING}),this.drop=0,this.state=eo.OP_START);break;case eo.OP_I:switch(r){case ea.N:case ea.n:this.state=eo.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_IN:switch(r){case ea.F:case ea.f:this.state=eo.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_INF:switch(r){case ea.O:case ea.o:this.state=eo.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_INFO:switch(r){case ea.SPACE:case ea.TAB:this.state=eo.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case eo.OP_INFO_SPC:switch(r){case ea.SPACE:case ea.TAB:continue;default:this.state=eo.INFO_ARG,this.as=t}break;case eo.INFO_ARG:switch(r){case ea.CR:this.drop=1;break;case ea.NL:{let r;this.argBuf?(r=this.argBuf.bytes(),this.argBuf=void 0):r=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:ei.INFO,data:r}),this.drop=0,this.as=t+1,this.state=eo.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;default:throw this.fail(e.subarray(t))}}this.state!==eo.MSG_ARG&&this.state!==eo.MINUS_ERR_ARG&&this.state!==eo.INFO_ARG||this.argBuf||(this.argBuf=new tL(e.subarray(this.as,t-this.drop))),this.state!==eo.MSG_PAYLOAD||this.msgBuf||(this.argBuf||this.cloneMsgArg(),this.msgBuf=new tL(e.subarray(this.as)))}cloneMsgArg(){let e=this.ma.subject.length,t=new Uint8Array(e+(this.ma.reply?this.ma.reply.length:0));t.set(this.ma.subject),this.ma.reply&&t.set(this.ma.reply,e),this.argBuf=new tL(t),this.ma.subject=t.subarray(0,e),this.ma.reply&&(this.ma.reply=t.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);let t=[],r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case ea.SPACE:case ea.TAB:case ea.CR:case ea.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t=t?`${t} [${this.state}]`:`parse error [${this.state}]`,Error(`${t}: ${e_.decode(e)}`)}processHeaderMsgArgs(e){let t=[],r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case ea.SPACE:case ea.TAB:case ea.CR:case ea.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(0===e.length)return -1;let t=0;for(let r=0;r<e.length;r++){if(e[r]<48||e[r]>57)return -1;t=10*t+(e[r]-48)}return t}}(W=eo||(eo={}))[W.OP_START=0]="OP_START",W[W.OP_PLUS=1]="OP_PLUS",W[W.OP_PLUS_O=2]="OP_PLUS_O",W[W.OP_PLUS_OK=3]="OP_PLUS_OK",W[W.OP_MINUS=4]="OP_MINUS",W[W.OP_MINUS_E=5]="OP_MINUS_E",W[W.OP_MINUS_ER=6]="OP_MINUS_ER",W[W.OP_MINUS_ERR=7]="OP_MINUS_ERR",W[W.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",W[W.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",W[W.OP_M=10]="OP_M",W[W.OP_MS=11]="OP_MS",W[W.OP_MSG=12]="OP_MSG",W[W.OP_MSG_SPC=13]="OP_MSG_SPC",W[W.MSG_ARG=14]="MSG_ARG",W[W.MSG_PAYLOAD=15]="MSG_PAYLOAD",W[W.MSG_END=16]="MSG_END",W[W.OP_H=17]="OP_H",W[W.OP_P=18]="OP_P",W[W.OP_PI=19]="OP_PI",W[W.OP_PIN=20]="OP_PIN",W[W.OP_PING=21]="OP_PING",W[W.OP_PO=22]="OP_PO",W[W.OP_PON=23]="OP_PON",W[W.OP_PONG=24]="OP_PONG",W[W.OP_I=25]="OP_I",W[W.OP_IN=26]="OP_IN",W[W.OP_INF=27]="OP_INF",W[W.OP_INFO=28]="OP_INFO",W[W.OP_INFO_SPC=29]="OP_INFO_SPC",W[W.INFO_ARG=30]="INFO_ARG",(V=ea||(ea={}))[V.CR=13]="CR",V[V.E=69]="E",V[V.e=101]="e",V[V.F=70]="F",V[V.f=102]="f",V[V.G=71]="G",V[V.g=103]="g",V[V.H=72]="H",V[V.h=104]="h",V[V.I=73]="I",V[V.i=105]="i",V[V.K=75]="K",V[V.k=107]="k",V[V.M=77]="M",V[V.m=109]="m",V[V.MINUS=45]="MINUS",V[V.N=78]="N",V[V.n=110]="n",V[V.NL=10]="NL",V[V.O=79]="O",V[V.o=111]="o",V[V.P=80]="P",V[V.p=112]="p",V[V.PLUS=43]="PLUS",V[V.R=82]="R",V[V.r=114]="r",V[V.S=83]="S",V[V.s=115]="s",V[V.SPACE=32]="SPACE",V[V.TAB=9]="TAB",function(t){var r,n=function(e,t){this.hi=0|e,this.lo=0|t},s=function(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;t++)r[t]=e[t];return r},i=function(){throw Error("no PRNG")},o=new Uint8Array(16),a=new Uint8Array(32);a[0]=9;var c=s(),u=s([1]),h=s([56129,1]),l=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),f=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),p=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),g=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function m(e,t){return e<<t|e>>>32-t}function _(e,t){var r=255&e[t+3];return(r=(r=r<<8|255&e[t+2])<<8|255&e[t+1])<<8|255&e[t+0]}function b(e,t){return new n(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],e[t+4]<<24|e[t+5]<<16|e[t+6]<<8|e[t+7])}function y(e,t,r){var n;for(n=0;n<4;n++)e[t+n]=255&r,r>>>=8}function v(e,t,r){e[t]=r.hi>>24&255,e[t+1]=r.hi>>16&255,e[t+2]=r.hi>>8&255,e[t+3]=255&r.hi,e[t+4]=r.lo>>24&255,e[t+5]=r.lo>>16&255,e[t+6]=r.lo>>8&255,e[t+7]=255&r.lo}function w(e,t,r,n,s){var i,o=0;for(i=0;i<s;i++)o|=e[t+i]^r[n+i];return(1&o-1>>>8)-1}function x(e,t,r,n){return w(e,t,r,n,16)}function S(e,t,r,n){return w(e,t,r,n,32)}function E(e,t,r,n,s){var i,o,a,c=new Uint32Array(16),u=new Uint32Array(16),h=new Uint32Array(16),l=new Uint32Array(4);for(i=0;i<4;i++)u[5*i]=_(n,4*i),u[1+i]=_(r,4*i),u[6+i]=_(t,4*i),u[11+i]=_(r,16+4*i);for(i=0;i<16;i++)h[i]=u[i];for(i=0;i<20;i++){for(o=0;o<4;o++){for(a=0;a<4;a++)l[a]=u[(5*o+4*a)%16];for(l[1]^=m(l[0]+l[3]|0,7),l[2]^=m(l[1]+l[0]|0,9),l[3]^=m(l[2]+l[1]|0,13),l[0]^=m(l[3]+l[2]|0,18),a=0;a<4;a++)c[4*o+(o+a)%4]=l[a]}for(a=0;a<16;a++)u[a]=c[a]}if(s){for(i=0;i<16;i++)u[i]=u[i]+h[i]|0;for(i=0;i<4;i++)u[5*i]=u[5*i]-_(n,4*i)|0,u[6+i]=u[6+i]-_(t,4*i)|0;for(i=0;i<4;i++)y(e,4*i,u[5*i]),y(e,16+4*i,u[6+i])}else for(i=0;i<16;i++)y(e,4*i,u[i]+h[i]|0)}function A(e,t,r,n){return E(e,t,r,n,!0),0}var O=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function P(e,t,r,n,s,i,o){var a,c,u=new Uint8Array(16),h=new Uint8Array(64);if(!s)return 0;for(c=0;c<16;c++)u[c]=0;for(c=0;c<8;c++)u[c]=i[c];for(;s>=64;){for(E(h,u,o,O,!1),c=0;c<64;c++)e[t+c]=(r?r[n+c]:0)^h[c];for(c=8,a=1;c<16;c++)a=a+(255&u[c])|0,u[c]=255&a,a>>>=8;s-=64,t+=64,r&&(n+=64)}if(s>0)for(E(h,u,o,O,!1),c=0;c<s;c++)e[t+c]=(r?r[n+c]:0)^h[c];return 0}function k(e,t,r,n,s){return P(e,t,null,0,r,n,s)}function j(e,t,r,n,s){var i=new Uint8Array(32);return A(i,n,s,O),k(e,t,r,n.subarray(16),i)}function C(e,t,r,n,s,i,o){var a=new Uint8Array(32);return A(a,i,o,O),P(e,t,r,n,s,i.subarray(16),a)}function I(e,t){var r,n=0;for(r=0;r<17;r++)n=n+(e[r]+t[r]|0)|0,e[r]=255&n,n>>>=8}var N=new Uint32Array([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252]);function R(e,t,r,n,s,i){var o,a,c,u,h=new Uint32Array(17),l=new Uint32Array(17),f=new Uint32Array(17),d=new Uint32Array(17),p=new Uint32Array(17);for(c=0;c<17;c++)l[c]=f[c]=0;for(c=0;c<16;c++)l[c]=i[c];for(l[3]&=15,l[4]&=252,l[7]&=15,l[8]&=252,l[11]&=15,l[12]&=252,l[15]&=15;s>0;){for(c=0;c<17;c++)d[c]=0;for(c=0;c<16&&c<s;++c)d[c]=r[n+c];for(d[c]=1,n+=c,s-=c,I(f,d),a=0;a<17;a++)for(c=0,h[a]=0;c<17;c++)h[a]=h[a]+f[c]*(c<=a?l[a-c]:320*l[a+17-c]|0)|0;for(a=0;a<17;a++)f[a]=h[a];for(c=0,u=0;c<16;c++)u=u+f[c]|0,f[c]=255&u,u>>>=8;for(c=0,u=u+f[16]|0,f[16]=3&u,u=5*(u>>>2)|0;c<16;c++)u=u+f[c]|0,f[c]=255&u,u>>>=8;u=u+f[16]|0,f[16]=u}for(c=0;c<17;c++)p[c]=f[c];for(I(f,N),o=0|-(f[16]>>>7),c=0;c<17;c++)f[c]^=o&(p[c]^f[c]);for(c=0;c<16;c++)d[c]=i[c+16];for(d[16]=0,I(f,d),c=0;c<16;c++)e[t+c]=f[c];return 0}function M(e,t,r,n,s,i){var o=new Uint8Array(16);return R(o,0,r,n,s,i),x(e,t,o,0)}function T(e,t,r,n,s){var i;if(r<32)return -1;for(C(e,0,t,0,r,n,s),R(e,16,e,32,r-32,e),i=0;i<16;i++)e[i]=0;return 0}function $(e,t,r,n,s){var i,o=new Uint8Array(32);if(r<32||(j(o,0,32,n,s),0!==M(t,16,t,32,r-32,o)))return -1;for(C(e,0,t,0,r,n,s),i=0;i<32;i++)e[i]=0;return 0}function U(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function q(e){var t,r;for(r=0;r<16;r++)e[r]+=65536,t=Math.floor(e[r]/65536),e[(r<15)*(r+1)]+=t-1+37*(t-1)*(15===r),e[r]-=65536*t}function L(e,t,r){for(var n,s=~(r-1),i=0;i<16;i++)n=s&(e[i]^t[i]),e[i]^=n,t[i]^=n}function F(e,t){var r,n,i,o=s(),a=s();for(r=0;r<16;r++)a[r]=t[r];for(q(a),q(a),q(a),n=0;n<2;n++){for(r=1,o[0]=a[0]-65517;r<15;r++)o[r]=a[r]-65535-(o[r-1]>>16&1),o[r-1]&=65535;o[15]=a[15]-32767-(o[14]>>16&1),i=o[15]>>16&1,o[14]&=65535,L(a,o,1-i)}for(r=0;r<16;r++)e[2*r]=255&a[r],e[2*r+1]=a[r]>>8}function B(e,t){var r=new Uint8Array(32),n=new Uint8Array(32);return F(r,e),F(n,t),S(r,0,n,0)}function D(e){var t=new Uint8Array(32);return F(t,e),1&t[0]}function z(e,t){var r;for(r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function H(e,t,r){var n;for(n=0;n<16;n++)e[n]=t[n]+r[n]|0}function J(e,t,r){var n;for(n=0;n<16;n++)e[n]=t[n]-r[n]|0}function G(e,t,r){var n,s,i=new Float64Array(31);for(n=0;n<31;n++)i[n]=0;for(n=0;n<16;n++)for(s=0;s<16;s++)i[n+s]+=t[n]*r[s];for(n=0;n<15;n++)i[n]+=38*i[n+16];for(n=0;n<16;n++)e[n]=i[n];q(e),q(e)}function K(e,t){G(e,t,t)}function W(e,t){var r,n=s();for(r=0;r<16;r++)n[r]=t[r];for(r=253;r>=0;r--)K(n,n),2!==r&&4!==r&&G(n,n,t);for(r=0;r<16;r++)e[r]=n[r]}function V(e,t){var r,n=s();for(r=0;r<16;r++)n[r]=t[r];for(r=250;r>=0;r--)K(n,n),1!==r&&G(n,n,t);for(r=0;r<16;r++)e[r]=n[r]}function Y(e,t,r){var n,i,o=new Uint8Array(32),a=new Float64Array(80),c=s(),u=s(),l=s(),f=s(),d=s(),p=s();for(i=0;i<31;i++)o[i]=t[i];for(o[31]=127&t[31]|64,o[0]&=248,z(a,r),i=0;i<16;i++)u[i]=a[i],f[i]=c[i]=l[i]=0;for(i=254,c[0]=f[0]=1;i>=0;--i)L(c,u,n=o[i>>>3]>>>(7&i)&1),L(l,f,n),H(d,c,l),J(c,c,l),H(l,u,f),J(u,u,f),K(f,d),K(p,c),G(c,l,c),G(l,u,d),H(d,c,l),J(c,c,l),K(u,c),J(l,f,p),G(c,l,h),H(c,c,f),G(l,l,c),G(c,f,p),G(f,u,a),K(u,d),L(c,u,n),L(l,f,n);for(i=0;i<16;i++)a[i+16]=c[i],a[i+32]=l[i],a[i+48]=u[i],a[i+64]=f[i];var g=a.subarray(32),m=a.subarray(16);return W(g,g),G(m,m,g),F(e,m),0}function Z(e,t){return Y(e,t,a)}function X(e,t){return i(t,32),Z(e,t)}function Q(e,t,r){var n=new Uint8Array(32);return Y(n,r,t),A(e,o,n,O)}function ee(){var e,t,r,s=0,i=0,o=0,a=0;for(r=0;r<arguments.length;r++)e=arguments[r].lo,t=arguments[r].hi,s+=65535&e,i+=e>>>16,o+=65535&t,a+=t>>>16;return i+=s>>>16,o+=i>>>16,a+=o>>>16,new n(65535&o|a<<16,65535&s|i<<16)}function et(e,t){return new n(e.hi>>>t,e.lo>>>t|e.hi<<32-t)}function er(){var e,t=0,r=0;for(e=0;e<arguments.length;e++)t^=arguments[e].lo,r^=arguments[e].hi;return new n(r,t)}function en(e,t){var r,s,i=32-t;return t<32?(r=e.hi>>>t|e.lo<<i,s=e.lo>>>t|e.hi<<i):t<64&&(r=e.lo>>>t|e.hi<<i,s=e.hi>>>t|e.lo<<i),new n(r,s)}var es=[new n(0x428a2f98,0xd728ae22),new n(0x71374491,0x23ef65cd),new n(0xb5c0fbcf,0xec4d3b2f),new n(0xe9b5dba5,0x8189dbbc),new n(0x3956c25b,0xf348b538),new n(0x59f111f1,0xb605d019),new n(0x923f82a4,0xaf194f9b),new n(0xab1c5ed5,0xda6d8118),new n(0xd807aa98,0xa3030242),new n(0x12835b01,0x45706fbe),new n(0x243185be,0x4ee4b28c),new n(0x550c7dc3,0xd5ffb4e2),new n(0x72be5d74,0xf27b896f),new n(0x80deb1fe,0x3b1696b1),new n(0x9bdc06a7,0x25c71235),new n(0xc19bf174,0xcf692694),new n(0xe49b69c1,0x9ef14ad2),new n(0xefbe4786,0x384f25e3),new n(0xfc19dc6,0x8b8cd5b5),new n(0x240ca1cc,0x77ac9c65),new n(0x2de92c6f,0x592b0275),new n(0x4a7484aa,0x6ea6e483),new n(0x5cb0a9dc,0xbd41fbd4),new n(0x76f988da,0x831153b5),new n(0x983e5152,0xee66dfab),new n(0xa831c66d,0x2db43210),new n(0xb00327c8,0x98fb213f),new n(0xbf597fc7,0xbeef0ee4),new n(0xc6e00bf3,0x3da88fc2),new n(0xd5a79147,0x930aa725),new n(0x6ca6351,0xe003826f),new n(0x14292967,0xa0e6e70),new n(0x27b70a85,0x46d22ffc),new n(0x2e1b2138,0x5c26c926),new n(0x4d2c6dfc,0x5ac42aed),new n(0x53380d13,0x9d95b3df),new n(0x650a7354,0x8baf63de),new n(0x766a0abb,0x3c77b2a8),new n(0x81c2c92e,0x47edaee6),new n(0x92722c85,0x1482353b),new n(0xa2bfe8a1,0x4cf10364),new n(0xa81a664b,0xbc423001),new n(0xc24b8b70,0xd0f89791),new n(0xc76c51a3,0x654be30),new n(0xd192e819,0xd6ef5218),new n(0xd6990624,0x5565a910),new n(0xf40e3585,0x5771202a),new n(0x106aa070,0x32bbd1b8),new n(0x19a4c116,0xb8d2d0c8),new n(0x1e376c08,0x5141ab53),new n(0x2748774c,0xdf8eeb99),new n(0x34b0bcb5,0xe19b48a8),new n(0x391c0cb3,0xc5c95a63),new n(0x4ed8aa4a,0xe3418acb),new n(0x5b9cca4f,0x7763e373),new n(0x682e6ff3,0xd6b2b8a3),new n(0x748f82ee,0x5defb2fc),new n(0x78a5636f,0x43172f60),new n(0x84c87814,0xa1f0ab72),new n(0x8cc70208,0x1a6439ec),new n(0x90befffa,0x23631e28),new n(0xa4506ceb,0xde82bde9),new n(0xbef9a3f7,0xb2c67915),new n(0xc67178f2,0xe372532b),new n(0xca273ece,0xea26619c),new n(0xd186b8c7,0x21c0c207),new n(0xeada7dd6,0xcde0eb1e),new n(0xf57d4f7f,0xee6ed178),new n(0x6f067aa,0x72176fba),new n(0xa637dc5,0xa2c898a6),new n(0x113f9804,0xbef90dae),new n(0x1b710b35,0x131c471b),new n(0x28db77f5,0x23047d84),new n(0x32caab7b,0x40c72493),new n(0x3c9ebe0a,0x15c9bebc),new n(0x431d67c4,0x9c100d4c),new n(0x4cc5d4be,0xcb3e42b6),new n(0x597f299c,0xfc657e2a),new n(0x5fcb6fab,0x3ad6faec),new n(0x6c44198c,0x4a475817)];function ei(e,t,r){var s,i,o,a,c,u,h,l,f,d,p,g,m,_=[],y=[],w=[],x=[];for(g=0;g<8;g++)_[g]=w[g]=b(e,8*g);for(var S=0;r>=128;){for(g=0;g<16;g++)x[g]=b(t,8*g+S);for(g=0;g<80;g++){for(m=0;m<8;m++)y[m]=w[m];for(m=0,p=ee(w[7],er(en(s=w[4],14),en(s,18),en(s,41)),(i=w[4],o=w[5],a=w[6],new n(i.hi&o.hi^~i.hi&a.hi,i.lo&o.lo^~i.lo&a.lo)),es[g],x[g%16]),y[7]=ee(p,er(en(c=w[0],28),en(c,34),en(c,39)),(u=w[0],h=w[1],l=w[2],new n(u.hi&h.hi^u.hi&l.hi^h.hi&l.hi,u.lo&h.lo^u.lo&l.lo^h.lo&l.lo))),y[3]=ee(y[3],p);m<8;m++)w[(m+1)%8]=y[m];if(g%16==15)for(m=0;m<16;m++)x[m]=ee(x[m],x[(m+9)%16],er(en(f=x[(m+1)%16],1),en(f,8),et(f,7)),er(en(d=x[(m+14)%16],19),en(d,61),et(d,6)))}for(g=0;g<8;g++)w[g]=ee(w[g],_[g]),_[g]=w[g];S+=128,r-=128}for(g=0;g<8;g++)v(e,8*g,_[g]);return r}var eo=new Uint8Array([106,9,230,103,243,188,201,8,187,103,174,133,132,202,167,59,60,110,243,114,254,148,248,43,165,79,245,58,95,29,54,241,81,14,82,127,173,230,130,209,155,5,104,140,43,62,108,31,31,131,217,171,251,65,189,107,91,224,205,25,19,126,33,121]);function ea(e,t,r){var s,i=new Uint8Array(64),o=new Uint8Array(256),a=r;for(s=0;s<64;s++)i[s]=eo[s];for(ei(i,t,r),r%=128,s=0;s<256;s++)o[s]=0;for(s=0;s<r;s++)o[s]=t[a-r+s];for(o[r]=128,o[(r=256-(r<112)*128)-9]=0,v(o,r-8,new n(a/0x20000000|0,a<<3)),ei(i,o,r),s=0;s<64;s++)e[s]=i[s];return 0}function ec(e,t){var r=s(),n=s(),i=s(),o=s(),a=s(),c=s(),u=s(),h=s(),l=s();J(r,e[1],e[0]),J(l,t[1],t[0]),G(r,r,l),H(n,e[0],e[1]),H(l,t[0],t[1]),G(n,n,l),G(i,e[3],t[3]),G(i,i,f),G(o,e[2],t[2]),H(o,o,o),J(a,n,r),J(c,o,i),H(u,o,i),H(h,n,r),G(e[0],a,c),G(e[1],h,u),G(e[2],u,c),G(e[3],a,h)}function eu(e,t,r){var n;for(n=0;n<4;n++)L(e[n],t[n],r)}function eh(e,t){var r=s(),n=s(),i=s();W(i,t[2]),G(r,t[0],i),G(n,t[1],i),F(e,n),e[31]^=D(r)<<7}function el(e,t,r){var n,s;for(U(e[0],c),U(e[1],u),U(e[2],u),U(e[3],c),s=255;s>=0;--s)eu(e,t,n=r[s/8|0]>>(7&s)&1),ec(t,e),ec(e,e),eu(e,t,n)}function ef(e,t){var r=[s(),s(),s(),s()];U(r[0],d),U(r[1],p),U(r[2],u),G(r[3],d,p),el(e,r,t)}function ed(e,t,r){var n,o=new Uint8Array(64),a=[s(),s(),s(),s()];for(r||i(t,32),ea(o,t,32),o[0]&=248,o[31]&=127,o[31]|=64,ef(a,o),eh(e,a),n=0;n<32;n++)t[n+32]=e[n];return 0}var ep=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function eg(e,t){var r,n,s,i;for(n=63;n>=32;--n){for(r=0,s=n-32,i=n-12;s<i;++s)t[s]+=r-16*t[n]*ep[s-(n-32)],r=Math.floor((t[s]+128)/256),t[s]-=256*r;t[s]+=r,t[n]=0}for(s=0,r=0;s<32;s++)t[s]+=r-(t[31]>>4)*ep[s],r=t[s]>>8,t[s]&=255;for(s=0;s<32;s++)t[s]-=r*ep[s];for(n=0;n<32;n++)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function em(e){var t,r=new Float64Array(64);for(t=0;t<64;t++)r[t]=e[t];for(t=0;t<64;t++)e[t]=0;eg(e,r)}function e_(e,t,r,n){var i,o,a=new Uint8Array(64),c=new Uint8Array(64),u=new Uint8Array(64),h=new Float64Array(64),l=[s(),s(),s(),s()];for(ea(a,n,32),a[0]&=248,a[31]&=127,a[31]|=64,i=0;i<r;i++)e[64+i]=t[i];for(i=0;i<32;i++)e[32+i]=a[32+i];for(ea(u,e.subarray(32),r+32),em(u),ef(l,u),eh(e,l),i=32;i<64;i++)e[i]=n[i];for(ea(c,e,r+64),em(c),i=0;i<64;i++)h[i]=0;for(i=0;i<32;i++)h[i]=u[i];for(i=0;i<32;i++)for(o=0;o<32;o++)h[i+o]+=c[i]*a[o];return eg(e.subarray(32),h),r+64}function eb(e,t,r,n){var i,o,a,h,f,d,p,m,_=new Uint8Array(32),b=new Uint8Array(64),y=[s(),s(),s(),s()],v=[s(),s(),s(),s()];if(r<64||(i=s(),o=s(),a=s(),h=s(),f=s(),d=s(),p=s(),(U(v[2],u),z(v[1],n),K(a,v[1]),G(h,a,l),J(a,a,v[2]),H(h,v[2],h),K(f,h),K(d,f),G(p,d,f),G(i,p,a),G(i,i,h),V(i,i),G(i,i,a),G(i,i,h),G(i,i,h),G(v[0],i,h),K(o,v[0]),G(o,o,h),B(o,a)&&G(v[0],v[0],g),K(o,v[0]),G(o,o,h),B(o,a))?-1:(D(v[0])===n[31]>>7&&J(v[0],c,v[0]),G(v[3],v[0],v[1]),0)))return -1;for(m=0;m<r;m++)e[m]=t[m];for(m=0;m<32;m++)e[m+32]=n[m];if(ea(b,e,r),em(b),el(y,v,b),ef(v,t.subarray(32)),ec(y,v),eh(_,y),r-=64,S(t,0,_,0)){for(m=0;m<r;m++)e[m]=0;return -1}for(m=0;m<r;m++)e[m]=t[m+64];return r}function ey(e,t){if(32!==e.length)throw Error("bad key size");if(24!==t.length)throw Error("bad nonce size")}function ev(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw TypeError("unexpected type, use Uint8Array")}function ew(e){for(var t=0;t<e.length;t++)e[t]=0}t.lowlevel={crypto_core_hsalsa20:A,crypto_stream_xor:C,crypto_stream:j,crypto_stream_salsa20_xor:P,crypto_stream_salsa20:k,crypto_onetimeauth:R,crypto_onetimeauth_verify:M,crypto_verify_16:x,crypto_verify_32:S,crypto_secretbox:T,crypto_secretbox_open:$,crypto_scalarmult:Y,crypto_scalarmult_base:Z,crypto_box_beforenm:Q,crypto_box_afternm:T,crypto_box:function(e,t,r,n,s,i){var o=new Uint8Array(32);return Q(o,s,i),T(e,t,r,n,o)},crypto_box_open:function(e,t,r,n,s,i){var o=new Uint8Array(32);return Q(o,s,i),$(e,t,r,n,o)},crypto_box_keypair:X,crypto_hash:ea,crypto_sign:e_,crypto_sign_keypair:ed,crypto_sign_open:eb,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:s,D:l,L:ep,pack25519:F,unpack25519:z,M:G,A:H,S:K,Z:J,pow2523:V,add:ec,set25519:U,modL:eg,scalarmult:el,scalarbase:ef},t.randomBytes=function(e){var t=new Uint8Array(e);return i(t,e),t},t.secretbox=function(e,t,r){ev(e,t,r),ey(r,t);for(var n=new Uint8Array(32+e.length),s=new Uint8Array(n.length),i=0;i<e.length;i++)n[i+32]=e[i];return T(s,n,n.length,t,r),s.subarray(16)},t.secretbox.open=function(e,t,r){ev(e,t,r),ey(r,t);for(var n=new Uint8Array(16+e.length),s=new Uint8Array(n.length),i=0;i<e.length;i++)n[i+16]=e[i];return n.length<32||0!==$(s,n,n.length,t,r)?null:s.subarray(32)},t.secretbox.keyLength=32,t.secretbox.nonceLength=24,t.secretbox.overheadLength=16,t.scalarMult=function(e,t){if(ev(e,t),32!==e.length)throw Error("bad n size");if(32!==t.length)throw Error("bad p size");var r=new Uint8Array(32);return Y(r,e,t),r},t.scalarMult.base=function(e){if(ev(e),32!==e.length)throw Error("bad n size");var t=new Uint8Array(32);return Z(t,e),t},t.scalarMult.scalarLength=32,t.scalarMult.groupElementLength=32,t.box=function(e,r,n,s){var i=t.box.before(n,s);return t.secretbox(e,r,i)},t.box.before=function(e,t){ev(e,t);if(32!==e.length)throw Error("bad public key size");if(32!==t.length)throw Error("bad secret key size");var r=new Uint8Array(32);return Q(r,e,t),r},t.box.after=t.secretbox,t.box.open=function(e,r,n,s){var i=t.box.before(n,s);return t.secretbox.open(e,r,i)},t.box.open.after=t.secretbox.open,t.box.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(32);return X(e,t),{publicKey:e,secretKey:t}},t.box.keyPair.fromSecretKey=function(e){if(ev(e),32!==e.length)throw Error("bad secret key size");var t=new Uint8Array(32);return Z(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},t.box.publicKeyLength=32,t.box.secretKeyLength=32,t.box.sharedKeyLength=32,t.box.nonceLength=24,t.box.overheadLength=t.secretbox.overheadLength,t.sign=function(e,t){if(ev(e,t),64!==t.length)throw Error("bad secret key size");var r=new Uint8Array(64+e.length);return e_(r,e,e.length,t),r},t.sign.open=function(e,t){if(ev(e,t),32!==t.length)throw Error("bad public key size");var r=new Uint8Array(e.length),n=eb(r,e,e.length,t);if(n<0)return null;for(var s=new Uint8Array(n),i=0;i<s.length;i++)s[i]=r[i];return s},t.sign.detached=function(e,r){for(var n=t.sign(e,r),s=new Uint8Array(64),i=0;i<s.length;i++)s[i]=n[i];return s},t.sign.detached.verify=function(e,t,r){if(ev(e,t,r),64!==t.length)throw Error("bad signature size");if(32!==r.length)throw Error("bad public key size");var n,s=new Uint8Array(64+e.length),i=new Uint8Array(64+e.length);for(n=0;n<64;n++)s[n]=t[n];for(n=0;n<e.length;n++)s[n+64]=e[n];return eb(i,s,s.length,r)>=0},t.sign.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(64);return ed(e,t),{publicKey:e,secretKey:t}},t.sign.keyPair.fromSecretKey=function(e){if(ev(e),64!==e.length)throw Error("bad secret key size");for(var t=new Uint8Array(32),r=0;r<t.length;r++)t[r]=e[32+r];return{publicKey:t,secretKey:new Uint8Array(e)}},t.sign.keyPair.fromSeed=function(e){if(ev(e),32!==e.length)throw Error("bad seed size");for(var t=new Uint8Array(32),r=new Uint8Array(64),n=0;n<32;n++)r[n]=e[n];return ed(t,r,!0),{publicKey:t,secretKey:r}},t.sign.publicKeyLength=32,t.sign.secretKeyLength=64,t.sign.seedLength=32,t.sign.signatureLength=64,t.hash=function(e){ev(e);var t=new Uint8Array(64);return ea(t,e,e.length),t},t.hash.hashLength=64,t.verify=function(e,t){return ev(e,t),0!==e.length&&0!==t.length&&e.length===t.length&&0===w(e,0,t,0,e.length)},t.setPRNG=function(e){i=e},(r="undefined"!=typeof globalThis?globalThis.crypto||globalThis.msCrypto:null)&&r.getRandomValues?t.setPRNG(function(e,t){var n,s=new Uint8Array(t);for(n=0;n<t;n+=65536)r.getRandomValues(s.subarray(n,n+Math.min(t-n,65536)));for(n=0;n<t;n++)e[n]=s[n];ew(s)}):(r=e.r(276826))&&r.randomBytes&&t.setPRNG(function(e,t){var n,s=r.randomBytes(t);for(n=0;n<t;n++)e[n]=s[n];ew(s)})}(globalThis.nacl=globalThis.nacl||{});let tD=globalThis.nacl,tz={fromSeed:tD.sign.keyPair.fromSeed,sign:tD.sign.detached,verify:tD.sign.detached.verify,randomBytes:tD.randomBytes};new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]);(Y=ec||(ec={})).InvalidPrefixByte="nkeys: invalid prefix byte",Y.InvalidKey="nkeys: invalid key",Y.InvalidPublicKey="nkeys: invalid public key",Y.InvalidSeedLen="nkeys: invalid seed length",Y.InvalidSeed="nkeys: invalid seed",Y.InvalidEncoding="nkeys: invalid encoded key",Y.InvalidSignature="nkeys: signature verification failed",Y.CannotSign="nkeys: cannot sign, no private key available",Y.PublicKeyOnly="nkeys: no seed or private key available",Y.InvalidChecksum="nkeys: invalid checksum",Y.SerializationError="nkeys: serialization error",Y.ApiError="nkeys: api error",Y.ClearedPair="nkeys: pair is cleared",(Z=eu||(eu={}))[Z.Seed=144]="Seed",Z[Z.Private=120]="Private",Z[Z.Operator=112]="Operator",Z[Z.Server=104]="Server",Z[Z.Cluster=16]="Cluster",Z[Z.Account=0]="Account",Z[Z.User=160]="User";r=tz;let tH=/^INFO\s+([^\r\n]+)\r\n/i,tJ=eb("PONG\r\n"),tG=eb("PING\r\n");class tK{echo;no_responders;protocol;verbose;pedantic;jwt;nkey;sig;user;pass;auth_token;tls_required;name;lang;version;headers;constructor(e,t,r){this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=!t.noEcho&&void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=!!t.tls||void 0,this.name=t.name,eC(this,(t&&"function"==typeof t.authenticator?t.authenticator(r):{})||{})}}class tW extends e1{sid;queue;draining;max;subject;drained;protocol;timer;info;cleanupFn;closed;requestSubject;constructor(e,t,r={}){super(),eC(this,r),this.protocol=e,this.subject=t,this.draining=!1,this.noIterator="function"==typeof r.callback,this.closed=eM();const n=!e.options?.noAsyncTraces;r.timeout&&(this.timer=eN(r.timeout,n),this.timer.then(()=>{this.timer=void 0}).catch(e=>{this.stop(e),this.noIterator&&this.callback(e,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(e){if(this.noIterator){let t=this.callback,r=e.ingestionFilterFn?e.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),n=e.protocolFilterFn?e.protocolFilterFn:()=>!0,s=e.dispatchedFn?e.dispatchedFn:()=>{};this.callback=(e,i)=>{let{ingest:o}=r(i);o&&n(i)&&(t(e,i),s(i))}}else this.protocolFilterFn=e.protocolFilterFn,this.dispatchedFn=e.dispatchedFn}callback(e,t){this.cancelTimeout(),e?this.stop(e):this.push(t)}close(){if(!this.isClosed()){this.cancelTimeout();let e=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch(e){}this.closed.resolve()};this.noIterator?e():this.push(e)}}unsubscribe(e){this.protocol.unsubscribe(this,e)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject(eE.errorForCode(O.ConnectionClosed)):this.isClosed()?Promise.reject(eE.errorForCode(O.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush(eM()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}class tV{mux;subs;sidCounter;constructor(){this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){let t,r=e.permissionContext,n=this.all();if("subscription"===r.operation&&(t=n.find(e=>e.subject===r.subject&&e.queue===r.queue)),"publish"===r.operation&&(t=n.find(e=>e.requestSubject===r.subject)),t)return t.callback(e,{}),t.close(),this.subs.delete(t.sid),t!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}class tY{connected;connectedOnce;infoReceived;info;muxSubscriptions;options;outbound;pongs;subscriptions;transport;noMorePublishing;connectError;publisher;_closed;closed;listeners;heartbeats;parser;outMsgs;inMsgs;outBytes;inBytes;pendingLimit;lastError;abortReconnect;whyClosed;servers;server;features;connectPromise;constructor(e,t){this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=32768,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new tV,this.muxSubscriptions=new tM,this.outbound=new e7,this.pongs=[],this.whyClosed="",this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new ty({major:0,minor:0,micro:0}),this.connectPromise=null;const r="string"==typeof e.servers?[e.servers]:e.servers;this.servers=new tR(r,{randomize:!e.noRandomize}),this.closed=eM(),this.parser=new tB(this),this.heartbeats=new tT(this,this.options.pingInterval||12e4,this.options.maxPingOut||2)}resetOutbound(){this.outbound.reset();let e=this.pongs;this.pongs=[];let t=eE.errorForCode(O.Disconnect);t.stack="",e.forEach(e=>{e.reject(t)}),this.parser=new tB(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){let e=new e1;return this.listeners.push(e),e}prepare(){this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();let e=eM();return e.catch(()=>{}),this.pongs.unshift(e),this.connectError=t=>{e.reject(t)},this.transport=function(){if(!t||"function"!=typeof t.factory)throw Error("transport fn is not set");return t.factory()}(),this.transport.closed().then(async e=>{if(this.connected=!1,!this.isClosed())return void await this.disconnected(this.transport.closeError||this.lastError)}),e}disconnect(){this.dispatchStatus({type:A.StaleConnection,data:""}),this.transport.disconnect()}reconnect(){return this.connected&&(this.dispatchStatus({type:A.ClientInitiatedReconnect,data:""}),this.transport.disconnect()),Promise.resolve()}async disconnected(e){this.dispatchStatus({type:E.Disconnect,data:this.servers.getCurrentServer().toString()}),this.options.reconnect?await this.dialLoop().then(()=>{this.dispatchStatus({type:E.Reconnect,data:this.servers.getCurrentServer().toString()}),this.lastError?.code===O.AuthenticationExpired&&(this.lastError=void 0)}).catch(e=>{this._close(e)}):await this._close(e)}async dial(e){let t,r=this.prepare();try{t=eN(this.options.timeout||2e4);let r=this.transport.connect(e,this.options);await Promise.race([r,t]),(async()=>{try{for await(let e of this.transport)this.parser.parse(e)}catch(e){console.log("reader closed",e)}})().then()}catch(e){r.reject(e)}try{await Promise.race([t,r]),t&&t.cancel(),this.connected=!0,this.connectError=void 0,this.sendSubscriptions(),this.connectedOnce=!0,this.server.didConnect=!0,this.server.reconnects=0,this.flushPending(),this.heartbeats.start()}catch(e){throw t&&t.cancel(),await this.transport.close(e),e}}async _doDial(e){let{resolve:t}=this.options,r=await e.resolve({fn:tA(),debug:this.options.debug,randomize:!this.options.noRandomize,resolve:t}),n=null;for(let e of r)try{n=null,this.dispatchStatus({type:A.Reconnecting,data:e.toString()}),await this.dial(e);return}catch(e){n=e}throw n}dialLoop(){return null===this.connectPromise&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}async dodialLoop(){let e;for(;;){this._closed&&this.servers.clear();let t=this.options.reconnectDelayHandler?this.options.reconnectDelayHandler():2e3,r=t,n=this.selectServer();if(!n||this.abortReconnect)if(e)throw e;else if(this.lastError)throw this.lastError;else throw eE.errorForCode(O.ConnectionRefused);let s=Date.now();if(0===n.lastConnect||n.lastConnect+t<=s){n.lastConnect=Date.now();try{await this._doDial(n);break}catch(r){if(e=r,!this.connectedOnce){if(this.options.waitOnFirstConnect)continue;this.servers.removeCurrentServer()}n.reconnects++;let t=this.options.maxReconnectAttempts||0;-1!==t&&n.reconnects>=t&&this.servers.removeCurrentServer()}}else r=Math.min(r,n.lastConnect+t-s),await eR(r)}}static async connect(e,t){let r=new tY(e,t);return await r.dialLoop(),r}static toError(e){let t=e?e.toLowerCase():"";if(-1!==t.indexOf("permissions violation")){let t=new eE(e,O.PermissionsViolation),r=e.match(/(Publish|Subscription) to "(\S+)"/);if(r){t.permissionContext={operation:r[1].toLowerCase(),subject:r[2],queue:void 0};let n=e.match(/using queue "(\S+)"/);n&&(t.permissionContext.queue=n[1])}return t}if(-1!==t.indexOf("authorization violation"))return new eE(e,O.AuthorizationViolation);if(-1!==t.indexOf("user authentication expired"))return new eE(e,O.AuthenticationExpired);if(-1!=t.indexOf("account authentication expired"))return new eE(e,O.AccountExpired);if(-1!==t.indexOf("authentication timeout"))return new eE(e,O.AuthenticationTimeout);else return new eE(e,O.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;let r=this.subscriptions.get(e.sid);r&&(r.received+=1,r.callback&&r.callback(null,new eG(e,t,this)),void 0!==r.max&&r.received>=r.max&&r.unsubscribe())}processError(e){let t=ey(e),r=tY.toError(t),n={type:E.Error,data:r.code};if(r.isPermissionError()){let e=!1;if(r.permissionContext){n.permissionContext=r.permissionContext;let t=this.subscriptions.getMux();e=t?.subject===r.permissionContext.subject}this.subscriptions.handleError(r),this.muxSubscriptions.handleError(e,r),e&&this.subscriptions.setMux(null)}this.dispatchStatus(n),this.handleError(r)}handleError(e){e.isAuthError()?this.handleAuthError(e):e.isProtocolError()?this.lastError=e:e.isAuthTimeout()&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&!1===this.options.ignoreAuthErrorAbort&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(tJ)}processPong(){let e=this.pongs.shift();e&&e.resolve()}processInfo(e){let t=JSON.parse(ey(e));this.info=t;let r=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t,this.transport.isEncrypted());if(!this.infoReceived){this.features.update(t_(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();let{version:e,lang:r}=this.transport;try{let n=new tK({version:e,lang:r},this.options,t.nonce);t.headers&&(n.headers=!0,n.no_responders=!0);let s=JSON.stringify(n);this.transport.send(eb(`CONNECT ${s}\r
`)),this.transport.send(tG)}catch(e){this._close(e)}}r&&this.dispatchStatus({type:E.Update,data:r}),void 0!==t.ldm&&t.ldm&&this.dispatchStatus({type:E.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case ei.MSG:{let{msg:t,data:r}=e;this.processMsg(t,r);break}case ei.OK:break;case ei.ERR:this.processError(e.data);break;case ei.PING:this.processPing();break;case ei.PONG:this.processPong();break;case ei.INFO:this.processInfo(e.data)}}sendCommand(e,...t){let r,n=this.outbound.length();r="string"==typeof e?eb(e):e,this.outbound.fill(r,...t),0===n?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=eg,r){let n,s;if(t instanceof Uint8Array)n=t;else if("string"==typeof t)n=em.encode(t);else throw eE.errorForCode(O.BadPayload);let i=n.length;(r=r||{}).reply=r.reply||"";let o=eg,a=0;if(r.headers){if(this.info&&!this.info.headers)throw new eE("headers",O.ServerOptionNotAvailable);a=(o=r.headers.encode()).length,i=n.length+a}if(this.info&&i>this.info.max_payload)throw eE.errorForCode(O.MaxPayloadExceeded);this.outBytes+=i,this.outMsgs++,r.headers?(s=r.reply?`HPUB ${e} ${r.reply} ${a} ${i}\r
`:`HPUB ${e} ${a} ${i}\r
`,this.sendCommand(s,o,n,tO)):(s=r.reply?`PUB ${e} ${r.reply} ${i}\r
`:`PUB ${e} ${i}\r
`,this.sendCommand(s,n,tO))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){e.queue?this.sendCommand(`SUB ${e.subject} ${e.queue} ${e.sid}\r
`):this.sendCommand(`SUB ${e.subject} ${e.sid}\r
`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(void 0===e.max||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(t?this.sendCommand(`UNSUB ${e.sid} ${t}\r
`):this.sendCommand(`UNSUB ${e.sid}\r
`),e.max=t)}resub(e,t){!e||this.isClosed()||(this.unsub(e),e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=eM()),this.pongs.push(e),this.outbound.fill(tG),this.flushPending(),e}sendSubscriptions(){let e=[];this.subscriptions.all().forEach(t=>{t.queue?e.push(`SUB ${t.subject} ${t.queue} ${t.sid}\r
`):e.push(`SUB ${t.subject} ${t.sid}\r
`)}),e.length&&this.transport.send(eb(e.join("")))}async _close(e){this._closed||(this.whyClosed=Error("close trace").stack||"",this.heartbeats.cancel(),this.connectError&&(this.connectError(e),this.connectError=void 0),this.muxSubscriptions.close(),this.subscriptions.close(),this.listeners.forEach(e=>{e.stop()}),this._closed=!0,await this.transport.close(e),await this.closed.resolve(e))}close(){return this._close()}isClosed(){return this._closed}drain(){let e=this.subscriptions.all(),t=[];return e.forEach(e=>{t.push(e.drain())}),Promise.all(t).then(async()=>(this.noMorePublishing=!0,await this.flush(),this.close())).catch(()=>{})}flushPending(){if(this.infoReceived&&this.connected&&this.outbound.size()){let e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){let e=this.muxSubscriptions.init(this.options.inboxPrefix),t=new tW(this,`${e}*`);t.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(t),this.subscribe(t)}}selectServer(){let e=this.servers.selectServer();if(void 0!==e)return this.server=e,this.server}getServer(){return this.server}}class tZ{msg;constructor(e){this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,r,n){return(n=n||{}).headers=n.headers||eF(),n.headers?.set(eO,`${e}`),n.headers?.set(eA,t),this.msg.respond(r,n)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}class tX{subject;queue;srv;constructor(e,t="",r=""){""!==t&&function(e,t){if(-1!==t.indexOf(" "))throw Error(`${e} cannot contain spaces: '${t}'`);t.split(".").forEach(r=>{if(">"===r)throw Error(`${e} name cannot contain internal '>': '${t}'`)})}("service group",t);let n="";if(e instanceof tQ)this.srv=e,n="";else if(e instanceof tX)this.srv=e.srv,""===r&&""!==e.queue&&(r=e.queue),n=e.subject;else throw Error("unknown ServiceGroup type");this.subject=this.calcSubject(n,t),this.queue=r}calcSubject(e,t=""){return""===t?e:""!==e?`${e}.${t}`:t}addEndpoint(e="",t){let r="function"==typeof(t=t||{subject:e})?{handler:t,subject:e}:t;eY("endpoint",e);let{subject:n,handler:s,metadata:i,queue:o}=r;n=n||e,o=o||this.queue,function(e,t){if(""===t)throw Error(`${e} cannot be empty`);if(-1!==t.indexOf(" "))throw Error(`${e} cannot contain spaces: '${t}'`);let r=t.split(".");r.forEach((n,s)=>{if(">"===n&&s!==r.length-1)throw Error(`${e} cannot have internal '>': '${t}'`)})}("endpoint subject",n);let a={name:e,subject:n=this.calcSubject(this.subject,n),queue:o,handler:s,metadata:i};return this.srv._addEndpoint(a)}addGroup(e="",t=""){return new tX(this,e,t)}}class tQ{nc;_id;config;handlers;internal;_stopped;_done;started;static controlSubject(e,t="",r="",n){let s=n??"$SRV";return""===t&&""===r?`${s}.${e}`:(eY("control subject name",t),""!==r)?(eY("control subject id",r),`${s}.${e}.${t}.${r}`):`${s}.${e}.${t}`}constructor(e,t={name:"",version:""}){this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),eY("name",this.config.name),eY("queue",this.config.queue),t_(this.config.version),this._id=ew.next(),this.internal=[],this._done=eM(),this._stopped=!1,this.handlers=[],this.started=new Date().toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(e=>{this.close(e).catch()})}get subjects(){return this.handlers.filter(e=>!1===e.internal).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){return this.config.description??""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){let t=eF();return e instanceof eP?(t.set(eA,e.message),t.set(eO,`${e.code}`)):(t.set(eA,e.message),t.set(eO,"500")),t}setupHandler(e,t=!1){let r=t?"":e.queue?e.queue:this.config.queue,{name:n,subject:s,handler:i}=e;e.internal=t,t&&this.internal.push(e),e.stats=new t0(n,s,r),e.queue=r;let o=i?(t,r)=>{if(t)return void this.close(t);let n=Date.now();try{i(t,new tZ(r))}catch(t){e.stats.countError(t),r?.respond(eg,{headers:this.errorToHeader(t)})}finally{e.stats.countLatency(n)}}:void 0;return e.sub=this.nc.subscribe(s,{callback:o,queue:r}),e.sub.closed.then(()=>{this._stopped||this.close(Error(`required subscription ${e.subject} stopped`)).catch()}).catch(t=>{if(!this._stopped){let r=Error(`required subscription ${e.subject} errored: ${t.message}`);r.stack=t.stack,this.close(r).catch()}}),e}info(){return{type:j.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{let{subject:t,metadata:r,name:n,queue:s}=e;return{subject:t,metadata:r,name:n,queue_group:s}})}async stats(){let e=[];for(let t of this.handlers){if("function"==typeof this.config.statsHandler)try{t.stats.data=await this.config.statsHandler(t)}catch(e){t.stats.countError(e)}e.push(t.stats.stats(t.qi))}return{type:j.STATS,name:this.name,id:this.id,version:this.version,started:this.started,metadata:this.metadata,endpoints:e}}addInternalHandler(e,t){let r=`${e}`.toUpperCase();this._doAddInternalHandler(`${r}-all`,e,t),this._doAddInternalHandler(`${r}-kind`,e,t,this.name),this._doAddInternalHandler(`${r}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,r,n="",s=""){let i={};i.name=e,i.subject=tQ.controlSubject(t,n,s),i.handler=r,this.setupHandler(i,!0)}start(){let e=eH(),t=(t,r)=>t?(this.close(t),Promise.reject(t)):this.stats().then(t=>(r?.respond(e.encode(t)),Promise.resolve())),r=(t,r)=>t?(this.close(t),Promise.reject(t)):(r?.respond(e.encode(this.info())),Promise.resolve()),n=e.encode(this.ping()),s=(e,t)=>e?(this.close(e).then().catch(),Promise.reject(e)):(t.respond(n),Promise.resolve());return this.addInternalHandler(C.PING,s),this.addInternalHandler(C.STATS,t),this.addInternalHandler(C.INFO,r),this.handlers.forEach(e=>{let{subject:t}=e;"string"!=typeof t||null!==e.handler&&this.setupHandler(e)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(e=>e.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:j.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=new Date().toISOString(),this.handlers)for(let e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new tX(this,e,t)}addEndpoint(e,t){return new tX(this).addEndpoint(e,t)}_addEndpoint(e){let t=new e1;t.noIterator="function"==typeof e.handler,t.noIterator||(e.handler=(e,r)=>{e?this.stop(e).catch():t.push(new tZ(r))},t.iterClosed.then(()=>{this.close().catch()}));let r=this.setupHandler(e,!1);return r.qi=t,this.handlers.push(r),t}}class t0{name;subject;average_processing_time;num_requests;processing_time;num_errors;last_error;data;metadata;queue;constructor(e,t,r=""){this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=r}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0,e&&(e.time=0,e.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=eU(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){let{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:s,processing_time:i,last_error:o,data:a,queue:c}=this;return{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:s,processing_time:i,last_error:o,data:a,queue_group:c}}stats(e){return e?.noIterator===!1&&(this.processing_time=eU(e.time),this.num_requests=e.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}class t1{nc;prefix;opts;constructor(e,t={strategy:k.JitterTimer,maxWait:2e3},r){this.nc=e,this.prefix=r,this.opts=t}ping(e="",t=""){return this.q(C.PING,e,t)}stats(e="",t=""){return this.q(C.STATS,e,t)}info(e="",t=""){return this.q(C.INFO,e,t)}async q(e,t="",r=""){let n=new e1,s=eH(),i=tQ.controlSubject(e,t,r,this.prefix),o=await this.nc.requestMany(i,eg,this.opts);return(async()=>{for await(let e of o)try{let t=s.decode(e.data);n.push(t)}catch(e){n.push(()=>{n.stop(e)})}n.push(()=>{n.stop()})})().catch(e=>{n.stop(e)}),n}}function t2(){return{key:{encode:e=>e,decode:e=>e},value:{encode:e=>e,decode:e=>e}}}let t3="KV-Operation",t5=/^[-/=.\w]+$/,t4=/^[-/=.>*\w]+$/,t6=/^[-\w]+$/;function t8(e){if(e.startsWith(".")||e.endsWith(".")||!t5.test(e))throw Error(`invalid key: ${e}`)}function t7(e){if(e.startsWith(".")||e.endsWith(".")||!t4.test(e))throw Error(`invalid key: ${e}`)}function t9(e){if(e.startsWith(".")||e.endsWith("."))throw Error(`invalid key: ${e}`);let t=e.split("."),r=!1;for(let n=0;n<t.length;n++)switch(t[n]){case"*":r=!0;break;case">":if(n!==t.length-1)throw Error(`invalid key: ${e}`);r=!0}return r}function re(e){if(!t6.test(e))throw Error(`invalid bucket name: ${e}`)}(X=eh||(eh={})).MsgIdHdr="Nats-Msg-Id",X.ExpectedStreamHdr="Nats-Expected-Stream",X.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",X.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",X.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence";class rt{js;jsm;stream;bucket;direct;codec;prefix;editPrefix;useJsPrefix;_prefixLen;constructor(e,t,r){re(e),this.js=t,this.jsm=r,this.bucket=e,this.prefix="$KV",this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static async create(e,t,r={}){re(t);let n=await e.jetstreamManager(),s=new rt(t,e,n);return await s.init(r),s}static async bind(e,t,r={}){let n=await e.jetstreamManager(),s={config:{allow_direct:r.allow_direct}};re(t);let i=new rt(t,e,n);return s.config.name=r.streamName??i.bucketName(),Object.assign(i,s),i.stream=s.config.name,i.codec=r.codec||t2(),i.direct=s.config.allow_direct??!1,i.initializePrefixes(s),i}async init(e={}){let t,r=Object.assign({replicas:1,history:1,timeout:2e3,max_bytes:-1,maxValueSize:-1,codec:t2(),storage:M.File},e);this.codec=r.codec;let n={};this.stream=n.name=e.streamName??this.bucketName(),n.retention=N.Limits,n.max_msgs_per_subject=r.history,r.maxBucketSize&&(r.max_bytes=r.maxBucketSize),r.max_bytes&&(n.max_bytes=r.max_bytes),n.max_msg_size=r.maxValueSize,n.storage=r.storage;let s=e.placementCluster??"";if(s&&(e.placement={},e.placement.cluster=s,e.placement.tags=[]),e.placement&&(n.placement=e.placement),e.republish&&(n.republish=e.republish),e.description&&(n.description=e.description),e.mirror){let t=Object.assign({},e.mirror);t.name.startsWith("KV_")||(t.name=`KV_${t.name}`),n.mirror=t,n.mirror_direct=!0}else e.sources&&(n.sources=e.sources.map(e=>{let t=Object.assign({},e),r=t.name.startsWith("KV_")?t.name.substring(3):t.name;return t.name.startsWith("KV_")||(t.name=`KV_${t.name}`),e.external||r===this.bucket||(t.subject_transforms=[{src:`$KV.${r}.>`,dest:`$KV.${this.bucket}.>`}]),t})),n.subjects=[this.subjectForBucket()];e.metadata&&(n.metadata=e.metadata),"boolean"==typeof e.compression&&(n.compression=e.compression?q.S2:q.None);let i=this.js.nc,o=i.getServerVersion();n.discard=o&&tb(o,t_("2.7.2"))>=0?R.New:R.Old;let{ok:a,min:c}=i.features.get(es.JS_ALLOW_DIRECT);if(!a&&!0===e.allow_direct){let e=o?`${o.major}.${o.minor}.${o.micro}`:"unknown";return Promise.reject(Error(`allow_direct is not available on server version ${e} - requires ${c}`))}e.allow_direct="boolean"==typeof e.allow_direct?e.allow_direct:a,n.allow_direct=e.allow_direct,this.direct=n.allow_direct,n.num_replicas=r.replicas,r.ttl&&(n.max_age=eU(r.ttl)),n.allow_rollup_hdrs=!0;try{(t=await this.jsm.streams.info(n.name)).config.allow_direct||!0!==this.direct||(this.direct=!1)}catch(e){if("stream not found"===e.message)t=await this.jsm.streams.add(n);else throw e}this.initializePrefixes(t)}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix="$JS.API"!==this.js.apiPrefix;let{mirror:t}=e.config;if(t){let e=t.name;if(e.startsWith("KV_")&&(e=e.substring(3)),t.external&&""!==t.external.api){let r=t.name.substring(3);this.useJsPrefix=!1,this.prefix=`$KV.${r}`,this.editPrefix=`${t.external.api}.$KV.${e}`}else this.editPrefix=this.prefix}}bucketName(){return this.stream??`KV_${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){let r=[];return t?(this.useJsPrefix&&r.push(this.js.apiPrefix),""!==this.editPrefix?r.push(this.editPrefix):r.push(this.prefix)):this.prefix&&r.push(this.prefix),r.push(e),r.join(".")}fullKeyName(e){return""!==this.prefix?`${this.prefix}.${e}`:`$KV.${this.bucket}.${e}`}get prefixLen(){return 0===this._prefixLen&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){let t=[];for(let r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.encode(r))}return t.join(".")}decodeKey(e){let t=[];for(let r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.decode(r))}return t.join(".")}validateKey=t8;validateSearchKey=t7;hasWildcards=t9;close(){return Promise.resolve()}dataLen(e,t){let r=t&&t.get(B.MessageSizeHdr)||"";return""!==r?parseInt(r,10):e.length}smToEntry(e){return new rR(this.bucket,this.prefixLen,e)}jmToEntry(e){let t=this.decodeKey(e.subject.substring(this.prefixLen));return new rM(this.bucket,t,e)}async create(e,t){let r;try{let r=await this.put(e,t,{previousSeq:0});return Promise.resolve(r)}catch(e){if(r=e,e?.api_error?.err_code!==10071)return Promise.reject(e)}let n=0;try{let s=await this.get(e);if(s?.operation==="DEL"||s?.operation==="PURGE")return n=null!==s?s.revision:0,this.update(e,t,n);return Promise.reject(r)}catch(e){return Promise.reject(e)}}update(e,t,r){if(r<=0)throw Error("version must be greater than 0");return this.put(e,t,{previousSeq:r})}async put(e,t,r={}){let n=this.encodeKey(e);this.validateKey(n);let s={};if(void 0!==r.previousSeq){let e=eF();s.headers=e,e.set(eh.ExpectedLastSubjectSequenceHdr,`${r.previousSeq}`)}try{return(await this.js.publish(this.subjectForKey(n,!0),t,s)).seq}catch(e){if(e.isJetStreamError())return e.message=e.api_error?.description,e.code=`${e.api_error?.code}`,Promise.reject(e);return Promise.reject(e)}}async get(e,t){let r,n=this.encodeKey(e);this.validateKey(n);let s={last_by_subj:this.subjectForKey(n)};t&&t.revision>0&&(s={seq:t.revision});try{if(this.direct){let e=this.jsm.direct;r=await e.getMessage(this.bucketName(),s)}else r=await this.jsm.streams.getMessage(this.bucketName(),s);let e=this.smToEntry(r);if(e.key!==n)return null;return e}catch(e){if(e.code===O.JetStream404NoMessages)return null;throw e}}purge(e,t){return this._deleteOrPurge(e,"PURGE",t)}delete(e,t){return this._deleteOrPurge(e,"DEL",t)}async purgeDeletes(e=18e5){let t=eM(),r=[],n=await this.watch({key:">",initializedFn:()=>{t.resolve()}});(async()=>{for await(let e of n)("DEL"===e.operation||"PURGE"===e.operation)&&r.push(e)})().then(),await t,n.stop();let s=Date.now()-e,i=r.map(e=>{let t=this.subjectForKey(e.key);return e.created.getTime()>=s?this.jsm.streams.purge(this.stream,{filter:t,keep:1}):this.jsm.streams.purge(this.stream,{filter:t,keep:0})}),o=await Promise.all(i);return o.unshift({success:!0,purged:0}),o.reduce((e,t)=>(e.purged+=t.purged,e))}async _deleteOrPurge(e,t,r){if(!this.hasWildcards(e))return this._doDeleteOrPurge(e,t,r);let n=await this.keys(e),s=[];for await(let e of n)s.push(this._doDeleteOrPurge(e,t)),100===s.length&&(await Promise.all(s),s.length=0);s.length>0&&await Promise.all(s)}async _doDeleteOrPurge(e,t,r){let n=this.encodeKey(e);this.validateKey(n);let s=eF();s.set(t3,t),"PURGE"===t&&s.set(B.RollupHdr,B.RollupValueSubject),r?.previousSeq&&s.set(eh.ExpectedLastSubjectSequenceHdr,`${r.previousSeq}`),await this.js.publish(this.subjectForKey(n,!0),eg,{headers:s})}_buildCC(e,t,r={}){let n,s=(Array.isArray(e)?e:[e]).map(e=>{let t=this.encodeKey(e);return this.validateSearchKey(e),this.fullKeyName(t)}),i=T.LastPerSubject;return t===D.AllHistory&&(i=T.All),t===D.UpdatesOnly&&(i=T.New),1===s.length&&(n=s[0],s=void 0),Object.assign({deliver_policy:i,ack_policy:$.None,filter_subjects:s,filter_subject:n,flow_control:!0,idle_heartbeat:eU(5e3)},r)}remove(e){return this.purge(e)}async history(e={}){let t,r=e.key??">",n=new e1,s={};s.headers_only=e.headers_only||!1,t=()=>{n.stop()};let i=0,o=this._buildCC(r,D.AllHistory,s),a=o.filter_subject,c=e5(o);c.bindStream(this.stream),c.orderedConsumer(),c.callback((e,r)=>{if(e)return void n.stop(e);if(r){let e=this.jmToEntry(r);n.push(e),n.received++,(t&&i>0&&n.received>=i||0===r.info.pending)&&(n.push(t),t=void 0)}});let u=await this.js.subscribe(a,c);if(t){let{info:{last:e}}=u,r=e.num_pending+e.delivered.consumer_seq;if(0===r||n.received>=r)try{t()}catch(e){n.stop(e)}finally{t=void 0}else i=r}return n._data=u,n.iterClosed.then(()=>{u.unsubscribe()}),u.closed.then(()=>{n.stop()}).catch(e=>{n.stop(e)}),n}canSetWatcherName(){let{ok:e}=this.js.nc.features.get(es.JS_NEW_CONSUMER_CREATE_API);return e}async watch(e={}){let t=e.key??">",r=new e1,n={};n.headers_only=e.headers_only||!1;let s=D.LastValue;e.include===D.AllHistory?s=D.AllHistory:e.include===D.UpdatesOnly&&(s=D.UpdatesOnly);let i=!0===e.ignoreDeletes,o=e.initializedFn,a=0,c=this._buildCC(t,s,n),u=c.filter_subject,h=e5(c);this.canSetWatcherName()&&h.consumerName(ew.next()),h.bindStream(this.stream),e.resumeFromRevision&&e.resumeFromRevision>0&&h.startSequence(e.resumeFromRevision),h.orderedConsumer(),h.callback((e,t)=>{if(e)return void r.stop(e);if(t){let e=this.jmToEntry(t);if(i&&"DEL"===e.operation)return;r.push(e),r.received++,o&&(a>0&&r.received>=a||0===t.info.pending)&&(r.push(o),o=void 0)}});let l=await this.js.subscribe(u,h);if(o){let{info:{last:e}}=l,t=e.num_pending+e.delivered.consumer_seq;if(0===t||r.received>=t)try{o()}catch(e){r.stop(e)}finally{o=void 0}else a=t}return r._data=l,r.iterClosed.then(()=>{l.unsubscribe()}),l.closed.then(()=>{r.stop()}).catch(e=>{r.stop(e)}),r}async keys(e=">"){let t=new e1,r=this._buildCC(e,D.LastValue,{headers_only:!0}),n=Array.isArray(e)?">":r.filter_subject,s=e5(r);s.bindStream(this.stream),s.orderedConsumer();let i=await this.js.subscribe(n,s);return(async()=>{for await(let e of i){let r=e.headers?.get(t3);if("DEL"!==r&&"PURGE"!==r){let r=this.decodeKey(e.subject.substring(this.prefixLen));t.push(r)}0===e.info.pending&&i.unsubscribe()}})().then(()=>{t.stop()}).catch(e=>{t.stop(e)}),0===i.info.last.num_pending&&i.unsubscribe(),t}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}async status(){let e=this.js.nc,t=e.info?.cluster??"",r=this.bucketName();return new rr(await this.jsm.streams.info(r),t)}}class rr{si;cluster;constructor(e,t=""){this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith("KV_")?this.si.config.name.substring(3):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return eq(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){return this.si.config.description??""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){return this.si.config.placement?.cluster??""}get republish(){return this.si.config.republish??{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){return this.si.config.metadata??{}}get compression(){return!!this.si.config.compression&&this.si.config.compression!==q.None}}let rn="OBJ_",rs="SHA-256=";class ri{si;backingStore;constructor(e){this.si=e,this.backingStore="JetStream"}get bucket(){var e;return(e=this.si.config.name).startsWith(rn)?e.substring(4):e}get description(){return this.si.config.description??""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}get compression(){return!!this.si.config.compression&&this.si.config.compression!==q.None}}function ro(e){if(void 0===e)return;let{domain:t}=e;if(void 0===t)return e;let r=Object.assign({},e);if(delete r.domain,""===t)return r;if(r.external)throw Error("domain and external are both set");return r.external={api:`$JS.${t}.API`},r}(Q=el||(el={}))[Q.Unset=-1]="Unset",Q[Q.Consume=0]="Consume",Q[Q.Fetch=1]="Fetch",(ee=ef||(ef={})).HeartbeatsMissed="heartbeats_missed",ee.ConsumerNotFound="consumer_not_found",ee.StreamNotFound="stream_not_found",ee.ConsumerDeleted="consumer_deleted",ee.OrderedConsumerRecreated="ordered_consumer_recreated",ee.NoResponders="no_responders",(et=ed||(ed={})).DebugEvent="debug",et.Discard="discard",et.Reset="reset",et.Next="next";let ra=Uint8Array.of(43,65,67,75),rc=Uint8Array.of(45,78,65,75),ru=Uint8Array.of(43,87,80,73),rh=Uint8Array.of(43,78,88,84),rl=Uint8Array.of(43,84,69,82,77),rf=Uint8Array.of(32);function rd(e,t=5e3){return new rL(e,t)}class rp extends e1{consumer;opts;sub;monitor;pending;inbox;refilling;pong;callback;timeout;cleanupHandler;listeners;statusIterator;forOrderedConsumer;resetHandler;abortOnMissingResource;bind;inBackOff;constructor(e,t,r=!1){super(),this.consumer=e,this.opts=this.parseOptions(t,r),this.callback=t.callback||null,this.noIterator="function"==typeof this.callback,this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=r,this.timeout=null,this.inbox=ek(e.api.nc.options.inboxPrefix),this.listeners=[],this.forOrderedConsumer=!1,this.abortOnMissingResource=!0===t.abort_on_missing_resource,this.bind=!0===t.bind,this.inBackOff=!1,this.start()}start(){let{max_messages:e,max_bytes:t,idle_heartbeat:r,threshold_bytes:n,threshold_messages:s}=this.opts;this.closed().then(e=>{if(this.cleanupHandler)try{this.cleanupHandler(e)}catch(e){}});let{sub:i}=this;i&&i.unsubscribe(),this.sub=this.consumer.api.nc.subscribe(this.inbox,{callback:(r,i)=>{if(r)return void this.stop(r);if(this.monitor?.work(),i.subject===this.inbox){if(eX(i))return;let e=i.headers?.code,t=i.headers?.description?.toLowerCase()||"unknown",{msgsLeft:r,bytesLeft:n}=this.parseDiscard(i.headers);if(r>0||n>0)this.pending.msgs-=r,this.pending.bytes-=n,this.pending.requests--,this.notify(ed.Discard,{msgsLeft:r,bytesLeft:n});else if(400===e)return void this.stop(new eE(t,`${e}`));else if(409===e&&"consumer deleted"===t){if(this.notify(ef.ConsumerDeleted,`${e} ${t}`),!this.refilling||this.abortOnMissingResource){let r=new eE(t,`${e}`);this.stop(r);return}}else if(503===e){if(this.notify(ef.NoResponders,`${e} No Responders`),!this.refilling||this.abortOnMissingResource){let t=new eE("no responders",`${e}`);this.stop(t);return}}else this.notify(ed.DebugEvent,`${e} ${t}`)}else this._push(rd(i,this.consumer.api.timeout)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=i.size());if(0===this.pending.msgs&&0===this.pending.bytes&&(this.pending.requests=0),this.refilling){if(e&&this.pending.msgs<=s||t&&this.pending.bytes<=n){let e=this.pullOptions();this.pull(e)}}else 0===this.pending.requests&&this._push(()=>{this.stop()})}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),r&&(this.monitor=new e2(r,e=>(this.notify(ef.HeartbeatsMissed,e),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),(async()=>{let e=this.consumer.api.nc.status();for await(let t of(this.statusIterator=e,e))switch(t.type){case E.Disconnect:this.monitor?.cancel();break;case E.Reconnect:this.resetPending().then(e=>{e&&this.monitor?.restart()}).catch(()=>{})}})(),this.pull(this.pullOptions())}_push(e){if(this.callback){let t="function"==typeof e?e:null;try{t?t():this.callback(e)}catch(e){this.stop(e)}}else super.push(e)}notify(e,t){this.listeners.length>0&&this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})}resetPending(){return this.bind?this.resetPendingNoInfo():this.resetPendingWithInfo()}resetPendingNoInfo(){return this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),Promise.resolve(!0)}async resetPendingWithInfo(){if(this.inBackOff)return!1;let e=0,t=0,r=e$([this.opts.expires]),n=0;for(;;){if(this.done)return!1;if(this.consumer.api.nc.isClosed())return console.error("aborting resetPending - connection is closed"),!1;try{return await this.consumer.info(),this.inBackOff=!1,e=0,this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0}catch(i){if("stream not found"===i.message){if(t++,this.notify(ef.StreamNotFound,t),!this.refilling||this.abortOnMissingResource)return this.stop(i),!1}else if("consumer not found"===i.message){if(e++,this.notify(ef.ConsumerNotFound,e),this.resetHandler)try{this.resetHandler()}catch(e){}if(!this.refilling||this.abortOnMissingResource)return this.stop(i),!1;if(this.forOrderedConsumer)return!1}else e=0,t=0;this.inBackOff=!0;let s=eR(r.backoff(n));await Promise.race([s,this.consumer.api.nc.closed()]),s.cancel(),n++}}}pull(e){this.pending.bytes+=e.max_bytes??0,this.pending.msgs+=e.batch??0,this.pending.requests++;let t=this.consumer.api.nc;this._push(()=>{t.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(e),{reply:this.inbox}),this.notify(ed.Next,e)})}pullOptions(){let e=this.opts.max_messages-this.pending.msgs,t=this.opts.max_bytes-this.pending.bytes;return{batch:e,max_bytes:t,idle_heartbeat:eU(this.opts.idle_heartbeat),expires:eU(this.opts.expires)}}parseDiscard(e){let t={msgsLeft:0,bytesLeft:0},r=e?.get(B.PendingMessagesHdr);r&&(t.msgsLeft=parseInt(r));let n=e?.get(B.PendingBytesHdr);return n&&(t.bytesLeft=parseInt(n)),t}trackTimeout(e){this.timeout=e}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){this.monitor?.cancel(),this.monitor=null,this.timeout?.cancel(),this.timeout=null}setCleanupHandler(e){this.cleanupHandler=e}stop(e){this.done||(this.sub?.unsubscribe(),this.clearTimers(),this.statusIterator?.stop(),this._push(()=>{super.stop(e),this.listeners.forEach(e=>{e.stop()})}))}parseOptions(e,t=!1){let r=e||{};if(r.max_messages=r.max_messages||0,r.max_bytes=r.max_bytes||0,0!==r.max_messages&&0!==r.max_bytes)throw Error("only specify one of max_messages or max_bytes");if(0===r.max_messages&&(r.max_messages=100),r.expires=r.expires||3e4,r.expires<1e3)throw Error("expires should be at least 1000ms");if(r.idle_heartbeat=r.idle_heartbeat||r.expires/2,r.idle_heartbeat=r.idle_heartbeat>3e4?3e4:r.idle_heartbeat,t){let e=Math.round(.75*r.max_messages)||1;r.threshold_messages=r.threshold_messages||e;let t=Math.round(.75*r.max_bytes)||1;r.threshold_bytes=r.threshold_bytes||t}return r}status(){let e=new e1;return this.listeners.push(e),Promise.resolve(e)}}class rg extends e1{src;listeners;constructor(){super(),this.listeners=[]}setSource(e){this.src&&(this.src.resetHandler=void 0,this.src.setCleanupHandler(),this.src.stop()),this.src=e,this.src.setCleanupHandler(e=>{this.stop(e||void 0)}),(async()=>{for await(let e of(await this.src.status()))this.notify(e.type,e.data)})().catch(()=>{})}notify(e,t){this.listeners.length>0&&this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})}stop(e){this.done||(this.src?.stop(e),super.stop(e),this.listeners.forEach(e=>{e.stop()}))}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}status(){let e=new e1;return this.listeners.push(e),Promise.resolve(e)}}class rm{api;_info;stream;name;constructor(e,t){this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new rp(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){let t=new rp(this,e,!1),r=eN(Math.round(1.05*t.opts.expires));return t.closed().catch(()=>{}).finally(()=>{r.cancel()}),r.catch(()=>{t.close().catch()}),t.trackTimeout(r),Promise.resolve(t)}next(e={expires:3e4}){let t=eM();e.max_messages=1;let r=new rp(this,e,!1),n=Math.round(1.05*r.opts.expires);n>=6e4&&(async()=>{for await(let e of(await r.status()))if(e.type===ef.HeartbeatsMissed&&e.data>=2){t.reject(Error("consumer missed heartbeats"));break}})().catch(),(async()=>{for await(let e of r){t.resolve(e);break}})().catch(()=>{});let s=eN(n);return r.closed().then(e=>{e?t.reject(e):t.resolve(null)}).catch(e=>{t.reject(e)}).finally(()=>{s.cancel()}),s.catch(e=>{t.resolve(null),r.close().catch()}),r.trackTimeout(s),t}delete(){let{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);let{stream_name:t,name:r}=this._info;return this.api.info(t,r).then(e=>(this._info=e,this._info))}}class r_{api;consumerOpts;consumer;opts;cursor;stream;namePrefix;serial;currentConsumer;userCallback;iter;type;startSeq;maxInitialReset;constructor(e,t,r={}){this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=ew.next(),"string"==typeof r.name_prefix&&(eV("name_prefix",r.name_prefix),this.namePrefix=r.name_prefix+this.namePrefix),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=el.Unset,this.consumerOpts=r,this.maxInitialReset=30,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;let t=`${this.namePrefix}_${this.serial}`;e=0===e?1:e;let r={name:t,deliver_policy:T.StartSequence,opt_start_seq:e,ack_policy:$.None,inactive_threshold:eU(3e5),num_replicas:1};return!0===this.consumerOpts.headers_only&&(r.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(r.filter_subjects=this.consumerOpts.filterSubjects),"string"==typeof this.consumerOpts.filterSubjects&&(r.filter_subject=this.consumerOpts.filterSubjects),this.consumerOpts.replay_policy&&(r.replay_policy=this.consumerOpts.replay_policy),e===this.startSeq+1&&(r.deliver_policy=this.consumerOpts.deliver_policy||T.StartSequence,(this.consumerOpts.deliver_policy===T.LastPerSubject||this.consumerOpts.deliver_policy===T.New||this.consumerOpts.deliver_policy===T.Last)&&(delete r.opt_start_seq,r.deliver_policy=this.consumerOpts.deliver_policy),r.deliver_policy===T.LastPerSubject&&void 0===r.filter_subjects&&void 0===r.filter_subject&&(r.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete r.opt_start_seq,r.deliver_policy=T.StartTime,r.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(r.inactive_threshold=eU(this.consumerOpts.inactive_threshold))),r}async resetConsumer(e=0){let t;ew.next();let r=0===this.serial;this.consumer?.delete().catch(()=>{}),e=0===e?1:e,this.cursor.deliver_seq=0;let n=this.getConsumerOpts(e);n.max_deliver=1,n.mem_storage=!0;let s=e$([this.opts?.expires||3e4]);for(let e=0;;e++)try{t=await this.api.add(this.stream,n),this.iter?.notify(ef.OrderedConsumerRecreated,t.name);break}catch(t){if("stream not found"===t.message&&(this.iter?.notify(ef.StreamNotFound,e),this.type===el.Fetch||!0===this.opts.abort_on_missing_resource))return this.iter?.stop(t),Promise.reject(t);if(r&&e>=this.maxInitialReset)throw t;await eR(s.backoff(e+1))}return t}internalHandler(e){return t=>{if(this.serial!==e)return;let r=t.info.deliverySequence;r!==this.cursor.deliver_seq+1?this.notifyOrderedResetAndReset():(this.cursor.deliver_seq=r,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):this.iter?.push(t))}}async reset(e={max_messages:100,expires:3e4},t){let r=(t=t||{}).fromFetch||!1,n=t.orderedReset||!1;if(this.type===el.Fetch&&n){this.iter?.src.stop(),await this.iter?.closed(),this.currentConsumer=null;return}(null===this.currentConsumer||n)&&(this.currentConsumer=await this.resetConsumer(this.cursor.stream_seq+1)),(null===this.iter||r)&&(this.iter=new rg),this.consumer=new rm(this.api,this.currentConsumer),e.callback=this.internalHandler(this.serial);let s=null;this.type===el.Fetch&&r?s=await this.consumer.fetch(e):this.type===el.Consume&&(s=await this.consumer.consume(e));let i=s;i.forOrderedConsumer=!0,i.resetHandler=()=>{this.notifyOrderedResetAndReset()},this.iter.setSource(i)}notifyOrderedResetAndReset(){this.iter?.notify(ed.Reset,""),this.reset(this.opts,{orderedReset:!0})}async consume(e={max_messages:100,expires:3e4}){if(e.bind)return Promise.reject(Error("bind is not supported"));if(this.type===el.Fetch)return Promise.reject(Error("ordered consumer initialized as fetch"));if(this.type===el.Consume)return Promise.reject(Error("ordered consumer doesn't support concurrent consume"));let{callback:t}=e;return t&&(this.userCallback=t),this.type=el.Consume,this.opts=e,await this.reset(e),this.iter}async fetch(e={max_messages:100,expires:3e4}){if(e.bind)return Promise.reject(Error("bind is not supported"));if(this.type===el.Consume)return Promise.reject(Error("ordered consumer already initialized as consume"));if(this.iter?.done===!1)return Promise.reject(Error("ordered consumer doesn't support concurrent fetch"));let{callback:t}=e;return t&&(this.userCallback=t),this.type=el.Fetch,this.opts=e,await this.reset(e,{fromFetch:!0}),this.iter}async next(e={expires:3e4}){if(e.bind)return Promise.reject(Error("bind is not supported"));e.max_messages=1;let t=eM();return e.callback=e=>{this.userCallback=null,t.resolve(e)},(await this.fetch(e)).iterClosed.then(e=>{e&&t.reject(e),t.resolve(null)}).catch(e=>{t.reject(e)}),t}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}async info(e){return null==this.currentConsumer?(this.currentConsumer=await this.resetConsumer(this.startSeq),Promise.resolve(this.currentConsumer)):e&&this.currentConsumer?Promise.resolve(this.currentConsumer):this.api.info(this.stream,this.currentConsumer.name)}}class rb{api;notified;constructor(e){this.api=e,this.notified=!1}checkVersion(){let e=this.api.nc.features.get(es.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(Error(`consumers framework is only supported on servers ${e.min} or better`))}getPullConsumerFor(e){if(void 0!==e.config.deliver_subject)throw Error("push consumer not supported");return new rm(this.api,e)}async get(e,t={}){return"object"==typeof t?this.ordered(e,t):(await this.checkVersion(),this.api.info(e,t).then(e=>void 0!==e.config.deliver_subject?Promise.reject(Error("push consumer not supported")):new rm(this.api,e)).catch(e=>Promise.reject(e)))}async ordered(e,t){await this.checkVersion();let r=this.api;return new rv(r.nc,r.opts).info(e).then(r=>Promise.resolve(new r_(this.api,e,t))).catch(e=>Promise.reject(e))}}class ry{api;_info;constructor(e,t){this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}async best(){if(await this.info(),!this._info.alternates)return this;{let e=await this.api.info(this._info.alternates[0].name);return new ry(this.api,e)}}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(e=>(this._info=e,this._info))}getConsumerFromInfo(e){return new rb(new tv(this.api.nc,this.api.opts)).getPullConsumerFor(e)}getConsumer(e){return new rb(new tv(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}class rv extends tg{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){let t=this.nc;if(e.metadata){let{min:e,ok:r}=t.features.get(es.JS_STREAM_CONSUMER_METADATA);if(!r)throw Error(`stream 'metadata' requires server ${e}`)}if(e.first_seq){let{min:e,ok:r}=t.features.get(es.JS_STREAM_FIRST_SEQ);if(!r)throw Error(`stream 'first_seq' requires server ${e}`)}if(e.subject_transform){let{min:e,ok:r}=t.features.get(es.JS_STREAM_SUBJECT_TRANSFORM);if(!r)throw Error(`stream 'subject_transform' requires server ${e}`)}if(e.compression){let{min:e,ok:r}=t.features.get(es.JS_STREAM_COMPRESSION);if(!r)throw Error(`stream 'compression' requires server ${e}`)}if(e.consumer_limits){let{min:e,ok:r}=t.features.get(es.JS_DEFAULT_CONSUMER_LIMITS);if(!r)throw Error(`stream 'consumer_limits' requires server ${e}`)}function r(e,r){if((r?.subject_transforms?.length||0)>0){let{min:r,ok:n}=t.features.get(es.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!n)throw Error(`${e} 'subject_transforms' requires server ${r}`)}}e.sources&&e.sources.forEach(e=>{r("stream sources",e)}),e.mirror&&r("stream mirror",e.mirror)}async add(e={}){this.checkStreamConfigVersions(e),eW(e.name),e.mirror=ro(e.mirror),e.sources=e.sources?.map(ro);let t=await this._request(`${this.prefix}.STREAM.CREATE.${e.name}`,e);return this._fixInfo(t),t}async delete(e){return eW(e),(await this._request(`${this.prefix}.STREAM.DELETE.${e}`)).success}async update(e,t={}){if("object"==typeof e){let r=e;e=r.name,t=r,console.trace(`\u001B[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \u001B[0m`)}this.checkStreamConfigVersions(t),eW(e);let r=Object.assign((await this.info(e)).config,t);r.mirror=ro(r.mirror),r.sources=r.sources?.map(ro);let n=await this._request(`${this.prefix}.STREAM.UPDATE.${e}`,r);return this._fixInfo(n),n}async info(e,t){eW(e);let r=`${this.prefix}.STREAM.INFO.${e}`,n=await this._request(r,t),{total:s,limit:i}=n,o=n.state.subjects?Object.getOwnPropertyNames(n.state.subjects).length:1;if(s&&s>o){let e=[n],a=t||{},c=0;for(;s>o;){a.offset=i*++c;let t=await this._request(r,a);s=t.total,e.push(t);let n=Object.getOwnPropertyNames(t.state.subjects).length;if(o+=n,n<i)break}let u={};for(let t=0;t<e.length;t++)(n=e[t]).state.subjects&&(u=Object.assign(u,n.state.subjects));n.offset=0,n.total=0,n.limit=0,n.state.subjects=u}return this._fixInfo(n),n}list(e=""){let t=e?.length?{subject:e}:{},r=e=>(e.streams.forEach(e=>{this._fixInfo(e)}),e.streams);return new tm(`${this.prefix}.STREAM.LIST`,r,this,t)}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}async purge(e,t){if(t){let{keep:e,seq:r}=t;if("number"==typeof e&&"number"==typeof r)throw Error("can specify one of keep or seq")}return eW(e),await this._request(`${this.prefix}.STREAM.PURGE.${e}`,t)}async deleteMessage(e,t,r=!0){eW(e);let n={seq:t};return r||(n.no_erase=!0),(await this._request(`${this.prefix}.STREAM.MSG.DELETE.${e}`,n)).success}async getMessage(e,t){return eW(e),new rE(await this._request(`${this.prefix}.STREAM.MSG.GET.${e}`,t))}find(e){return this.findStream(e)}listKvs(){let e=e=>{let t=e.streams.filter(e=>e.config.name.startsWith("KV_"));t.forEach(e=>{this._fixInfo(e)});let r="";return t.length&&(r=this.nc.info?.cluster??""),t.map(e=>new rr(e,r))};return new tm(`${this.prefix}.STREAM.LIST`,e,this)}listObjectStores(){let e=e=>{let t=e.streams.filter(e=>e.config.name.startsWith(rn));return t.forEach(e=>{this._fixInfo(e)}),t.map(e=>new ri(e))};return new tm(`${this.prefix}.STREAM.LIST`,e,this)}names(e=""){let t=e?.length?{subject:e}:{};return new tm(`${this.prefix}.STREAM.NAMES`,e=>e.streams,this,t)}async get(e){return Promise.resolve(new ry(this,await this.info(e)))}}class rw extends tg{constructor(e,t){super(e,t)}async getMessage(e,t){eW(e);let r=t,{last_by_subj:n}=r;n&&(r=null);let s=r?this.jc.encode(r):eg,i=this.opts.apiPrefix||"$JS.API",o=n?`${i}.DIRECT.GET.${e}.${n}`:`${i}.DIRECT.GET.${e}`,a=await this.nc.request(o,s,{timeout:this.timeout}),c=eQ(a);return c?Promise.reject(c):Promise.resolve(new rx(a))}async getBatch(e,t){eW(e);let r=this.opts.apiPrefix||"$JS.API",n=`${r}.DIRECT.GET.${e}`;if(!Array.isArray(t.multi_last)||0===t.multi_last.length)return Promise.reject("multi_last is required");let s=JSON.stringify(t,(e,t)=>"up_to_time"===e&&t instanceof Date?t.toISOString():t),i=new e1,o=await this.nc.requestMany(n,s,{strategy:k.SentinelMsg});return(async()=>{let e,t=!1,r=!1;for await(let n of o){if(!t){t=!0;let s=n.headers?.code||0;if(0!==s&&s<200||s>299){e=n.headers?.description.toLowerCase();break}if(""===n.headers?.get("Nats-Num-Pending")){r=!0;break}}if(0===n.data.length)break;i.push(new rx(n))}i.push(()=>{if(r)throw Error("batch direct get not supported by the server");if(e)throw Error(`bad request: ${e}`);i.stop()})})(),Promise.resolve(i)}}class rx{data;header;static jc;constructor(e){if(!e.headers)throw Error("headers expected");this.data=e.data,this.header=e.headers}get subject(){return this.header.last(z.Subject)}get seq(){let e=this.header.last(z.Sequence);return"string"==typeof e?parseInt(e):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.last(z.TimeStamp)}get stream(){return this.header.last(z.Stream)}json(e){return eH(e).decode(this.data)}string(){return e_.decode(this.data)}}class rS extends tg{streams;consumers;direct;constructor(e,t){super(e,t),this.streams=new rv(e,t),this.consumers=new tv(e,t),this.direct=new rw(e,t)}async getAccountInfo(){return await this._request(`${this.prefix}.INFO`)}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){let e=new e1;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(t,r)=>{if(t)throw t;try{let t=this.parseJsResponse(r),n=t.type.split("."),s=n[n.length-1];e.push({kind:s,data:t})}catch(t){e.stop(t)}}}),e}}class rE{_header;smr;static jc;constructor(e){this.smr=e}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):eg}get header(){if(!this._header)if(this.smr.message.hdrs){let e=this._parse(this.smr.message.hdrs);this._header=eD.decode(e)}else this._header=eF();return this._header}_parse(e){let t=atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return n}json(e){return eH(e).decode(this.data)}string(){return e_.decode(this.data)}}class rA{api;constructor(e){this.api=e}get(e){return this.api.info(e).then(e=>new ry(this.api,e))}}class rO{info;hdrs;constructor(e){this.info=e}get name(){return this.info.name}get description(){return this.info.description??""}get headers(){return this.hdrs||(this.hdrs=eD.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){return this.info.deleted??!1}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){return this.info.options?.link!==void 0&&this.info.options?.link!==null}}function rP(e){let t={name:e.name,description:e.description??"",options:e.options,metadata:e.metadata};return e.headers&&(t.headers=e.headers.toRecord()),t}class rk{jsm;js;stream;name;constructor(e,t,r){this.name=e,this.jsm=t,this.js=r}_checkNotEmpty(e){return e&&0!==e.length?{name:e}:{name:e,error:Error("name cannot be empty")}}async info(e){let t=await this.rawInfo(e);return t?new rO(t):null}async list(){let e=[];for await(let t of(await this.watch({ignoreDeletes:!0,includeHistory:!0}))){if(null===t)break;e.push(t)}return Promise.resolve(e)}async rawInfo(e){let{name:t,error:r}=this._checkNotEmpty(e);if(r)return Promise.reject(r);let n=this._metaSubject(t);try{let e=await this.jsm.streams.getMessage(this.stream,{last_by_subj:n}),t=eH().decode(e.data);return t.revision=e.seq,t}catch(e){if("404"===e.code)return null;return Promise.reject(e)}}async _si(e){try{return await this.jsm.streams.info(this.stream,e)}catch(e){if("404"===e.code)return null;return Promise.reject(e)}}async seal(){let e=await this._si();return null===e?Promise.reject(Error("object store not found")):(e.config.sealed=!0,Promise.resolve(new ri(e=await this.jsm.streams.update(this.stream,e.config))))}async status(e){let t=await this._si(e);return null===t?Promise.reject(Error("object store not found")):Promise.resolve(new ri(t))}destroy(){return this.jsm.streams.delete(this.stream)}async _put(e,t,r){let n=this.js.getOptions();(r=r||{timeout:n.timeout}).timeout=r.timeout||n.timeout,r.previousRevision=r.previousRevision??void 0;let{timeout:s,previousRevision:i}=r,o=this.js.nc.info,a=o?.max_payload||1024;(e=e||{}).options=e.options||{};let c=e.options?.max_chunk_size||131072;c=c>a?a:c,e.options.max_chunk_size=c;let u=await this.info(e.name),{name:h,error:l}=this._checkNotEmpty(e.name);if(l)return Promise.reject(l);let f=ew.next(),d=this._chunkSubject(f),p=this._metaSubject(h),g=Object.assign({bucket:this.name,nuid:f,size:0,chunks:0},rP(e)),m=eM(),_=[],b=new e7;try{let r=t?t.getReader():null,n=th.create();for(;;){let{done:t,value:o}=r?await r.read():{done:!0,value:void 0};if(t){if(b.size()>0){let e=b.drain();n.update(e),g.chunks++,g.size+=e.length,_.push(this.js.publish(d,e,{timeout:s}))}await Promise.all(_),_.length=0,g.mtime=new Date().toISOString();let e=e8.encode(n.digest());g.digest=`${rs}${e}`,g.deleted=!1;let t=eF();"number"==typeof i&&t.set(eh.ExpectedLastSubjectSequenceHdr,`${i}`),t.set(B.RollupHdr,B.RollupValueSubject);let r=await this.js.publish(p,eH().encode(g),{headers:t,timeout:s});if(g.revision=r.seq,u)try{await this.jsm.streams.purge(this.stream,{filter:`$O.${this.name}.C.${u.nuid}`})}catch(e){}m.resolve(new rO(g));break}if(o)for(b.fill(o);b.size()>c;){g.chunks++,g.size+=c;let t=b.drain(e.options.max_chunk_size);n.update(t),_.push(this.js.publish(d,t,{timeout:s}))}}}catch(e){await this.jsm.streams.purge(this.stream,{filter:d}),m.reject(e)}return m}putBlob(e,t,r){var n;return null===t&&(t=new Uint8Array(0)),this.put(e,(n=t,new ReadableStream({pull(e){e.enqueue(n),e.close()}})),r)}put(e,t,r){return e?.options?.link?Promise.reject(Error("link cannot be set when putting the object in bucket")):this._put(e,t,r)}async getBlob(e){async function t(e){let t=new e7,r=e.getReader();for(;;){let{done:e,value:n}=await r.read();if(e)return t.drain();n&&n.length&&t.fill(n)}}let r=await this.get(e);if(null===r)return Promise.resolve(null);let n=await Promise.all([r.error,t(r.data)]);return n[0]?Promise.reject(n[0]):Promise.resolve(n[1])}async get(e){let t,r=await this.rawInfo(e);if(null===r||r.deleted)return Promise.resolve(null);if(r.options&&r.options.link){let e=r.options.link.name||"";if(""===e)throw Error("link is a bucket");return(r.options.link.bucket!==this.name?await rk.create(this.js,r.options.link.bucket):this).get(e)}if(!r.digest.startsWith(rs))return Promise.reject(Error(`unknown digest type: ${r.digest}`));let n=tl(r.digest.substring(8));if(null===n)return Promise.reject(Error(`unable to parse digest: ${r.digest}`));let s=eM(),i={info:new rO(r),error:s};if(0===r.size)return i.data=new ReadableStream({pull(e){e.enqueue(new Uint8Array(0)),e.close()}}),s.resolve(null),Promise.resolve(i);let o=e5();o.orderedConsumer();let a=th.create(),c=`$O.${this.name}.C.${r.nuid}`,u=await this.js.subscribe(c,o);return(async()=>{for await(let e of u)e.data.length>0&&(a.update(e.data),t.enqueue(e.data)),0===e.info.pending&&(!function(e,t){let r="string"==typeof e?tl(e):e,n="string"==typeof t?tl(t):t;if(null===r||null===n||r.length!==n.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1;return!0}(n,a.digest())?t.error(Error(`received a corrupt object, digests do not match received: ${r.digest} calculated ${n}`)):t.close(),u.unsubscribe())})().then(()=>{s.resolve()}).catch(e=>{t.error(e),s.reject(e)}),i.data=new ReadableStream({start(e){t=e},cancel(){u.unsubscribe()}}),i}linkStore(e,t){if(!(t instanceof rk))return Promise.reject("bucket required");let{name:r,error:n}=this._checkNotEmpty(e);if(n)return Promise.reject(n);let s={name:r,options:{link:{bucket:t.name}}};return this._put(s,null)}async link(e,t){let{name:r,error:n}=this._checkNotEmpty(e);if(n)return Promise.reject(n);if(t.deleted)return Promise.reject(Error("src object is deleted"));if(t.isLink())return Promise.reject(Error("src object is a link"));let s=await this.rawInfo(e);if(null!==s&&!s.deleted)return Promise.reject(Error("an object already exists with that name"));let i={bucket:t.bucket,name:t.name},o={name:r,bucket:t.bucket,options:{link:i}};return await this.js.publish(this._metaSubject(e),JSON.stringify(o)),Promise.resolve(await this.info(e))}async delete(e){let t=await this.rawInfo(e);if(null===t)return Promise.resolve({purged:0,success:!1});t.deleted=!0,t.size=0,t.chunks=0,t.digest="";let r=eH(),n=eF();return n.set(B.RollupHdr,B.RollupValueSubject),await this.js.publish(this._metaSubject(t.name),r.encode(t),{headers:n}),this.jsm.streams.purge(this.stream,{filter:this._chunkSubject(t.nuid)})}async update(e,t={}){let r=await this.rawInfo(e);if(null===r)return Promise.reject(Error("object not found"));if(r.deleted)return Promise.reject(Error("cannot update meta for a deleted object"));t.name=t.name??r.name;let{name:n,error:s}=this._checkNotEmpty(t.name);if(s)return Promise.reject(s);if(e!==t.name){let e=await this.info(t.name);if(e&&!e.deleted)return Promise.reject(Error("an object already exists with that name"))}t.name=n;let i=Object.assign({},r,rP(t)),o=await this.js.publish(this._metaSubject(i.name),JSON.stringify(i));return e!==t.name&&await this.jsm.streams.purge(this.stream,{filter:this._metaSubject(e)}),Promise.resolve(o)}async watch(e={}){e.includeHistory=e.includeHistory??!1,e.ignoreDeletes=e.ignoreDeletes??!1;let t=!1,r=new e1,n=this._metaSubjectAll();try{await this.jsm.streams.getMessage(this.stream,{last_by_subj:n})}catch(e){"404"===e.code?(r.push(null),t=!0):r.stop(e)}let s=eH(),i=e5();i.orderedConsumer(),e.includeHistory?i.deliverLastPerSubject():(t=!0,i.deliverNew()),i.callback((n,i)=>{if(n)return void r.stop(n);if(null!==i){let n=s.decode(i.data);n.deleted&&!0===e.ignoreDeletes||r.push(n),i.info?.pending!==0||t||(t=!0,r.push(null))}});let o=await this.js.subscribe(n,i);return r._data=o,r.iterClosed.then(()=>{o.unsubscribe()}),o.closed.then(()=>{r.stop()}).catch(e=>{r.stop(e)}),r}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${e8.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}async init(e={}){try{var t;this.stream=(t=this.name,re(t),`${rn}${t}`)}catch(e){return Promise.reject(e)}let r=e?.ttl||0;delete e.ttl;let n=Object.assign({max_age:r},e);n.name=this.stream,n.num_replicas=e.replicas??1,n.allow_direct=!0,n.allow_rollup_hdrs=!0,n.discard=R.New,n.subjects=[`$O.${this.name}.C.>`,`$O.${this.name}.M.>`],e.placement&&(n.placement=e.placement),e.metadata&&(n.metadata=e.metadata),"boolean"==typeof e.compression&&(n.compression=e.compression?q.S2:q.None);try{await this.jsm.streams.info(n.name)}catch(e){"stream not found"===e.message&&await this.jsm.streams.add(n)}}static async create(e,t,r={}){let n=new rk(t,await e.jetstreamManager(),e);return await n.init(r),Promise.resolve(n)}}class rj{js;constructor(e){this.js=e}kv(e,t={}){let{ok:r,min:n}=this.js.nc.features.get(es.JS_KV);return r?t.bindOnly?rt.bind(this.js,e,t):rt.create(this.js,e,t):Promise.reject(Error(`kv is only supported on servers ${n} or better`))}os(e,t={}){if("function"!=typeof crypto?.subtle?.digest)return Promise.reject(Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));let{ok:r,min:n}=this.js.nc.features.get(es.JS_OBJECTSTORE);return r?rk.create(this.js,e,t):Promise.reject(Error(`objectstore is only supported on servers ${n} or better`))}}class rC extends tg{consumers;streams;consumerAPI;streamAPI;constructor(e,t){super(e,t),this.consumerAPI=new tv(e,t),this.streamAPI=new rv(e,t),this.consumers=new rb(this.consumerAPI),this.streams=new rA(this.streamAPI)}jetstreamManager(e){void 0===e&&(e=this.opts.checkAPI);let t=Object.assign({},this.opts,{checkAPI:e});return this.nc.jetstreamManager(t)}get apiPrefix(){return this.prefix}get views(){return new rj(this)}async publish(e,t=eg,r){let n;(r=r||{}).expect=r.expect||{};let s=r?.headers||eF();r&&(r.msgID&&s.set(eh.MsgIdHdr,r.msgID),r.expect.lastMsgID&&s.set(eh.ExpectedLastMsgIdHdr,r.expect.lastMsgID),r.expect.streamName&&s.set(eh.ExpectedStreamHdr,r.expect.streamName),"number"==typeof r.expect.lastSequence&&s.set(eh.ExpectedLastSeqHdr,`${r.expect.lastSequence}`),"number"==typeof r.expect.lastSubjectSequence&&s.set(eh.ExpectedLastSubjectSequenceHdr,`${r.expect.lastSubjectSequence}`));let i=r.timeout||this.timeout,o={};i&&(o.timeout=i),r&&(o.headers=s);let{retries:a,retry_delay:c}=r;a=a||1,c=c||250;for(let r=0;r<a;r++)try{n=await this.nc.request(e,t,o);break}catch(e){if("503"===e.code&&r+1<a)await eR(c);else throw e}let u=this.parseJsResponse(n);if(""===u.stream)throw eE.errorForCode(O.JetStreamInvalidAck);return u.duplicate=!!u.duplicate&&u.duplicate,u}async pull(e,t,r=0){eW(e),eK(t);let n=this.timeout;r>n&&(n=r);let s={batch:1,no_wait:0===(r=r<0?0:eU(r)),expires:r},i=await this.nc.request(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(s),{noMux:!0,timeout:n}),o=eQ(i);if(o)throw o;return rd(i,this.timeout)}fetch(e,t,r={}){eW(e),eK(t);let n=null,s=(r.max_bytes??0)>0,i=0,o=s?r.max_bytes:0,a=null,c={};if(c.batch=r.batch||1,o){let e=this.nc.features.get(es.JS_PULL_MAX_BYTES);if(!e.ok)throw Error(`max_bytes is only supported on servers ${e.min} or better`);c.max_bytes=o}c.no_wait=r.no_wait||!1,c.no_wait&&c.expires&&(c.expires=0);let u=r.expires||0;if(u&&(c.expires=eU(u)),0===u&&!1===c.no_wait)throw Error("expires or no_wait is required");let h=r.idle_heartbeat||0;h&&(c.idle_heartbeat=eU(h),!0===r.delay_heartbeat&&(c.idle_heartbeat=eU(4*h)));let l=new e1,f=c.batch,d=0;l.protocolFilterFn=(e,t=!1)=>!eX(e.msg)||(a?.work(),!1),l.dispatchedFn=e=>{e&&(s&&(i+=e.data.length),d++,(!n||0!==e.info.pending)&&(1===l.getPending()&&0===e.info.pending||f===d||o>0&&i>=o)&&l.stop())};let p=ek(this.nc.options.inboxPrefix),g=this.nc.subscribe(p,{max:r.batch,callback:(e,t)=>{(null===e&&(e=eQ(t)),null!==e)?(n&&(n.cancel(),n=null),"string"==typeof e.code)?l.stop(null===rU(e)?void 0:e):l.stop(e):(a?.work(),l.received++,l.push(rd(t,this.timeout)))}});return u&&(n=eN(u)).catch(()=>{g.isClosed()||(g.drain().catch(()=>{}),n=null),a&&a.cancel()}),(async()=>{try{h&&(a=new e2(h,e=>(l.push(()=>{l.err=new eE(`${I.IdleHeartbeatMissed}: ${e}`,O.JetStreamIdleHeartBeat)}),!0)))}catch(e){}await g.closed,null!==n&&(n.cancel(),n=null),a&&a.cancel(),l.stop()})().catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(c),{reply:p}),l}async pullSubscribe(e,t=e5()){let r=await this._processOptions(e,t);if(r.ordered)throw Error("pull subscribers cannot be be ordered");if(r.config.deliver_subject)throw Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");let n=r.config.ack_policy;if(n===$.None||n===$.All)throw Error("ack policy for pull consumers must be explicit");let s=this._buildTypedSubscriptionOpts(r),i=new r$(this,r.deliver,s);i.info=r;try{await this._maybeCreateConsumer(r)}catch(e){throw i.unsubscribe(),e}return i}async subscribe(e,t=e5()){let r=await this._processOptions(e,t);if(!r.isBind&&!r.config.deliver_subject)throw Error("push consumer requires deliver_subject");let n=this._buildTypedSubscriptionOpts(r),s=new rT(this,r.deliver,n);s.info=r;try{await this._maybeCreateConsumer(r)}catch(e){throw s.unsubscribe(),e}return s._maybeSetupHbMonitoring(),s}async _processOptions(e,t=e5()){let r=e4(t)?t.getOpts():t;if(r.isBind=!!e4(t)&&t.isBind,r.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},r.ordered){if(r.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},r.config.ack_policy!==$.NotSet&&r.config.ack_policy!==$.None)throw new eE("ordered consumer: ack_policy can only be set to 'none'",O.ApiError);if(r.config.durable_name&&r.config.durable_name.length>0)throw new eE("ordered consumer: durable_name cannot be set",O.ApiError);if(r.config.deliver_subject&&r.config.deliver_subject.length>0)throw new eE("ordered consumer: deliver_subject cannot be set",O.ApiError);if(void 0!==r.config.max_deliver&&r.config.max_deliver>1)throw new eE("ordered consumer: max_deliver cannot be set",O.ApiError);if(r.config.deliver_group&&r.config.deliver_group.length>0)throw new eE("ordered consumer: deliver_group cannot be set",O.ApiError);r.config.deliver_subject=ek(this.nc.options.inboxPrefix),r.config.ack_policy=$.None,r.config.max_deliver=1,r.config.flow_control=!0,r.config.idle_heartbeat=r.config.idle_heartbeat||eU(5e3),r.config.ack_wait=eU(792e5),r.config.mem_storage=!0,r.config.num_replicas=1}if(r.config.ack_policy===$.NotSet&&(r.config.ack_policy=$.All),r.api=this,r.config=r.config||{},r.stream=r.stream?r.stream:await this.findStream(e),r.attached=!1,r.config.durable_name)try{let t=await this.consumerAPI.info(r.stream,r.config.durable_name);if(t){if(t.config.filter_subject&&t.config.filter_subject!==e)throw Error("subject does not match consumer");let n=r.config.deliver_group??"";if(""===n&&!0===t.push_bound)throw Error("duplicate subscription");let s=t.config.deliver_group??"";if(n!==s)if(""===s)throw Error("durable requires no queue group");else throw Error(`durable requires queue group '${s}'`);r.last=t,r.config=t.config,r.attached=!0,r.config.durable_name||(r.name=t.name)}}catch(e){if("404"!==e.code)throw e}return r.attached||void 0!==r.config.filter_subject||void 0!==r.config.filter_subjects||(r.config.filter_subject=e),r.deliver=r.config.deliver_subject||ek(this.nc.options.inboxPrefix),r}_buildTypedSubscriptionOpts(e){var t,r,n,s;let i={};return t=void 0===e.callbackFn,r=this.timeout,i.adapter=t?(n=r,(e,t)=>{if(e)return[e,null];let r=eQ(t);return null!==r?[rU(r),null]:[null,rd(t,n)]}):(s=r,(e,t)=>e||(e=eQ(t))?[e,null]:[null,rd(t,s)]),i.ingestionFilterFn=rC.ingestionFn(e.ordered),i.protocolFilterFn=(e,t=!1)=>!eZ(e.msg)||(t||e.msg.respond(),!1),e.mack||e.config.ack_policy===$.None||(i.dispatchedFn=rq),e.callbackFn&&(i.callback=e.callbackFn),i.max=e.max||0,i.queue=e.queue,i}async _maybeCreateConsumer(e){if(e.attached)return;if(e.isBind)throw Error(`unable to bind - durable consumer ${e.config.durable_name} doesn't exist in ${e.stream}`);e.config=Object.assign({deliver_policy:T.All,ack_policy:$.Explicit,ack_wait:eU(3e4),replay_policy:U.Instant},e.config);let t=await this.consumerAPI.add(e.stream,e.config);if(Array.isArray(e.config.filter_subjects&&!Array.isArray(t.config.filter_subjects)))throw Error("jetstream server doesn't support consumers with multiple filter subjects");e.name=t.name,e.config=t.config,e.last=t}static ingestionFn(e){return(t,r)=>{if(!t)return{ingest:!1,protocol:!1};if(eQ(t.msg)||r.monitor?.work(),eX(t.msg)){let n=!e||r._checkHbOrderConsumer(t.msg);return!e&&r.info.flow_control.heartbeat_count++,{ingest:n,protocol:!0}}return eZ(t.msg)?(r.info.flow_control.fc_count++,{ingest:!0,protocol:!0}):{ingest:!e||r._checkOrderedConsumer(t),protocol:!1}}}}class rI{options;protocol;draining;listeners;_services;constructor(e){this.draining=!1,this.options=function(e){var t,r,n;let s,i=`${ej}:${tS()}`;if((e=e||{servers:[i]}).servers=e.servers||[],"string"==typeof e.servers&&(e.servers=[e.servers]),e.servers.length>0&&e.port)throw new eE("port and servers options are mutually exclusive",O.InvalidOption);0===e.servers.length&&e.port&&(e.servers=[`${ej}:${e.port}`]),e.servers&&0===e.servers.length&&(e.servers=[i]);let o=eC({maxPingOut:2,maxReconnectAttempts:10,noRandomize:!1,pedantic:!1,pingInterval:12e4,reconnect:!0,reconnectJitter:100,reconnectJitterTLS:1e3,reconnectTimeWait:2e3,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1},e);if(s=[],"function"==typeof o.authenticator&&s.push(o.authenticator),Array.isArray(o.authenticator)&&s.push(...o.authenticator),o.token&&s.push((t=o.token,()=>({auth_token:"function"==typeof t?t():t}))),o.user&&s.push((r=o.user,n=o.pass,()=>({user:"function"==typeof r?r():r,pass:"function"==typeof n?n():n}))),o.authenticator=0===s.length?()=>{}:e=>{let t={};return s.forEach(r=>{let n=r(e)||{};t=Object.assign(t,n)}),t},["reconnectDelayHandler","authenticator"].forEach(e=>{if(o[e]&&"function"!=typeof o[e])throw new eE(`${e} option should be a function`,O.NotFunction)}),o.reconnectDelayHandler||(o.reconnectDelayHandler=()=>{let e=o.tls?o.reconnectJitterTLS:o.reconnectJitter;return e&&(e=Math.floor(Math.random()*++e)),o.reconnectTimeWait+e}),o.inboxPrefix)try{ek(o.inboxPrefix)}catch(e){throw new eE(e.message,O.ApiError)}if(void 0===o.resolve&&(o.resolve="function"==typeof tA()),o.resolve&&"function"!=typeof tA())throw new eE("'resolve' is not supported on this client",O.InvalidOption);return o}(e),this.listeners=[]}static connect(e={}){return new Promise((t,r)=>{let n=new rI(e);tY.connect(n.options,n).then(e=>{n.protocol=e,async function(){for await(let t of e.status())n.listeners.forEach(e=>{e.push(t)})}(),t(n)}).catch(e=>{r(e)})})}closed(){return this.protocol.closed}async close(){await this.protocol.close()}_check(e,t,r){if(this.isClosed())throw eE.errorForCode(O.ConnectionClosed);if(t&&this.isDraining()||r&&this.protocol.noMorePublishing)throw eE.errorForCode(O.ConnectionDraining);if(0===(e=e||"").length)throw eE.errorForCode(O.BadSubject)}publish(e,t,r){this._check(e,!1,!0),this.protocol.publish(e,t,r)}publishMessage(e){return this.publish(e.subject,e.data,{reply:e.reply,headers:e.headers})}respondMessage(e){return!!e.reply&&(this.publish(e.reply,e.data,{reply:e.reply,headers:e.headers}),!0)}subscribe(e,t={}){this._check(e,!0,!1);let r=new tW(this.protocol,e,t);return this.protocol.subscribe(r),r}_resub(e,t,r){this._check(t,!0,!1),e.max=r,r&&(e.max=r+e.received),this.protocol.resub(e,t)}requestMany(e,t=eg,r={maxWait:1e3,maxMessages:-1}){let n=!this.protocol.options.noAsyncTraces;try{this._check(e,!0,!0)}catch(e){return Promise.reject(e)}if(r.strategy=r.strategy||k.Timer,r.maxWait=r.maxWait||1e3,r.maxWait<1)return Promise.reject(new eE("timeout",O.InvalidOption));let s=new e1;function i(e){s.push(()=>{s.stop(e)})}function o(e,t){e||null===t?i(null===e?void 0:e):s.push(t)}if(r.noMux){let a=n?Error().stack:null,c="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,u=this.subscribe(ek(this.options.inboxPrefix),{callback:(e,t)=>{if(t?.data?.length===0&&t?.headers?.status===O.NoResponders&&(e=eE.errorForCode(O.NoResponders)),e){a&&(e.stack+=`

${a}`),h(e);return}o(null,t),r.strategy===k.Count&&0==--c&&h(),r.strategy===k.JitterTimer&&(f(),l=setTimeout(()=>{h()},300)),r.strategy===k.SentinelMsg&&t&&0===t.data.length&&h()}});u.requestSubject=e,u.closed.then(()=>{i()}).catch(e=>{s.stop(e)});let h=e=>{e&&s.push(()=>{throw e}),f(),u.drain().then(()=>{i()}).catch(e=>{i()})};s.iterClosed.then(()=>{f(),u?.unsubscribe()}).catch(e=>{f(),u?.unsubscribe()});try{this.publish(e,t,{reply:u.getSubject()})}catch(e){h(e)}let l=setTimeout(()=>{h()},r.maxWait),f=()=>{l&&clearTimeout(l)}}else{r.callback=o,s.iterClosed.then(()=>{n.cancel()}).catch(e=>{n.cancel(e)});let n=new td(this.protocol.muxSubscriptions,e,r);this.protocol.request(n);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${n.token}`,headers:r.headers})}catch(e){n.cancel(e)}}return Promise.resolve(s)}request(e,t,r={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(e){return Promise.reject(e)}let n=!this.protocol.options.noAsyncTraces;if(r.timeout=r.timeout||1e3,r.timeout<1)return Promise.reject(new eE("timeout",O.InvalidOption));if(!r.noMux&&r.reply)return Promise.reject(new eE("reply can only be used with noMux",O.InvalidOption));if(r.noMux){let s=r.reply?r.reply:ek(this.options.inboxPrefix),i=eM(),o=n?Error():null,a=this.subscribe(s,{max:1,timeout:r.timeout,callback:(e,t)=>{e?(o&&e.code!==O.Timeout&&(e.stack+=`

${o.stack}`),a.unsubscribe(),i.reject(e)):(e=eJ(t))?(o&&(e.stack+=`

${o.stack}`),i.reject(e)):i.resolve(t)}});return a.requestSubject=e,this.protocol.publish(e,t,{reply:s,headers:r.headers}),i}{let s=new tp(this.protocol.muxSubscriptions,e,r,n);this.protocol.request(s);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${s.token}`,headers:r.headers})}catch(e){s.cancel(e)}let i=Promise.race([s.timer,s.deferred]);return i.catch(()=>{s.cancel()}),i}}flush(){return this.isClosed()?Promise.reject(eE.errorForCode(O.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject(eE.errorForCode(O.ConnectionClosed)):this.isDraining()?Promise.reject(eE.errorForCode(O.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){let e=this.protocol.getServer();return e?e.listen:""}status(){let e=new e1;return e.iterClosed.then(()=>{let t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}async context(){return(await this.request("$SYS.REQ.USER.INFO")).json((e,t)=>"time"===e?new Date(Date.parse(t)):t)}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}async jetstreamManager(e={}){let t=new rS(this,e);if(!1!==e.checkAPI)try{await t.getAccountInfo()}catch(e){throw e.code===O.NoResponders&&(e.code=O.JetStreamNotEnabled),e}return t}jetstream(e={}){return new rC(this,e)}getServerVersion(){let e=this.info;return e?t_(e.version):void 0}async rtt(){if(!this.protocol._closed&&!this.protocol.connected)throw eE.errorForCode(O.Disconnect);let e=Date.now();return await this.flush(),Date.now()-e}get features(){return this.protocol.features}get services(){return this._services||(this._services=new rN(this)),this._services}reconnect(){return this.isClosed()?Promise.reject(eE.errorForCode(O.ConnectionClosed)):this.isDraining()?Promise.reject(eE.errorForCode(O.ConnectionDraining)):this.protocol.reconnect()}}class rN{nc;constructor(e){this.nc=e}add(e){try{return new tQ(this.nc,e).start()}catch(e){return Promise.reject(e)}}client(e,t){return new t1(this.nc,e,t)}}class rR{bucket;sm;prefixLen;constructor(e,t,r){this.bucket=e,this.prefixLen=t,this.sm=r}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(t3)||"PUT"}get length(){let e=this.sm.header.get(B.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class rM{bucket;key;sm;constructor(e,t,r){this.bucket=e,this.key=t,this.sm=r}get value(){return this.sm.data}get created(){return new Date(eq(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){return this.sm.headers?.get(t3)||"PUT"}get delta(){return this.sm.info.pending}get length(){let e=this.sm.headers?.get(B.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class rT extends tx{js;monitor;constructor(e,t,r){super(e.nc,t,r),this.js=e,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(e){this.sub.info=e}get info(){return this.sub.info}_resetOrderedConsumer(e){if(null===this.info||this.sub.isClosed())return;let t=ek(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,t);let r=this.info;r.config.name=ew.next(),r.ordered_consumer_sequence.delivery_seq=0,r.flow_control.heartbeat_count=0,r.flow_control.fc_count=0,r.flow_control.consumer_restarts++,r.deliver=t,r.config.deliver_subject=t,r.config.deliver_policy=T.StartSequence,r.config.opt_start_seq=e;let n={};n.stream_name=this.info.stream,n.config=r.config;let s=`${r.api.prefix}.CONSUMER.CREATE.${r.stream}`;this.js._request(s,n,{retries:-1}).then(e=>{this.sub.info.last=e,this.info.config=e.config,this.info.name=e.name}).catch(t=>{let n=new eE(`unable to recreate ordered consumer ${r.stream} at seq ${e}`,O.RequestError,t);this.sub.callback(n,{})})}_maybeSetupHbMonitoring(){let e=this.info?.config?.idle_heartbeat||0;e&&this._setupHbMonitoring(eq(e))}_setupHbMonitoring(e,t=0){let r={cancelAfter:0,maxOut:2};t&&(r.cancelAfter=t);let n=this.sub,s=e=>{var t,r;let s,i,o=(t=`${I.IdleHeartbeatMissed}: ${e}`,r=this.sub.subject,s=eF(409,t),(i=new eG({hdr:1,sid:0,size:0},eg,{}))._headers=s,i._subject=r,i);if(this.info?.ordered){if(!this.js.nc.protocol.connected)return!1;let e=this.info?.ordered_consumer_sequence?.stream_seq||0;return this._resetOrderedConsumer(e+1),this.monitor?.restart(),!1}return this.sub.callback(null,o),!n.noIterator};this.monitor=new e2(e,s,r)}_checkHbOrderConsumer(e){let t=e.headers.get(B.ConsumerStalledHdr);""!==t&&this.js.nc.publish(t);let r=parseInt(e.headers.get(B.LastConsumerSeqHdr),10),n=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,r!==n.delivery_seq&&this._resetOrderedConsumer(n.stream_seq+1),!1}_checkOrderedConsumer(e){let t=this.info.ordered_consumer_sequence,r=e.info.streamSequence,n=e.info.deliverySequence;return n!=t.delivery_seq+1?(this._resetOrderedConsumer(t.stream_seq+1),!1):(t.delivery_seq=n,t.stream_seq=r,!0)}async destroy(){this.isClosed()||await this.drain();let e=this.sub.info,t=e.config.durable_name||e.name,r=`${e.api.prefix}.CONSUMER.DELETE.${e.stream}.${t}`;await e.api._request(r)}async consumerInfo(){let e=this.sub.info,t=e.config.durable_name||e.name,r=`${e.api.prefix}.CONSUMER.INFO.${e.stream}.${t}`,n=await e.api._request(r);return e.last=n,n}}class r$ extends rT{constructor(e,t,r){super(e,t,r)}pull(e={batch:1}){let{stream:t,config:r,name:n}=this.sub.info,s=r.durable_name??n,i={};if(i.batch=e.batch||1,i.no_wait=e.no_wait||!1,(e.max_bytes??0)>0){let t=this.js.nc.features.get(es.JS_PULL_MAX_BYTES);if(!t.ok)throw Error(`max_bytes is only supported on servers ${t.min} or better`);i.max_bytes=e.max_bytes}let o=0;e.expires&&e.expires>0&&(i.expires=eU(o=e.expires));let a=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(i.idle_heartbeat=eU(a=e.idle_heartbeat)),a&&0===o)throw Error("idle_heartbeat requires expires");if(a>o)throw Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),o&&a&&(this.monitor?this.monitor._change(a,o):this._setupHbMonitoring(a,o));let e=this.info.api,r=`${e.prefix}.CONSUMER.MSG.NEXT.${t}.${s}`,n=this.sub.subject;e.nc.publish(r,e.jc.encode(i),{reply:n})}}}function rU(e){if(null!==e)switch(e.code){case O.JetStream404NoMessages:case O.JetStream408RequestTimeout:break;case O.JetStream409:var t;if((t=e).code===O.JetStream409&&void 0!==[I.MaxBatchExceeded,I.MaxExpiresExceeded,I.MaxBytesExceeded,I.MaxMessageSizeExceeded,I.PushConsumer,I.IdleHeartbeatMissed,I.ConsumerDeleted].find(e=>-1!==t.message.indexOf(e)))return e;break;default:return e}return null}function rq(e){e&&e.ack()}class rL{msg;di;didAck;timeout;constructor(e,t){this.msg=e,this.didAck=!1,this.timeout=t}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=function(e){let t=e.split(".");if(9===t.length&&t.splice(2,0,"_",""),t.length<11||"$JS"!==t[0]||"ACK"!==t[1])throw Error("not js message");let r={};return r.domain="_"===t[2]?"":t[2],r.account_hash=t[3],r.stream=t[4],r.consumer=t[5],r.deliveryCount=parseInt(t[6],10),r.redeliveryCount=r.deliveryCount,r.redelivered=r.deliveryCount>1,r.streamSequence=parseInt(t[7],10),r.deliverySequence=parseInt(t[8],10),r.timestampNanos=parseInt(t[9],10),r.pending=parseInt(t[10],10),r}(this.reply)),this.di}get redelivered(){return this.info.deliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return 4===e.length&&e[0]===ru[0]&&e[1]===ru[1]&&e[2]===ru[2]&&e[3]===ru[3]}async ackAck(e){(e=e||{}).timeout=e.timeout||this.timeout;let t=eM();if(this.didAck)t.resolve(!1);else if(this.didAck=!0,this.msg.reply){let r=this.msg.publisher,n=!r.options?.noAsyncTraces,s=new tp(r.muxSubscriptions,this.msg.reply,{timeout:e.timeout},n);r.request(s);try{r.publish(this.msg.reply,ra,{reply:`${r.muxSubscriptions.baseInbox}${s.token}`})}catch(e){s.cancel(e)}try{await Promise.race([s.timer,s.deferred]),t.resolve(!0)}catch(e){s.cancel(e),t.reject(e)}}else t.resolve(!1);return t}ack(){this.doAck(ra)}nak(e){let t=rc;e&&(t=ez().encode(`-NAK ${JSON.stringify({delay:eU(e)})}`)),this.doAck(t)}working(){this.doAck(ru)}next(e,t={batch:1}){let r={};r.batch=t.batch||1,r.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(r.expires=eU(t.expires));let n=eH().encode(r),s=e7.concat(rh,rf,n);this.msg.respond(s,e?{reply:e}:void 0)}term(e=""){let t=rl;e?.length>0&&(t=ez().encode(`+TERM ${e}`)),this.doAck(t)}json(){return this.msg.json()}string(){return this.msg.string()}}class rF{version;lang;closeError;connected;done;socket;options;socketClosed;encrypted;peeked;yields;signal;closedNotification;constructor(){this.version="1.30.3",this.lang="nats.ws",this.connected=!1,this.done=!1,this.socketClosed=!1,this.encrypted=!1,this.peeked=!1,this.yields=[],this.signal=eM(),this.closedNotification=eM()}async connect(e,t){let r=eM();if(t.tls)return r.reject(new eE("tls",O.InvalidOption)),r;this.options=t;let n=e.src;if(t.wsFactory){let{socket:r,encrypted:n}=await t.wsFactory(e.src,t);this.socket=r,this.encrypted=n}else this.encrypted=0===n.indexOf("wss://"),this.socket=new WebSocket(n);return this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{if(this.isDiscarded())return},this.socket.onmessage=e=>{if(this.isDiscarded())return;if(this.yields.push(new Uint8Array(e.data)),this.peeked)return void this.signal.resolve();let n=e7.concat(...this.yields),s=function(e){let t=function(e){for(let t=0;t<e.length;t++){let r=t+1;if(e.byteLength>r&&e[t]===tP&&e[r]===tk)return r+1}return 0}(e);if(t>0){let r=new Uint8Array(e).slice(0,t);return e_.decode(r)}return""}(n);if(""!==s){let e=tH.exec(s);if(!e){t.debug&&console.error("!!!",eI(n)),r.reject(Error("unexpected response from server"));return}try{let t=JSON.parse(e[1]);!function(e,t){let{proto:r,tls_required:n,tls_available:s}=e;if((void 0===r||r<1)&&t.noEcho)throw new eE("noEcho",O.ServerOptionNotAvailable);if(t.tls&&!(n||s))throw new eE("tls",O.ServerOptionNotAvailable)}(t,this.options),this.peeked=!0,this.connected=!0,this.signal.resolve(),r.resolve()}catch(e){r.reject(e);return}}},this.socket.onclose=e=>{let t;this.isDiscarded()||(this.socketClosed=!0,this.done||(e.wasClean||(t=Error(e.reason)),this._closed(t)))},this.socket.onerror=e=>{if(this.isDiscarded())return;let t=new eE(e.message,O.Unknown,Error(e.error));r.reject(t)},r}disconnect(){this._closed(void 0,!0)}async _closed(e,t=!0){if(!this.isDiscarded()&&this.connected&&!this.done){if(this.closeError=e,!e)for(;!this.socketClosed&&this.socket.bufferedAmount>0;)await eR(100);this.done=!0;try{this.socket.close(e?1002:1e3,e?e.message:void 0)}catch(e){}t&&this.closedNotification.resolve(e)}}get isClosed(){return this.done}[Symbol.asyncIterator](){return this.iterate()}async *iterate(){for(;;){if(this.isDiscarded())return;0===this.yields.length&&await this.signal;let e=this.yields;this.yields=[];for(let t=0;t<e.length;t++)this.options.debug&&console.info(`> ${eI(e[t])}`),yield e[t];if(this.done)break;0===this.yields.length&&(e.length=0,this.yields=e,this.signal=eM())}}isEncrypted(){return this.connected&&this.encrypted}send(e){if(!this.isDiscarded())try{this.socket.send(e.buffer),this.options.debug&&console.info(`< ${eI(e)}`);return}catch(t){this.options.debug&&console.error(`!!! ${eI(e)}: ${t}`)}}close(e){return this._closed(e,!1)}closed(){return this.closedNotification}isDiscarded(){return!!this.done&&(this.discard(),!0)}discard(){this.done=!0;try{this.socket?.close()}catch(e){}}}function rB(e,t){let r,n;/^(.*:\/\/)(.*)/.test(e)||(e="boolean"==typeof t?`${!0===t?"https":"http"}://${e}`:`https://${e}`);let s=new URL(e),i=s.protocol.toLowerCase();"ws:"===i&&(t=!1),"wss:"===i&&(t=!0),"https:"!==i&&"http"!==i&&(e=e.replace(/^(.*:\/\/)(.*)/gm,"$2"),s=new URL(`http://${e}`));let o=s.hostname,a=s.pathname,c=s.search||"";switch(i){case"http:":case"ws:":case"nats:":n=s.port||"80",r="ws:";break;case"https:":case"wss:":case"tls:":n=s.port||"443",r="wss:";break;default:n=s.port||!0===t?"443":"80",r=!0===t?"wss:":"ws:"}return`${r}//${o}:${n}${a}${c}`}function rD(e={}){return t={defaultPort:443,urlParseFn:rB,factory:()=>new rF},rI.connect(e)}e.s(["JSONCodec",()=>eH,"connect",()=>rD],422499);var rz=e.i(41139);e.i(171580);var rH=((er={}).Advanced="ADVANCED",er.Core="CORE",er.PumpSwap="PUMP_SWAP",er.Unified="UNIFIED",er),rJ=((en={}).CONNECTING="CONNECTING",en.CONNECTED="CONNECTED",en.DISCONNECTED="DISCONNECTED",en);e.s(["ConnectionStatus",()=>rJ,"NatsInstance",()=>rH],984639);let rG={timeout:5e3,waitOnFirstConnect:!0,reconnect:!0,reconnectTimeWait:1e3,maxReconnectAttempts:-1,pingInterval:5e3,maxPingOut:2},rK={...rG,servers:"wss://prod-advanced.nats.realtime.pump.fun",user:"subscriber",pass:"OktDhmZ2D3CtYUiM"},rW={...rG,servers:"wss://prod-v2.nats.realtime.pump.fun",user:"subscriber",pass:"lW5a9y20NceF6AE9"},rV={...rG,servers:"wss://amm-prod.nats.realtime.pump.fun",user:"subscriber",pass:"7wjQpG3JvSQbUg3X"},rY={...rG,servers:"wss://unified-prod.nats.realtime.pump.fun",user:"subscriber",pass:"OX745xvUbNQMuFqV"},rZ={[rH.Advanced]:rK,[rH.Core]:rW,[rH.PumpSwap]:rV,[rH.Unified]:rY};e.i(649785),e.i(281675);let rX=new Map,rQ=new Map,r0=new Map,r1=new Map,r2=new Map,r3=!1,r5=new Set,r4=e=>new Promise(t=>setTimeout(t,e));function r6(){try{r1.forEach(e=>{try{e.subscription.unsubscribe()}catch{}}),r1.clear(),rQ.clear(),r0.clear(),rX.forEach(e=>{try{e.status===rJ.CONNECTED&&e.natsConnection&&e.natsConnection.close()}catch{}}),rX.clear(),r5.clear(),r2.clear()}catch{}}function r8(e){let t=rX.get(e);return t?.status||rJ.DISCONNECTED}function r7(e){let t=(0,rz.v4)();return r2.set(t,e),t}function r9(e){r2.delete(e)}function ne(e,t){r2.forEach(r=>{try{r(e,t)}catch{}})}async function nt(e,t=5){if(r3||(window.addEventListener("beforeunload",()=>{r6()}),document.addEventListener("visibilitychange",()=>{document.visibilityState}),window.addEventListener("unload",()=>{r6()}),window.addEventListener("pagehide",()=>{r6()}),r3=!0),rX.has(e)){let t=rX.get(e);if(t?.status===rJ.CONNECTED)return}rX.set(e,{status:rJ.CONNECTING}),ne(e,rJ.CONNECTING);let r=rZ[e];try{let t=await rD(r);rX.set(e,{status:rJ.CONNECTED,natsConnection:t}),r5.add(e),ne(e,rJ.CONNECTED);let n=r0.get(e);if(n){let r=eH(),s=new Map;n.forEach(e=>{s.has(e.channel)||s.set(e.channel,[]),s.get(e.channel).push(e)}),s.forEach((n,s)=>{let i=`${e}:${s}`,o=t.subscribe(s),a=new Map;n.forEach(({id:t,handler:r})=>{a.set(t,r),rQ.set(t,{subscription:o,handler:r,instance:e,channel:s})}),r1.set(i,{subscription:o,handlers:a,instance:e,channel:s}),(async e=>{for await(let t of e)try{let e=r.decode(t.data),n=e;ep.default.isObject(e)||(n=JSON.parse(e));let s=r1.get(i);s&&s.handlers.forEach(e=>{try{e(n)}catch{}})}catch{}})(o)}),r0.delete(e)}t.closed().then(async()=>{let t=[];r1.forEach((r,n)=>{r.instance===e&&t.push(n)}),t.forEach(e=>{r1.delete(e)});let r=[];rQ.forEach((t,n)=>{t.instance===e&&r.push(n)}),r.forEach(e=>{rQ.delete(e)}),rX.delete(e),r5.delete(e),ne(e,rJ.DISCONNECTED),(r5.size>0||r1.size>0)&&(await r4(1e3),nt(e))})}catch{rX.set(e,{status:rJ.DISCONNECTED}),ne(e,rJ.DISCONNECTED),t>0&&(await r4(1e3),nt(e,t-1))}}function nr(){let e={[rH.Advanced]:[],[rH.Core]:[],[rH.PumpSwap]:[],[rH.Unified]:[]};return r1.forEach((t,r)=>{e[t.instance].push({id:`nats-${r}`,channel:t.channel,instance:t.instance,handlerCount:t.handlers.size})}),e}function nn(){let e={[rH.Advanced]:[],[rH.Core]:[],[rH.PumpSwap]:[],[rH.Unified]:[]};return r1.forEach(t=>{Array.from(t.handlers.keys()).forEach(r=>{e[t.instance].push({id:r,channel:t.channel,instance:t.instance})})}),e}function ns(){let e={totalSubjectSubscriptions:r1.size,totalHandlers:0,byInstance:{},duplicateChannels:[]};Object.values(rH).forEach(t=>{e.byInstance[t]={subjects:0,handlers:0}});let t=new Map;return r1.forEach(r=>{let n=r.handlers.size;e.totalHandlers+=n,e.byInstance[r.instance].subjects++,e.byInstance[r.instance].handlers+=n;let s=r.channel;t.set(s,(t.get(s)||0)+1)}),t.forEach((t,r)=>{t>1&&e.duplicateChannels.push(r)}),e}function ni(e,t,r,n=(0,rz.v4)()){try{let s=rX.get(e),i=`${e}:${t}`;if(s&&"CONNECTED"===s.status){if(r1.has(i)){let e=r1.get(i);if(e.handlers.has(n))return n;e.handlers.set(n,r)}else{let o=eH(),a=s.natsConnection.subscribe(t),c=new Map;c.set(n,r),r1.set(i,{subscription:a,handlers:c,instance:e,channel:t}),(async e=>{for await(let t of e)try{let e=o.decode(t.data),r=e;ep.default.isObject(e)||(r=JSON.parse(e));let n=r1.get(i);n&&n.handlers.forEach(e=>{try{e(r)}catch{}})}catch{}})(a)}rQ.set(n,{subscription:r1.get(i).subscription,handler:r,instance:e,channel:t})}else{if((r0.get(e)||[]).find(e=>e.channel===t&&e.id===n))return n;r0.has(e)||r0.set(e,[]),r0.get(e).push({id:n,instance:e,channel:t,handler:r}),s||nt(e)}}catch{}return n}function no(e,t){try{let r=rX.get(e),n=rQ.get(t);if(!n)return;let s=`${e}:${n.channel}`;if(!r||"CONNECTED"!==r.status){r0.has(e)||r0.set(e,[]);let r=r0.get(e);r.splice(r.findIndex(e=>e.id===t),1),rQ.delete(t);return}let i=r1.get(s);i&&(i.handlers.delete(t),0===i.handlers.size&&(i.subscription.unsubscribe(),r1.delete(s))),rQ.delete(t)}catch{}}},955691,e=>{"use strict";var t=e.i(942765),r=e.i(649785),n=e.i(281675),s=e.i(208727),i=e.i(984639);let o=()=>({[i.NatsInstance.Advanced]:!1,[i.NatsInstance.Core]:!1,[i.NatsInstance.PumpSwap]:!1,[i.NatsInstance.Unified]:!1}),a={subscribe:s.subscribe,unsubscribe:s.unsubscribe,getActiveInstances:()=>[],isInstanceActive:()=>!1,getPreferredInstance:()=>null,connectionStates:o()},c=(0,n.createContext)(a),u=e=>{let a,u,l,f,d,p,g,m,_,b=(0,r.c)(22),{children:y,instances:v}=e;b[0]!==v?(a=void 0===v?[i.NatsInstance.Advanced,i.NatsInstance.PumpSwap,i.NatsInstance.Unified]:v,b[0]=v,b[1]=a):a=b[1];let w=a;b[2]===Symbol.for("react.memo_cache_sentinel")?(u=o(),b[2]=u):u=b[2];let[x,S]=(0,n.useState)(u),E=(0,n.useRef)(null);b[3]!==w?(l=()=>((async()=>{let e=o();for(let t of w){let r=(0,s.getConnectionStatus)(t);e[t]=r===i.ConnectionStatus.CONNECTED}for(let t of(S(e),E.current=(0,s.onConnectionStatusChange)((e,t)=>{S(r=>({...r,[e]:t===i.ConnectionStatus.CONNECTED}))}),w)){let e=(0,s.subscribe)(t,`_WARMUP_${t}_${Date.now()}`,h);setTimeout(()=>{(0,s.unsubscribe)(t,e)},100)}})(),()=>{E.current&&((0,s.removeConnectionStatusListener)(E.current),E.current=null)}),f=[w],b[3]=w,b[4]=l,b[5]=f):(l=b[4],f=b[5]),(0,n.useEffect)(l,f),b[6]!==x||b[7]!==w?(d=()=>w.filter(e=>x[e]),b[6]=x,b[7]=w,b[8]=d):d=b[8];let A=d;b[9]!==x?(p=e=>x[e]||!1,b[9]=x,b[10]=p):p=b[10];let O=p;b[11]!==A||b[12]!==O?(g=e=>{for(let t of e)if(O(t))return t;let t=A();return t.length>0?t[0]:null},b[11]=A,b[12]=O,b[13]=g):g=b[13];let P=g;b[14]!==x||b[15]!==A||b[16]!==P||b[17]!==O?(m={subscribe:s.subscribe,unsubscribe:s.unsubscribe,getActiveInstances:A,isInstanceActive:O,getPreferredInstance:P,connectionStates:x},b[14]=x,b[15]=A,b[16]=P,b[17]=O,b[18]=m):m=b[18];let k=m;return b[19]!==y||b[20]!==k?(_=(0,t.jsx)(c.Provider,{value:k,children:y}),b[19]=y,b[20]=k,b[21]=_):_=b[21],_};function h(){}e.s(["NatsProvider",0,u,"default",0,u,"useNats",0,()=>(0,n.useContext)(c)])}]);